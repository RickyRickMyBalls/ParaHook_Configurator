<!-- FILE: index.html -->
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ParaHook Generator</title>
    <style>
      html, body {
        margin: 0;
        height: 100%;
        min-height: 100dvh;
        overflow: hidden;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      }

      body {
        min-height: var(--app-vh, 100dvh);
      }

      #c {
        width: 100vw;
        height: var(--app-vh, 100dvh);
        display: block;
      }
      #bootLoadingOverlay {
        position: fixed;
        inset: 0;
        z-index: 5000;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(8, 10, 14, 0.88);
        backdrop-filter: blur(3px);
        color: #e8e8ea;
        pointer-events: auto;
        opacity: 1;
        transition: opacity 220ms ease, visibility 220ms ease;
      }
      #bootLoadingOverlay.hidden {
        opacity: 0;
        visibility: hidden;
        pointer-events: none;
      }
      .bootLoadingCard {
        min-width: 220px;
        width: min(88vw, 360px);
        max-width: min(88vw, 360px);
        padding: 16px 18px;
        border-radius: 12px;
        background: rgba(20, 20, 24, 0.92);
        border: 1px solid rgba(255, 255, 255, 0.12);
        box-shadow: 0 18px 40px rgba(0, 0, 0, 0.45);
        display: grid;
        gap: 10px;
        text-align: center;
      }
      .bootLoadingTitle {
        font-size: 14px;
        font-weight: 700;
        letter-spacing: 0.01em;
      }
      .bootLoadingSub {
        font-size: 12px;
        opacity: 0.82;
      }
      .bootLoadingProgress {
        position: relative;
        width: 100%;
        min-width: 100%;
        max-width: 100%;
        height: 18px;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.18);
        background: rgba(255, 255, 255, 0.07);
        overflow: hidden;
      }
      .bootLoadingProgressFill {
        position: absolute;
        inset: 0 auto 0 0;
        width: 0%;
        background: linear-gradient(90deg, rgba(95, 170, 255, 0.65), rgba(135, 210, 255, 0.85));
        transition: width 140ms ease;
      }
      .bootLoadingProgressText {
        position: absolute;
        inset: 0 8px 0 8px;
        display: flex;
        align-items: center;
        justify-content: flex-end;
        font-size: 11px;
        font-weight: 700;
        letter-spacing: 0.02em;
        color: #f3f6fb;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
      }
      .bootLoadingDetail {
        min-height: 14px;
        font-size: 11px;
        line-height: 1.35;
        color: rgba(232, 232, 234, 0.9);
        text-align: left;
        word-break: break-word;
      }
      .bootLoadingLog {
        height: 100px;
        max-height: 28vh;
        overflow: auto;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.12);
        background: rgba(0, 0, 0, 0.28);
        padding: 6px 8px;
        box-sizing: border-box;
        text-align: left;
        font-size: 11px;
        line-height: 1.3;
        color: rgba(232, 232, 234, 0.9);
      }
      .bootLoadingLogLine {
        margin: 0 0 4px 0;
        white-space: pre-wrap;
        word-break: break-word;
      }
      .bootLoadingLogLine:last-child {
        margin-bottom: 0;
      }
      .bootLoadingSpinner {
        width: 26px;
        height: 26px;
        margin: 0 auto;
        border-radius: 999px;
        border: 2px solid rgba(255, 255, 255, 0.2);
        border-top-color: rgba(255, 255, 255, 0.9);
        animation: bootSpin 0.85s linear infinite;
      }
      @keyframes bootSpin {
        to { transform: rotate(360deg); }
      }
      @media (prefers-reduced-motion: reduce) {
        #bootLoadingOverlay {
          transition: none;
        }
        .bootLoadingSpinner {
          animation: none;
        }
      }

      /* Allow text selection in debug + status */
      #log,
      #status {
        user-select: text;
        -webkit-user-select: text;
      }

      /* OUTER container only (position + sizing + resize) */
      #ui {
        position: fixed;
        top: 16px;
        left: 16px;

        width: 360px;
        min-width: 300px;
        max-width: min(700px, calc(100vw - 32px));

        height: var(--app-vh, 100dvh);
        min-height: var(--app-vh, 100dvh);
        max-height: var(--app-vh, 100dvh);

        overflow: hidden; /* panels manage their own scroll */
        resize: horizontal;
        box-sizing: border-box;

        display: flex;
        flex-direction: column;
        gap: 0px; /* space between boxes */
        clip-path: inset(0 0 0 0 round 12px);
        opacity: 1;
        transition: clip-path 240ms ease, opacity 180ms ease;
        will-change: clip-path, opacity;
      }

      /* REUSABLE big box style */
      .panelBox {
        background: rgba(20,20,24,0.9);
        border-radius: 12px;
        color: #e8e8ea;
        box-shadow: 0 10px 30px rgba(0,0,0,0.45);
        user-select: none;
        box-sizing: border-box;
        padding: 14px 14px 10px 14px;
      }

      /* Title/Version panel */
      #titlePanel {
        background: rgba(0,0,0,0.20);
        border: 1px solid rgba(255,255,255,0.14);
        border-radius: 12px;
        padding: 10px 12px;
        box-sizing: border-box;

        display: flex;
        align-items: baseline;
        justify-content: space-between;
        gap: 12px;
        margin-bottom: 10px;
        cursor: pointer;
      }

      #appTitle {
        font-weight: 900;
        letter-spacing: 0.2px;
        font-size: 14px;
        line-height: 1.2;
      }

      #appVersion {
        font-size: 12px;
        opacity: 0.8;
        font-variant-numeric: tabular-nums;
        white-space: nowrap;
      }

      /* Middle panel scrolls */
      #controlsPanel {
        flex: 1 1 auto;
        overflow: auto;
        min-height: 0; /* critical for flex children to scroll */
        margin-top: 5px;
      }
      #controlsPanelTitle {
        text-align: center;
        font-size: 12px;
        font-weight: 700;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        opacity: 0.75;
        margin: 5px 0 8px 0;
      }

      /* Debug panel stays its own box */
      #debugPanel {
        flex: 0 0 auto;
        background: transparent;
        box-shadow: none;
        padding: 0;
        border-radius: 0;
        margin-top: -8px; /* keep seam overlap, but shift debug panel down 5px */
        position: relative;
        z-index: 1;
      }
      #titleStatsPanel > #debugPanel {
        margin-top: 10px;
        position: static;
        z-index: auto;
      }
      #titleBlockPanel {
        position: relative;
        padding-top: 14px;
        padding-bottom: 14px;
        display: flex;
        flex-direction: column;
        flex: 0 0 auto;
        overflow-x: hidden;
        overflow-y: visible;
        min-height: fit-content;
      }
      #titleBlockPanel.statsExpanded {
        resize: vertical;
        overflow: hidden;
        min-height: 240px;
        max-height: calc(var(--app-vh, 100dvh) - 32px);
      }
      #titleBlockPanel #titlePanel {
        margin-bottom: 10px;
      }
      #titleBlockPanel .row.header {
        grid-template-columns: 1fr;
        margin-bottom: 10px;
      }
      #titleBlockPanel .check {
        margin: 8px 0;
      }
      #titleBlockPanel.titleOnly {
        padding-top: 8px;
        padding-bottom: 8px;
      }
      #titleBlockPanel.titleOnly #titlePanel {
        margin-bottom: 0;
        justify-content: space-between;
      }
      #titleBlockPanel.titleOnly .row.header,
      #titleBlockPanel.titleOnly .check,
      #titleBlockPanel.titleOnly #toolbarTopRow,
      #titleBlockPanel.titleOnly #titleStatsPanel {
        display: none;
      }
      #titleBlockPanel.titleOnly #appVersion,
      #titleBlockPanel.titleOnly #appVersion {
        display: none;
      }

      form { margin: 0; }

      .row { display: grid; grid-template-columns: 1fr auto; gap: 10px; align-items: center; margin: 8px 0; }
      .row.header { grid-template-columns: auto 1fr; margin-top: 0; margin-bottom: 10px; }

      .btnRow {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 8px;
        margin: 8px 0 10px 0;
      }
      .btnRow.twoCols {
        grid-template-columns: 1fr 1fr;
        margin-top: 0;
      }
      .btnStack {
        display: grid;
        grid-template-columns: 1fr;
        gap: 8px;
        margin: 8px 0 0 0;
      }

      label { display: grid; grid-template-columns: 1fr; gap: 6px; font-size: 13px; line-height: 1.2; }
      input[type="range"] { width: 100%; }

      button {
        padding: 7px 10px;
        border: 1px solid rgba(255,255,255,0.14);
        border-radius: 8px;
        cursor: pointer;
        background: #33363c;
        color: #f3f4f6;
        font-weight: 600;
      }
      button.secondary { background: #33363c; color: #f3f4f6; }
      #modelLivePauseBtn.secondary {
        background: #0f1215;
        color: #e8e8ea;
      }
      button:disabled { opacity: 0.6; cursor: not-allowed; }

      #status { font-size: 13px; opacity: 0.9; text-align: left; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
      #status {
        position: relative;
        display: flex;
        align-items: center;
        width: 100%;
        min-width: 0;
        min-height: 28px;
        padding: 0 8px;
        border-radius: 8px;
        border: 1px solid rgba(255,255,255,0.10);
        background: rgba(255,255,255,0.03);
        box-sizing: border-box;
      }
      #statusProgressFill {
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 0%;
        background: #1f3a57;
        opacity: 0;
        transition: width 140ms ease, opacity 120ms ease;
        pointer-events: none;
      }
      #status.progressActive #statusProgressFill {
        opacity: 1;
      }
      #statusText {
        position: relative;
        z-index: 1;
        min-width: 0;
        width: 100%;
        color: #eef2f7;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      details.section {
        margin-top: 10px;
        border-top: 1px solid rgba(255,255,255,0.15);
        padding-top: 15px;
      }
      details.section summary {
        cursor: pointer;
        font-weight: 800;
        font-size: 13px;
        letter-spacing: 0.2px;
        list-style: none;
      }
      details.section.hasInlinePanelActions {
        position: relative;
      }
      details.section.hasInlinePanelActions > summary {
        padding-right: 76px;
        min-height: 24px;
        display: flex;
        align-items: center;
      }
      details.section.hasInlinePanelActions > .panelActionRow {
        position: absolute;
        top: 13px;
        right: 0;
        margin: 0;
        z-index: 2;
      }
      details.section summary::-webkit-details-marker { display: none; }
      .sectionMeta { font-size: 12px; opacity: 0.8; margin: 4px 0 8px 0; }
      .sectionMeta.subNote { margin-left: 16px; }
      .endDivider {
        margin: 10px 0 2px 0;
        border-top: 1px solid rgba(255,255,255,0.15);
      }


      /* Subsection styling (nested inside another section) */
details.section details.section {
  margin-left: 0px;
  margin-top: 8px;
  padding: 10px 12px;
  border-left: 3px solid rgba(255,255,255,0.18);
  border-top: none;
  background: rgba(255,255,255,0.03);
  border-radius: 8px;
}

/* Slightly smaller summary for subsections */
details.section details.section > summary {
  font-size: 12px;
  font-weight: 700;
  opacity: 0.9;
}
      .check {
        display: grid;
        grid-template-columns: auto 1fr;
        gap: 10px;
        align-items: center;
        margin: 8px 0;
      }
      .check.withSideStats {
        grid-template-columns: auto 1fr auto;
        gap: 10px 12px;
      }
      .check input[type="checkbox"] { width: 16px; height: 16px; }
      .check label { display: block; font-size: 13px; line-height: 1.2; }
      .miniStats {
        display: grid;
        grid-template-rows: 1fr 1fr;
        gap: 4px;
        min-width: 100px;
        transform: translateX(-70px);
      }
      #titleBlockPanel #meshMiniStats {
        transform: none;
        min-width: 0;
        width: 100%;
        grid-template-rows: repeat(3, auto);
      }
      #toolbarTopRow {
        display: grid;
        grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
        gap: 10px;
        align-items: start;
        margin: 8px 0 0 0;
      }
      #toolbarTopActions {
        display: grid;
        grid-template-columns: 1fr;
        gap: 8px;
      }
      #toolbarTopActions > button {
        width: 100%;
      }
      #titleStatsToggleBtn {
        width: 100%;
        min-height: 16px;
        padding: 2px 6px;
        border-radius: 6px;
        border: 1px solid rgba(255,255,255,0.10);
        background: rgba(255,255,255,0.04);
        color: #e8e8ea;
        font-size: 11px;
        line-height: 1;
        text-align: center;
        font-variant-numeric: tabular-nums;
      }
      #titleStatsToggleBtn[aria-pressed="true"] {
        background: rgba(255,255,255,0.10);
        border-color: rgba(255,255,255,0.18);
      }
      #toolbarMinimizeEdgeBtn {
        position: fixed;
        left: 16px;
        top: 110px;
        z-index: 60;
        width: 28px;
        height: 28px;
        padding: 0;
        border-radius: 8px;
        border: 1px solid rgba(255,255,255,0.14);
        background: rgba(255,255,255,0.05);
        color: #e8e8ea;
        font-size: 14px;
        line-height: 1;
        display: grid;
        place-items: center;
        transition: left 220ms ease, top 220ms ease, background-color 160ms ease, box-shadow 160ms ease;
      }
      #toolbarMinimizeEdgeBtn:hover {
        background: rgba(255,255,255,0.10);
      }
      body.toolbar-collapsed #toolbarMinimizeEdgeBtn {
        background: rgba(255,255,255,0.12);
        box-shadow: 0 6px 16px rgba(0,0,0,0.35);
      }
      @media (prefers-reduced-motion: reduce) {
        #toolbarMinimizeEdgeBtn {
          transition: none;
        }
      }
      #titleStatsPanel {
        display: none;
        margin-top: 10px;
        padding-top: 8px;
        border-top: 1px solid rgba(255,255,255,0.10);
      }
      #titleStatsPanel.open {
        display: block;
      }
      #titleBlockPanel.statsExpanded #titleStatsPanel.open {
        flex: 1 1 auto;
        min-height: 0;
        overflow: auto;
        overscroll-behavior: contain;
      }
      .titleStatsList {
        display: grid;
        gap: 6px;
      }
      .titleStatsRow {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 8px;
        align-items: center;
        min-height: 16px;
        line-height: 1.1;
        font-size: 11px;
        border-radius: 6px;
        padding: 4px 6px;
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.10);
        font-variant-numeric: tabular-nums;
      }
      .titleStatsKey {
        opacity: 0.75;
      }
      .titleStatsVal {
        text-align: right;
        opacity: 0.95;
        white-space: nowrap;
      }
      .miniStatsRow {
        display: grid;
        grid-template-columns: auto 1fr;
        align-items: center;
        gap: 6px;
        min-height: 16px;
        line-height: 1;
        font-size: 11px;
        border-radius: 6px;
        padding: 2px 6px;
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.10);
        font-variant-numeric: tabular-nums;
      }
      .miniStatsKey {
        opacity: 0.75;
        text-transform: lowercase;
      }
      .miniStatsVal {
        text-align: right;
        opacity: 0.95;
      }

      /* Value input boxes */
      .valInput {
        width: 78px;
        padding: 4px 6px;
        border-radius: 8px;
        border: 1px solid rgba(255,255,255,0.22);
        background: rgba(0,0,0,0.25);
        color: #e8e8ea;
        font-size: 13px;
        text-align: right;
        font-variant-numeric: tabular-nums;
        outline: none;
        box-sizing: border-box;
      }
      .valInput:focus { border-color: rgba(255,255,255,0.45); }
      .valInput:disabled { opacity: 0.65; }

      /* Param rows */
      .paramRow { margin: 10px 0; }
      .paramTop {
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        margin-bottom: 6px;
      }
      .paramTag {
        font-size: 11px;
        letter-spacing: 0.08em;
        opacity: 0.75;
        text-transform: uppercase;
      }
      .paramName {
        font-size: 12px;
        opacity: 0.95;
      }
      .paramBody {
        display: flex;
        gap: 10px;
        align-items: center;
      }
      .paramBody input[type="range"] { flex: 1 1 auto; width: auto; }

      /* DEBUG (inside its own panel now) */
      #debug {
        margin: 0;
        padding: 0;

        height: 260px;
        min-height: 140px;
        max-height: 70vh;

        resize: vertical;
        overflow: hidden;

        display: flex;
        flex-direction: column;
        gap: 6px;

        font-size: 12px;
        line-height: 1.35;
        opacity: 0.95;
        box-sizing: border-box;
      }
      #debug.collapsed {
        height: auto;
        min-height: 0;
        max-height: none;
        resize: none;
      }

      #debugHeader { font-weight: 700; opacity: 0.95; flex: 0 0 auto; position: relative; top: 2px; }

      #log {
        flex: 1 1 auto;
        min-height: 0;
        margin: 0;
        padding: 8px;
        background: rgba(0,0,0,0.35);
        border-radius: 8px;

        overflow: auto;
        white-space: pre-wrap;
        word-break: break-word;

        box-sizing: border-box;
      }
      #debug.collapsed #log {
        flex: 0 0 auto;
        min-height: 0;
        max-height: calc(1.5em + 7px);
        overflow: hidden;
        white-space: nowrap;
        text-overflow: ellipsis;
      }

      .panelActionRow {
        display: flex;
        gap: 6px;
        justify-content: flex-end;
        margin: 4px 0 8px 0;
      }
      .panelActionBtn {
        padding: 4px 8px;
        min-width: 34px;
        border-radius: 6px;
        border: 1px solid rgba(255,255,255,0.15);
        background: rgba(255,255,255,0.05);
        color: #e8e8ea;
        font-size: 11px;
        line-height: 1;
        cursor: pointer;
      }
      .panelActionBtn:hover {
        background: rgba(255,255,255,0.1);
      }
      .panelActionBtn[aria-pressed="true"] {
        background: rgba(255,255,255,0.14);
      }

      .layersHeaderRow {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
        margin: 4px 0 8px 0;
      }
      .layersGroupTitle {
        font-size: 11px;
        letter-spacing: 0.06em;
        text-transform: uppercase;
        opacity: 0.72;
        font-weight: 700;
      }
      .layersList {
        display: grid;
        gap: 6px;
      }
      .layerRow {
        display: grid;
        grid-template-columns: auto auto 1fr auto;
        align-items: center;
        gap: 8px;
        width: 100%;
        box-sizing: border-box;
        padding: 6px 8px;
        border-radius: 8px;
        border: 1px solid rgba(255,255,255,0.10);
        background: rgba(255,255,255,0.02);
      }
      .layerRow.model {
        grid-template-columns: 1fr;
        cursor: pointer;
        color: #e8e8ea;
        text-align: left;
      }
      .layerRow.model:hover {
        background: rgba(255,255,255,0.05);
        border-color: rgba(255,255,255,0.16);
      }
      .layerRow.model.active {
        background: rgba(255,255,255,0.08);
        border-color: rgba(255,255,255,0.26);
      }
      .layerRow.ref.off {
        opacity: 0.6;
      }
      .layerRow.ref.group {
        background: rgba(255,255,255,0.035);
        border-color: rgba(255,255,255,0.14);
      }
      .layerRow.ref.sub {
        margin-left: 14px;
        width: calc(100% - 14px);
        background: rgba(255,255,255,0.015);
        border-color: rgba(255,255,255,0.08);
      }
      .layerRow.ref.hidden {
        display: none;
      }
      .layerRowLabel {
        font-size: 12px;
        line-height: 1.2;
        text-align: left;
        color: inherit;
      }
      .eyeBtn,
      .layerRowActionBtn,
      .layerRowMaterialBtn {
        width: 28px;
        height: 24px;
        padding: 0;
        border-radius: 7px;
        border: 1px solid rgba(255,255,255,0.14);
        background: rgba(255,255,255,0.04);
        color: #e8e8ea;
        display: grid;
        place-items: center;
        line-height: 1;
        font-size: 13px;
      }
      .eyeBtn.off {
        opacity: 0.55;
        background: rgba(0,0,0,0.18);
      }
      .layerRowActionBtn:hover {
        background: rgba(255,255,255,0.08);
      }
      .layerRowMaterialBtn:hover {
        background: rgba(255,255,255,0.08);
      }
      .layerRowActionBtn:disabled,
      .layerRowMaterialBtn:disabled {
        opacity: 0.45;
        cursor: not-allowed;
      }
      .layerRowMaterialBtn {
        font-size: 12px;
      }
      #materialsFloatPanel {
        z-index: 2100;
        width: min(360px, calc(100vw - 32px));
        min-width: 300px;
        min-height: 260px;
        max-height: calc(var(--app-vh, 100dvh) - 32px);
        color: #e8e8ea;
      }
      #materialsFloatPanel[hidden] {
        display: none !important;
      }
      #materialsBody {
        display: grid;
        gap: 8px;
      }
      #materialsTitle {
        font-size: 13px;
        font-weight: 700;
        margin: 0;
        color: #e8e8ea;
      }
      #materialsHeader {
        color: #e8e8ea;
      }
      #materialsCloseBtn {
        min-width: 28px;
        min-height: 24px;
        padding: 0 8px;
      }
      #materialsFocusText {
        font-size: 12px;
        opacity: 0.85;
        color: #e8e8ea;
      }
      #materialsPartSection {
        display: grid;
        gap: 4px;
      }
      .materialsSectionLabel {
        font-size: 11px;
        letter-spacing: 0.04em;
        text-transform: uppercase;
        opacity: 0.82;
        color: #e8e8ea;
      }
      .materialsPartListWrap {
        width: 100%;
        height: 102px;
        min-height: 72px;
        max-height: 260px;
        border-radius: 8px;
        border: 1px solid rgba(255,255,255,0.16);
        background: rgba(255,255,255,0.06);
        box-sizing: border-box;
        padding: 4px;
        overflow: auto;
        resize: vertical;
        overscroll-behavior: contain;
      }
      #materialsPartList {
        display: grid;
        gap: 4px;
      }
      .materialsPartBtn {
        width: 100%;
        min-height: 28px;
        border-radius: 7px;
        border: 1px solid rgba(255,255,255,0.14);
        background: rgba(255,255,255,0.04);
        color: #e8e8ea;
        text-align: left;
        padding: 4px 8px;
        box-sizing: border-box;
        font-size: 12px;
        line-height: 1.2;
      }
      .materialsPartBtn[aria-pressed="true"] {
        background: rgba(255,255,255,0.20);
        border-color: rgba(255,255,255,0.32);
      }
      #materialsTuneSection {
        padding: 8px;
        border: 1px solid rgba(255,255,255,0.12);
        border-radius: 8px;
        background: rgba(255,255,255,0.02);
        display: grid;
        gap: 8px;
      }
      .materialsColorRow {
        display: grid;
        grid-template-columns: auto 1fr;
        gap: 8px;
        align-items: center;
      }
      #materialsColorPicker {
        width: 52px;
        height: 30px;
        border: 1px solid rgba(255,255,255,0.18);
        border-radius: 6px;
        background: transparent;
        padding: 0;
      }
      #materialsColorHex {
        width: 100%;
        height: 30px;
        border: 1px solid rgba(255,255,255,0.16);
        border-radius: 8px;
        background: rgba(255,255,255,0.06);
        color: #e8e8ea;
        padding: 0 8px;
        box-sizing: border-box;
      }
      #materialsNewBtn {
        width: 100%;
      }
      .materialsListWrap {
        border: 1px solid rgba(255,255,255,0.10);
        border-radius: 8px;
        padding: 6px;
        background: rgba(255,255,255,0.02);
        max-height: 220px;
        overflow: auto;
        overscroll-behavior: contain;
      }
      .materialsList {
        display: grid;
        gap: 6px;
      }
      .materialPresetBtn {
        width: 100%;
        text-align: left;
      }
      .materialPresetBtn[aria-pressed="true"] {
        background: rgba(255,255,255,0.14);
      }
      .materialTuneRow {
        display: grid;
        gap: 4px;
      }
      .materialTuneLabel {
        font-size: 11px;
        opacity: 0.85;
        color: #e8e8ea;
      }
      .materialTuneRange {
        width: 100%;
        accent-color: #8fb5ff;
      }

      .radioRow {
        display: grid;
        grid-template-columns: auto 1fr auto;
        gap: 8px;
        align-items: center;
        margin: 8px 0;
      }
      #radioSection > .sectionMeta {
        margin-bottom: 4px;
      }
      #radioSection > .panelActionRow {
        margin: 0;
      }
      #radioSection > .radioRow {
        margin-top: 4px;
      }
      .radioTiny {
        font-size: 11px;
        opacity: 0.85;
      }
      #radioScIframe {
        position: absolute;
        width: 1px;
        height: 1px;
        opacity: 0;
        pointer-events: none;
        border: 0;
      }

      .floatHost {
        position: fixed;
        top: 24px;
        right: 24px;
        z-index: 2000;
        width: min(520px, calc(100vw - 32px));
        max-height: calc(var(--app-vh, 100dvh) - 32px);
        overflow: hidden;
        background: rgba(20,20,24,0.95);
        color: #e8e8ea;
        border: 1px solid rgba(255,255,255,0.14);
        border-radius: 12px;
        box-shadow: 0 14px 40px rgba(0,0,0,0.45);
        padding: 10px 12px;
        cursor: default;
        min-width: 320px;
        min-height: 180px;
        resize: both;
        display: flex;
        flex-direction: column;
      }
      .floatHostHeader {
        flex: 0 0 auto;
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        gap: 8px;
        background: rgba(20,20,24,0.95);
        border-bottom: 1px solid rgba(255,255,255,0.08);
        margin-bottom: 8px;
        padding: 2px 0 8px 0;
      }
      .floatHostTitleWrap {
        min-width: 0;
      }
      .floatHostTitle {
        font-size: 13px;
        font-weight: 800;
        letter-spacing: 0.2px;
        line-height: 1.2;
      }
      .floatHostSub {
        font-size: 12px;
        opacity: 0.8;
        margin-top: 4px;
      }
      .floatHostHeader .panelActionRow {
        margin: 0;
        flex: 0 0 auto;
      }
      .floatHostBody {
        flex: 1 1 0;
        min-height: 0;
        overflow: auto;
        padding-right: 2px;
      }
      .floatHostBody > details.section {
        margin-top: 0;
        border-top: none;
        padding-top: 0;
      }
      .floatHostBody > details.section > summary,
      .floatHostBody > details.section > .sectionMeta,
      .floatHostBody > details.section > .panelActionRow {
        display: none !important;
      }
      .floatHostBody > #debugPanel #debugHeader {
        display: none;
      }
      .floatToolbarStub {
        opacity: 0.82;
      }
      .floatToolbarStub > summary {
        cursor: pointer;
      }
      .floatHost.dragging {
        cursor: grabbing;
      }

      /* Gizmo viewport resize handle (overlay on canvas, bottom-left corner of gizmo viewport) */
      #gizmoViewportResizeHandle {
        position: fixed;
        left: 0;
        top: 0;
        z-index: 1200;
        width: 14px;
        height: 14px;
        box-sizing: border-box;
        border-radius: 3px;
        border: 1px solid rgba(255,255,255,0.12);
        background:
          linear-gradient(135deg,
            transparent 0 34%,
            rgba(255,255,255,0.38) 34% 42%,
            transparent 42% 54%,
            rgba(255,255,255,0.28) 54% 62%,
            transparent 62% 74%,
            rgba(255,255,255,0.20) 74% 82%,
            transparent 82% 100%),
          rgba(20,20,24,0.78);
        box-shadow: 0 6px 14px rgba(0,0,0,0.32);
        cursor: nesw-resize;
        user-select: none;
        -webkit-user-select: none;
      }
      #gizmoCardinalUpBadge {
        position: fixed;
        left: 0;
        top: 0;
        z-index: 1200;
        min-width: 44px;
        padding: 2px 6px;
        box-sizing: border-box;
        border-radius: 6px;
        border: 1px solid rgba(255,255,255,0.16);
        background: rgba(20,20,24,0.82);
        color: #e8e8ea;
        font-size: 10px;
        line-height: 1.1;
        text-align: center;
        font-variant-numeric: tabular-nums;
        user-select: none;
        -webkit-user-select: none;
        pointer-events: auto;
        cursor: pointer;
      }
      #gizmoToggleBtn {
        position: fixed;
        left: 0;
        top: 0;
        z-index: 1200;
        min-width: 52px;
        padding: 2px 6px;
        box-sizing: border-box;
        border-radius: 6px;
        border: 1px solid rgba(255,255,255,0.16);
        background: rgba(20,20,24,0.82);
        color: #e8e8ea;
        font-size: 10px;
        line-height: 1.1;
        text-align: center;
        font-variant-numeric: tabular-nums;
        user-select: none;
        -webkit-user-select: none;
        pointer-events: auto;
        cursor: pointer;
      }
      #gizmoToggleBtn[aria-pressed="false"] {
        opacity: 0.75;
      }
      #gizmoGizmoPanel {
        position: fixed;
        left: 0;
        top: 0;
        z-index: 1200;
        width: 108px;
        display: none;
        grid-template-columns: 1fr;
        gap: 4px;
        padding: 6px;
        border-radius: 8px;
        border: 1px solid rgba(255,255,255,0.14);
        background: rgba(20,20,24,0.92);
        box-sizing: border-box;
        max-height: calc(var(--app-vh, 100dvh) - 16px);
        overflow: auto;
        overscroll-behavior: contain;
      }
      #gizmoGizmoPanel.open {
        display: grid;
      }
      #gizmoFpsBadge {
        position: fixed;
        left: 0;
        top: 0;
        z-index: 1200;
        min-width: 44px;
        height: 18px;
        padding: 0 6px;
        box-sizing: border-box;
        border-radius: 6px;
        border: 1px solid rgba(255,255,255,0.16);
        background: rgba(20,20,24,0.82);
        color: #e8e8ea;
        font-size: 10px;
        line-height: 16px;
        text-align: center;
        font-variant-numeric: tabular-nums;
        user-select: none;
        -webkit-user-select: none;
        pointer-events: none;
      }
      #gizmoRollCwBtn,
      #gizmoRollCcwBtn {
        position: fixed;
        left: 0;
        top: 0;
        z-index: 1200;
        width: 24px;
        height: 20px;
        padding: 0;
        border-radius: 6px;
        border: 1px solid rgba(255,255,255,0.16);
        background: rgba(20,20,24,0.82);
        color: #e8e8ea;
        font-size: 12px;
        line-height: 1;
        text-align: center;
        cursor: pointer;
      }
      .gizmoModeBtn {
        position: fixed;
        left: 0;
        top: 0;
        z-index: 1200;
        min-width: 52px;
        height: 20px;
        padding: 0 6px;
        border-radius: 6px;
        border: 1px solid rgba(255,255,255,0.16);
        background: rgba(20,20,24,0.82);
        color: #e8e8ea;
        font-size: 10px;
        line-height: 1;
        text-align: center;
        cursor: pointer;
      }
      .gizmoModeBtn[aria-pressed="true"] {
        background: rgba(255,255,255,0.16);
        border-color: rgba(255,255,255,0.30);
      }
      #gizmoGravityRange {
        position: fixed;
        left: 0;
        top: 0;
        z-index: 1200;
        width: 108px;
        accent-color: #8fb5ff;
      }
      .gizmoSliderLabel {
        position: fixed;
        left: 0;
        top: 0;
        z-index: 1200;
        width: 108px;
        color: #d8dbe2;
        font-size: 10px;
        line-height: 1;
        letter-spacing: 0.02em;
        text-align: left;
        pointer-events: none;
        user-select: none;
        -webkit-user-select: none;
      }
      #gizmoToolbarResizeHandle {
        position: fixed;
        left: 0;
        top: 0;
        z-index: 1200;
        width: 14px;
        height: 14px;
        box-sizing: border-box;
        border-radius: 3px;
        border: 1px solid rgba(255,255,255,0.12);
        background:
          linear-gradient(135deg,
            transparent 0 34%,
            rgba(255,255,255,0.38) 34% 42%,
            transparent 42% 54%,
            rgba(255,255,255,0.28) 54% 62%,
            transparent 62% 74%,
            rgba(255,255,255,0.20) 74% 82%,
            transparent 82% 100%),
          rgba(20,20,24,0.78);
        box-shadow: 0 6px 14px rgba(0,0,0,0.32);
        cursor: nwse-resize;
        user-select: none;
        -webkit-user-select: none;
      }
      #gizmoDecayRange {
        position: fixed;
        left: 0;
        top: 0;
        z-index: 1200;
        width: 108px;
        accent-color: #8fb5ff;
      }
      #gizmoSpinToggleBtn,
      #gizmoZoomStopsInertiaBtn {
        position: fixed;
        left: 0;
        top: 0;
        z-index: 1200;
        width: 108px;
        height: 20px;
        border-radius: 6px;
        border: 1px solid rgba(255,255,255,0.16);
        background: rgba(20,20,24,0.82);
        color: #e8e8ea;
        font-size: 10px;
        line-height: 1;
        text-align: center;
        cursor: pointer;
      }
      #gizmoSpinToggleBtn[aria-pressed="true"],
      #gizmoZoomStopsInertiaBtn[aria-pressed="true"] {
        background: rgba(255,255,255,0.16);
        border-color: rgba(255,255,255,0.30);
      }
      #gizmoViewBtn {
        position: fixed;
        left: 0;
        top: 0;
        z-index: 1200;
        width: 108px;
        height: 20px;
        border-radius: 6px;
        border: 1px solid rgba(255,255,255,0.16);
        background: rgba(20,20,24,0.82);
        color: #e8e8ea;
        font-size: 10px;
        line-height: 1;
        text-align: center;
        cursor: pointer;
      }
      #gizmoControlsBtn {
        position: fixed;
        left: 0;
        top: 0;
        z-index: 1200;
        width: 108px;
        height: 20px;
        border-radius: 6px;
        border: 1px solid rgba(255,255,255,0.16);
        background: rgba(20,20,24,0.82);
        color: #e8e8ea;
        font-size: 10px;
        line-height: 1;
        text-align: center;
        cursor: pointer;
      }
      #gizmoControlsBtn[aria-pressed="true"] {
        background: rgba(255,255,255,0.16);
        border-color: rgba(255,255,255,0.30);
      }
      #gizmoViewPanel {
        position: fixed;
        left: 0;
        top: 0;
        z-index: 1200;
        width: 108px;
        display: none;
        grid-template-columns: 1fr;
        gap: 6px;
        padding: 6px;
        border-radius: 8px;
        border: 1px solid rgba(255,255,255,0.14);
        background: rgba(20,20,24,0.92);
        box-sizing: border-box;
        max-height: calc(var(--app-vh, 100dvh) - 16px);
        overflow: auto;
        overscroll-behavior: contain;
      }
      #gizmoViewPanel.starsOpen {
        width: 168px;
      }
      #gizmoViewPanel.open {
        display: grid;
      }
      #gizmoControlsPanel {
        position: fixed;
        left: 0;
        top: 0;
        z-index: 1200;
        width: 108px;
        display: none;
        grid-template-columns: 1fr 1fr;
        gap: 4px;
        padding: 6px;
        border-radius: 8px;
        border: 1px solid rgba(255,255,255,0.14);
        background: rgba(20,20,24,0.92);
        box-sizing: border-box;
        max-height: calc(var(--app-vh, 100dvh) - 16px);
        overflow: auto;
        overscroll-behavior: contain;
      }
      #gizmoControlsPanel.open {
        display: grid;
      }
      #gizmoControlsPanel .gizmoModeBtn,
      #gizmoControlsPanel #gizmoGravityLabel,
      #gizmoControlsPanel #gizmoGravityRange,
      #gizmoControlsPanel #gizmoDecayLabel,
      #gizmoControlsPanel #gizmoDecayRange,
      #gizmoControlsPanel #gizmoSpinToggleBtn,
      #gizmoControlsPanel #gizmoSpinSpeedLabel,
      #gizmoControlsPanel #gizmoSpinSpeedRange,
      #gizmoControlsPanel #gizmoZoomStopsInertiaBtn {
        position: static;
        left: auto;
        top: auto;
      }
      #gizmoControlsPanel #gizmoGravityLabel,
      #gizmoControlsPanel #gizmoGravityRange,
      #gizmoControlsPanel #gizmoDecayLabel,
      #gizmoControlsPanel #gizmoDecayRange,
      #gizmoControlsPanel #gizmoSpinToggleBtn,
      #gizmoControlsPanel #gizmoSpinSpeedLabel,
      #gizmoControlsPanel #gizmoSpinSpeedRange,
      #gizmoControlsPanel #gizmoZoomStopsInertiaBtn {
        grid-column: 1 / -1;
        width: 100% !important;
      }
      #gizmoControlsPanel .gizmoModeBtn {
        width: 100% !important;
        min-width: 0;
      }
      .gizmoSubSection {
        border: 1px solid rgba(255,255,255,0.14);
        border-radius: 6px;
        padding: 4px;
        background: rgba(255,255,255,0.02);
      }
      .gizmoSubSection > summary {
        cursor: pointer;
        font-size: 10px;
        line-height: 1.2;
        font-weight: 700;
        color: #d8dbe2;
        user-select: none;
      }
      .gizmoSubSection > summary::-webkit-details-marker {
        display: none;
      }
      #gizmoScenesSection > summary {
        display: block;
        width: 100%;
        height: 20px;
        padding: 0 6px;
        box-sizing: border-box;
        border-radius: 6px;
        border: 1px solid rgba(255,255,255,0.16);
        background: rgba(20,20,24,0.82);
        color: #e8e8ea;
        font-size: 10px;
        line-height: 18px;
        font-weight: 600;
        text-align: center;
      }
      #gizmoScenesSection[open] > summary {
        background: rgba(255,255,255,0.16);
        border-color: rgba(255,255,255,0.30);
      }
      .gizmoSubSectionBody {
        display: grid;
        gap: 6px;
        margin-top: 6px;
      }
      .gizmoViewActionBtn {
        width: 100%;
        height: 20px;
        padding: 0 6px;
        border-radius: 6px;
        border: 1px solid rgba(255,255,255,0.16);
        background: rgba(20,20,24,0.82);
        color: #e8e8ea;
        font-size: 10px;
        line-height: 1;
        text-align: center;
        cursor: pointer;
      }
      .gizmoViewActionBtn[aria-pressed="true"] {
        background: rgba(255,255,255,0.16);
        border-color: rgba(255,255,255,0.30);
      }
      #gizmoStarsControls {
        display: none;
        gap: 4px;
      }
      #gizmoStarsControls.open {
        display: grid;
      }
      #gizmoNebulaControls {
        display: none;
        gap: 4px;
      }
      #gizmoNebulaControls.open {
        display: grid;
      }
      #gizmoSwarmControls {
        display: none;
        gap: 4px;
      }
      #gizmoSwarmControls.open {
        display: grid;
      }
      #gizmoGridControls {
        display: none;
        gap: 4px;
      }
      #gizmoGridControls.open {
        display: grid;
      }
      .gizmoStarsLabel {
        font-size: 9px;
        line-height: 1;
        opacity: 0.85;
        color: #d8dbe2;
      }
      .gizmoStarsRange {
        width: 100%;
        accent-color: #8fb5ff;
      }
      .gizmoSliderRow {
        display: grid;
        grid-template-columns: minmax(0, 4fr) minmax(34px, 1fr);
        align-items: center;
        gap: 6px;
      }
      .gizmoSliderVal {
        font-size: 9px;
        line-height: 1;
        text-align: right;
        color: #d8dbe2;
        opacity: 0.9;
        font-variant-numeric: tabular-nums;
        white-space: nowrap;
      }
      #gizmoViewFovRange {
        width: 100%;
        accent-color: #8fb5ff;
      }
      #gizmoSpinSpeedRange {
        position: fixed;
        left: 0;
        top: 0;
        z-index: 1200;
        width: 108px;
        accent-color: #8fb5ff;
        display: none;
      }
      #gizmoSpinSpeedLabel {
        display: none;
      }

      body.toolbar-collapsed #controlsPanel {
        display: none;
      }
      body.toolbar-collapsed #ui {
        clip-path: inset(0 100% 0 0 round 12px);
        opacity: 0;
        pointer-events: none;
      }
      @media (prefers-reduced-motion: reduce) {
        #ui {
          transition: none;
        }
      }

      @media (max-width: 900px), (pointer: coarse) {
        #ui {
          top: max(8px, env(safe-area-inset-top));
          left: max(8px, env(safe-area-inset-left));
          width: min(96vw, 400px);
          max-width: min(96vw, 420px);
          min-width: min(280px, calc(100vw - 16px));
          resize: none;
        }
        #titleBlockPanel.statsExpanded {
          resize: none;
        }
        #debug {
          resize: none;
          max-height: 50vh;
        }
        .floatHost {
          resize: none;
        }
        .panelActionBtn {
          min-width: 40px;
          min-height: 30px;
        }
        button {
          min-height: 38px;
        }
        body.mobile-layout #gizmoToggleBtn,
        body.mobile-layout #gizmoCardinalUpBadge,
        body.mobile-layout #gizmoViewBtn,
        body.mobile-layout #gizmoControlsBtn {
          height: 22px !important;
          min-height: 22px !important;
          padding: 2px 6px !important;
          line-height: 1.1 !important;
        }
        .check input[type="checkbox"] {
          width: 22px;
          height: 22px;
        }
        body.mobile-layout #gizmoRollCwBtn,
        body.mobile-layout #gizmoRollCcwBtn,
        body.mobile-layout #gizmoViewPanel .gizmoSubSection:not(:first-child) {
          display: none !important;
        }
        body.mobile-layout #gizmoToolbarResizeHandle,
        body.mobile-layout #gizmoViewportResizeHandle {
          display: block !important;
          width: 12px;
          height: 12px;
          border-radius: 4px;
        }
        body.mobile-layout #gizmoToolbarResizeHandle {
          cursor: ew-resize;
        }
        body.mobile-layout #gizmoViewportResizeHandle {
          cursor: nesw-resize;
        }
        body.mobile-layout #gizmoViewPanel {
          width: min(220px, 62vw);
        }
        body.mobile-layout.mobile-gizmo-collapsed #gizmoToggleBtn,
        body.mobile-layout.mobile-gizmo-collapsed #gizmoViewBtn,
        body.mobile-layout.mobile-gizmo-collapsed #gizmoControlsBtn,
        body.mobile-layout.mobile-gizmo-collapsed #gizmoCardinalUpBadge,
        body.mobile-layout.mobile-gizmo-collapsed #gizmoFpsBadge {
          width: 24px !important;
          min-width: 24px !important;
          height: 78px !important;
          min-height: 78px !important;
          padding: 4px 2px !important;
          border-radius: 6px !important;
          line-height: 1.05 !important;
          letter-spacing: 0.02em !important;
          opacity: 0.82;
          writing-mode: vertical-rl;
          text-orientation: mixed;
          transform: rotate(180deg);
          transition: width 150ms ease, height 150ms ease, opacity 150ms ease, transform 150ms ease;
        }
        body.mobile-layout.mobile-gizmo-collapsed #gizmoToggleBtn {
          font-size: 10px !important;
          pointer-events: auto !important;
        }
        body.mobile-layout.mobile-gizmo-collapsed #gizmoViewBtn {
          font-size: 10px !important;
          pointer-events: auto !important;
        }
        body.mobile-layout.mobile-gizmo-collapsed #gizmoControlsBtn {
          font-size: 10px !important;
          pointer-events: auto !important;
        }
        body.mobile-layout.mobile-gizmo-collapsed #gizmoCardinalUpBadge,
        body.mobile-layout.mobile-gizmo-collapsed #gizmoFpsBadge {
          display: none !important;
        }
        body.mobile-layout.mobile-gizmo-collapsed #gizmoViewPanel {
          display: none !important;
        }
      }
    </style>
  </head>

  <body>
    <div id="bootLoadingOverlay" role="status" aria-live="polite" aria-label="Loading model">
      <div class="bootLoadingCard">
        <div class="bootLoadingSpinner" aria-hidden="true"></div>
        <div class="bootLoadingTitle">Loading model</div>
        <div class="bootLoadingSub">Preparing geometry and camera...</div>
        <div class="bootLoadingProgress" aria-label="Model loading progress">
          <div id="bootLoadingProgressFill" class="bootLoadingProgressFill" aria-hidden="true"></div>
          <div id="bootLoadingProgressText" class="bootLoadingProgressText">0%</div>
        </div>
        <div id="bootLoadingDetail" class="bootLoadingDetail">Files 0/2 | 0.00 / -- MB | main: bootstrapping UI</div>
        <div id="bootLoadingLog" class="bootLoadingLog" aria-label="Loading activity log"></div>
      </div>
    </div>
    <div id="ui">
      <!-- BOX 1: Title + Version + Toolbar -->
      <div id="titleBlockPanel" class="panelBox">
        <div id="titlePanel">
          <div id="appTitle">ParaHook Generator</div>
          <div id="appVersion">v0.16.3</div>
        </div>

        <div class="row header">
          <div id="status">
            <div id="statusProgressFill" aria-hidden="true"></div>
            <span id="statusText">idle</span>
          </div>
        </div>

        <!-- MODEL TOGGLE -->
        <input id="modelEnabled" type="checkbox" checked hidden />
        <div id="toolbarTopRow">
          <div id="toolbarTopActions">
            <button id="rebuild" type="button">Rebuild</button>
            <button id="modelLivePauseBtn" type="button" class="secondary">Live</button>
          </div>
          <div id="meshMiniStats" class="miniStats" aria-label="Mesh statistics">
            <div class="miniStatsRow">
              <span class="miniStatsKey">verts =</span>
              <span id="meshVerts" class="miniStatsVal">-</span>
            </div>
            <div class="miniStatsRow">
              <span class="miniStatsKey">tris =</span>
              <span id="meshTris" class="miniStatsVal">-</span>
            </div>
            <button id="titleStatsToggleBtn" type="button" aria-pressed="false" title="Show stats">Show Stats</button>
          </div>
        </div>
        <div id="titleStatsPanel" aria-hidden="true">
          <div class="titleStatsList" aria-label="Title block stats">
            <div class="titleStatsRow"><span class="titleStatsKey">Build Time (ms)</span><span id="titleStatBuildMs" class="titleStatsVal">-</span></div>
            <div class="titleStatsRow"><span class="titleStatsKey">Status / Queue</span><span id="titleStatQueue" class="titleStatsVal">idle</span></div>
            <div class="titleStatsRow"><span class="titleStatsKey">Mesh Size (MB)</span><span id="titleStatMeshMB" class="titleStatsVal">-</span></div>
            <div class="titleStatsRow"><span class="titleStatsKey">Rebuild Mode</span><span id="titleStatRebuildMode" class="titleStatsVal">Live</span></div>
            <div class="titleStatsRow"><span class="titleStatsKey">Build Count</span><span id="titleStatBuildCount" class="titleStatsVal">0</span></div>
            <div class="titleStatsRow"><span class="titleStatsKey">Camera Dist</span><span id="titleStatCameraDist" class="titleStatsVal">-</span></div>
            <div class="titleStatsRow"><span class="titleStatsKey">Active Parts</span><span id="titleStatActiveParts" class="titleStatsVal">-</span></div>
            <div class="titleStatsRow"><span class="titleStatsKey">Last Rebuild Source</span><span id="titleStatLastSource" class="titleStatsVal">startup</span></div>
          </div>

          <div id="debugPanel" class="panelBox">
            <div id="debug">
              <div id="debugHeader" style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
                <span>Debug</span>
                <span style="display:flex; gap:6px;">
                  <button id="debugFloatToggle" type="button" class="panelActionBtn" aria-pressed="false" aria-label="Float panel" title="Float panel">▣</button>
                  <button id="debugWindowToggle" type="button" class="panelActionBtn" aria-pressed="false" aria-label="Open panel in window" title="Open panel in window">⇱</button>
                </span>
              </div>
              <pre id="log"></pre>
            </div>
          </div>
        </div>
      </div>

      <!-- BOX 2: Controls (scrollable) -->
      <div id="controlsPanel" class="panelBox">
        <div id="controlsPanelTitle">Toolbar</div>
        <form id="controls" autocomplete="off">

          <!-- BUTTONS (collapsible group) -->
          <details class="section">
            <summary>Buttons</summary>
            <div class="sectionMeta">  <!-- wip desription - add here in future --></div>
            <div class="btnStack">
              <button id="exportStl" type="button" class="secondary">Export STL</button>
              <button id="exportStep" type="button" class="secondary">Export STEP</button>
              <button id="loadSettings" type="button" class="secondary">Load Settings</button>
              <button id="exportSettings" type="button" class="secondary">Export Settings</button>
            </div>
          </details>

          <!-- REFERENCE (collapsible group) -->
          <details class="section">
            <summary>Reference</summary>

            <!-- Notes -->
            <details class="section">
              <summary>-Releases</summary>
              <details class="section" open>
                <summary>v0.16.3</summary>
                <details class="section">
                  <summary>Added</summary>
                  <div class="sectionMeta">1. Mobile/desktop toolbar collapse redesign: external edge button, smooth dock animation, and full toolbar hide/show behavior.</div>
                  <div class="sectionMeta">2. Gizmo mobile optimization: compact 50% startup mode on mobile with tap-to-expand interaction.</div>
                  <div class="sectionMeta">3. Gizmo UX updates: right-edge anchoring, scrollable Gizmo/View/Controls panels, and viewport-aware panel sizing to prevent off-screen clipping.</div>
                  <div class="sectionMeta">4. Startup experience: blocking boot loading overlay added until initial model ready/error state.</div>
                  <div class="sectionMeta">5. Camera default alignment updates: startup/reset framing adjusted to isometric -X,-Y orientation.</div>
                </details>
              </details>

              <details class="section">
                <summary>v0.15.2</summary>
                <details class="section">
                  <summary>Added</summary>
                  <div class="sectionMeta">1. Restored missing/truncated UI tail in index.html (Parahook Parameters wrapper, Layers, Radio, section cut mode radios).</div>
                  <div class="sectionMeta subNote">1.1 Rebuilt panel pop-out controls (Float + Window) for Parahook Parameters, Layers, Radio, and Debug.</div>
                  <div class="sectionMeta">2. Restored/updated Layers system Reference Views with grouped Control point Viz parent + Baseplate/Profile A/B/C child rows.</div>
                  <div class="sectionMeta subNote">2.1 Repaired layers eye icon rendering and row on/off visual sync for Control Point Viz rows.</div>
                  <div class="sectionMeta subNote">2.2 Added per-row focus buttons (shoe + control point viz rows) to zoom/focus while preserving camera angle.</div>
                  <div class="sectionMeta">3. Profile A/B/C control-handle visualizer spheres now use handle-point math (P1/P2/P3) instead of sampled rails/anchors.</div>
                  <div class="sectionMeta subNote">3.1 Control-point visualizer spheres render on top of the model for easier debugging.</div>
                  <div class="sectionMeta">4. Top-right gizmo upgraded to clickable axis/corner spheres for view snapping.</div>
                  <div class="sectionMeta">5. Radio sampler behavior updated: closing Radio turns off sampler; collapsed Radio no longer triggers sampler sounds from UI interactions.</div>
                  <div class="sectionMeta subNote">5.1 Radio UI updates: hidden SoundCloud embed visual, default sampler burst set to 0.10s, burst UI clamped to 1.0s (and runtime clamp in main.ts).</div>
                  <div class="sectionMeta">6. Title block stats panel UX pass: expanded title stats height behavior tuned, horizontal resize disabled for the title block, and improved min-height handling while expanded.</div>
                  <div class="sectionMeta subNote">6.1 Debug panel moved into the expanded Title Stats area (under Last Rebuild Source) while preserving Float/Window pop-out controls.</div>
                  <div class="sectionMeta">7. Title status line upgraded into a dark inline progress bar during busy states (build/remesh/export), with stage-mapped 0-100% progress and text overlay readability.</div>
                  <div class="sectionMeta subNote">7.1 Ready/idle keeps the original dark toolbar look; status/progress bar now spans full title width even for short status text.</div>
                  <div class="sectionMeta">8. Toolbar button visual style pass: primary/secondary buttons darkened to match the toolbar, with a darker paused state for the Live/Pause button.</div>
                  <div class="sectionMeta">9. Gizmo/controls overlay refactor: extracted positioning math into `src/ui/gizmoLayout.ts` for stable row order and easier maintenance.</div>
                  <div class="sectionMeta subNote">9.1 Added dedicated Gizmo settings panel (opened by the Gizmo button) with live controls for line alpha, sphere size, and text size.</div>
                  <div class="sectionMeta subNote">9.2 Added independent toolbar width resizing handle for Gizmo/View/Controls stack and dynamic width expansion when sections are open.</div>
                  <div class="sectionMeta">10. Top-right gizmo upgrade: clickable axis + corner snapping improvements, axis labels, hover feedback tuning, and default viewport size increase to 300.</div>
                  <div class="sectionMeta subNote">10.1 Added Ant Crawl naming for the former Current camera mode and aligned Ant Crawl corner snapping behavior to Orbit-style canonical corner handling.</div>
                  <div class="sectionMeta">11. Camera controls UX pass: Perspective/Orthographic toggle sync with FOV slider (`0 = Orthographic`) and smooth slider-driven transitions without unwanted reset snaps.</div>
                  <div class="sectionMeta subNote">11.1 Added Zoom slider linked to live dolly state, plus projection-specific reset behavior (orthographic reset defaults to Left / -X).</div>
                  <div class="sectionMeta">12. View panel reorganization: added Render section, split Grid into its own top-level section (open=on, collapsed=off), and nested Scenes under Background.</div>
                </details>
                <details class="section">
                  <summary>To Do</summary>
                  <div class="sectionMeta">Investigate left UI panel height mismatch (debug log shows ui-height lower than viewport-height even when #ui is set to 100vh).</div>
                  <div class="sectionMeta">Track/resolve why the toolbar column can appear ~90% of viewport height on some sessions/browser states.</div>
                </details>
              </details>

              <details class="section">
                <summary>0.14.3</summary>
                <div class="sectionMeta">Dr Good Fillet, Home of the good fillet, Smooth &amp; Wiggly.</div>
                <div class="sectionMeta">Added Load Settings / Export Settings buttons (JSON) to save and restore the full UI input state.</div>
                <div class="sectionMeta">Heel crown fillet flow was reworked into a separate crown object path for preview performance and fused export output.</div>
                <div class="sectionMeta">HEEL_FIL_1 is now the heel crown enable toggle (master on/off for the added crown on the top of the heel kick).</div>
                <div class="sectionMeta">HEEL_FIL_1_R and HEEL_FIL_2_R now control the two crown shoulder radii (the two rounded top corners of the raised heel cap strip).</div>
                <div class="sectionMeta">When only the crown is enabled, the crown still builds fully; each side radius can be adjusted independently using the two heel fillet radius sliders.</div>
                <div class="sectionMeta">Dr Good Fillet auto-enables BP_FIL_1, TH_FIL_1, TH_FIL_2, and HEEL_FIL_1. Diet unchecked switches heel behavior to Sweep ON + Heel Midpoint Control OFF.</div>
                <div class="sectionMeta">Toe Hook now uses a single Add Profile B toggle (default OFF). OFF = direct Aâ†’C loft. ON = Aâ†’Bâ†’C loft. Profile B params are hidden when OFF and their values are preserved.</div>
                <div class="sectionMeta">TOE_AB_MID is ignored when Add Profile B is OFF. TOE_BC_MID is reused as the Aâ†’C intermediate profile count in that mode.</div>
                <div class="sectionMeta">Toe Hook Rail Math modes were added. Rail Math 1 = default Hermite fit, 2 = linear rails, 3 = linear + fixed end angle behavior, 4 = arc rails with absolute frame, 5/6 are experimental branches for custom end/transition rail tuning.</div>
                <div class="sectionMeta">Rail Math 5 adds two tuning controls: Rail Math 5 Cull Count (how many near-C intermediates are removed) and Rail Math 5 Add-Back Profiles (separate tail-loft transition profiles from the last AC intermediate to final Profile C).</div>
                <div class="sectionMeta">Heel Kick Rail Math modes were added (1â€“5). Heel Rail Math 2 mirrors the Sweep behavior. Heel Rail Math 4 keeps heel profiles parallel (fixed vertical section orientation) while 4A/4B are experimental sub-modes.</div>
                <div class="sectionMeta">Heel Rail Math 3 / Sweep and Heel Rail Math 4B now expose arc-shape tuning sliders: Sweep, Bias, and Blend. Sweep and Heel Rail Math 3 are UI-synced and share the same RM3 slider values.</div>
              </details>

              <details class="section">
                <summary>0.14.2</summary>
                <div class="sectionMeta">Added baseplate screw holes / slot controls. BP_SH_X and BP_SH_Y move the screw-hole pair origin relative to the UI screw-hole reference point on the baseplate.</div>
                <div class="sectionMeta">BP_SH_ANG sets the primary screw-hole axis angle. BP_SH_DIST sets spacing between hole centers along that axis. BP_SH_ANG2 and BP_SH_OFF2 control the second hole orientation/offset for non-matching slot alignment.</div>
                <div class="sectionMeta">BP_SH_DIA sets the actual hole diameter. BP_SH_WASHER sets the washer footprint diameter. BP_SH_SLOT adds slot length to the inline hole/washer profile (0 = round hole / round washer).</div>
                <div class="sectionMeta">BP_FIL_1 note: baseplate fillet path now renders as a 3-point arc (cleaner than tiny line segments), and the fillet on the corner touching the inner spline was removed.</div>
              </details>

              <details class="section">
                <summary>0.14.1</summary>
                <div class="sectionMeta">New Wiggle technology. toe A->B->C loft path is grounded to the baseplate for the solid model; toe hook arc controls now use P1S / P3S handle strengths (replacing older arc controls), and the new result is super wiggly.</div>
                <div class="sectionMeta">Toe rail architecture is driven by Profile A/B/C with per-profile rail strengths (TOE_A_STR, TOE_B_STR, TOE_C_STR) used to blend/control the outer/inner rail behavior across the loft.</div>
                <div class="sectionMeta">Heel kick: Profile C/D and C->D intermediates use a normal-cap cut workflow (cut by Z height, cap perpendicular to the outer tangent).</div>
                <div class="sectionMeta">Heel heights are clamped in app logic to the current Profile C top range; HEEL_H_C / HEEL_H_D may snap down if set too high.</div>
                <div class="sectionMeta">Debug window now logs worker build receives (sequence + dt) to help tune rebuild/debounce behavior.</div>
                <div class="sectionMeta">HEEL_F1 / HEEL_F2 and FIL_1..FIL_5 remain experimental / placeholder controls unless noted in current code behavior.</div>
              </details>

              <details class="section">
                <summary>0.13.0</summary>
                <div class="sectionMeta">13.423 - added section cut</div>
                <div class="sectionMeta">13.422 - updated shoe rotation</div>
              </details>
            </details>

            <!-- SECTION CUT -->
            <details class="section">
              <summary>-Section Cut</summary>
              <div class="sectionMeta">Slice preview/export. Offset is in mm along the active cut normal.</div>

              <div class="check">
                <input id="sectionCutEnabled" type="checkbox" />
                <label for="sectionCutEnabled">Enable section cut</label>
              </div>

              <div class="check">
                <input id="sectionCutFlip" type="checkbox" />
                <label for="sectionCutFlip">Flip section cut</label>
              </div>

              <div class="check">
                <input id="sectionCutZswitch" type="checkbox" />
                <label for="sectionCutZswitch">Plan / Section</label>
              </div>

              <div class="check" style="margin-left: 18px;">
                <input id="sectionCutModeSection" name="sectionCutMode" type="radio" checked />
                <label for="sectionCutModeSection">Section (XZ)</label>
              </div>

              <div class="check" style="margin-left: 18px;">
                <input id="sectionCutModePlan" name="sectionCutMode" type="radio" />
                <label for="sectionCutModePlan">Plan (XY)</label>
              </div>

              <div class="row">
                <label>Section Cut Offset
                  <input id="sectionCutOffset" type="range" min="-200" max="420" step="1" value="0" />
                </label>
                <input class="valInput" id="sectionCutOffsetVal" type="number" step="1" value="0" />
              </div>
            </details>

            <!-- Quality -->
            <details class="section">
              <summary>-Quality</summary>
              <div class="sectionMeta">Preview mesh settings</div>

              <div class="row">
                <label>Mesh Tolerance (higher = faster)
                  <input id="tolerance" name="tolerance" type="range" min="0.3" max="3.0" step="0.1" value="1.5" />
                </label>
                <input class="valInput" id="toleranceVal" type="number" step="0.1" value="1.5" />
              </div>

              <div class="row">
                <label>Rebuild Debounce (ms)
                  <input id="debounceMs" type="range" min="0" max="1000" step="10" value="200" />
                </label>
                <input class="valInput" id="debounceMsVal" type="number" min="0" max="1000" step="10" value="200" />
              </div>

              <div class="check">
                <input id="rebuildAsOne" type="checkbox" />
                <label for="rebuildAsOne">rebuild as one</label>
              </div>
            </details>

            <!-- PREMADE HOOKS -->
            <details class="section">
              <summary>-Premade Hooks</summary>
              <div class="sectionMeta">STEP overlays (small / medium / large / XL)</div>

              <div class="check">
                <input id="hookSmallEnabled" type="checkbox" />
                <label for="hookSmallEnabled">Small</label>
              </div>

              <div class="check">
                <input id="hookMediumEnabled" type="checkbox" />
                <label for="hookMediumEnabled">Medium</label>
              </div>

              <div class="check">
                <input id="hookLargeEnabled" type="checkbox" />
                <label for="hookLargeEnabled">Large</label>
              </div>

              <div class="check">
                <input id="hookXLEnabled" type="checkbox" />
                <label for="hookXLEnabled">XL</label>
              </div>

              <div class="row">
                <label>Hook Transform X (mm)
                  <input id="hookX" type="range" min="-150" max="150" step="1" value="0" />
                </label>
                <input class="valInput" id="hookXVal" type="number" step="1" value="0" />
              </div>

              <div class="row">
                <label>Hook Transform Y (mm)
                  <input id="hookY" type="range" min="-150" max="150" step="1" value="0" />
                </label>
                <input class="valInput" id="hookYVal" type="number" step="1" value="0" />
              </div>

              <div class="row">
                <label>Hook Transform Z (mm)
                  <input id="hookZ" type="range" min="-100" max="100" step="1" value="0" />
                </label>
                <input class="valInput" id="hookZVal" type="number" step="1" value="0" />
              </div>

              <div class="row">
                <label>Hook Rotate Plan (deg)
                  <input id="hookRot" type="range" min="-180" max="180" step="1" value="0" />
                </label>
                <input class="valInput" id="hookRotVal" type="number" step="1" value="0" />
              </div>
            </details>

            <!-- REFERENCE FOOTPAD -->
            <details class="section">
              <summary>-Reference Footpad</summary>
              <div class="sectionMeta">STL overlays for pad fit reference</div>

              <div class="check">
                <input id="footpad1Enabled" type="checkbox" />
                <label for="footpad1Enabled">Footpad 1</label>
              </div>

              <div class="check">
                <input id="footpad2Enabled" type="checkbox" checked />
                <label for="footpad2Enabled">Footpad 2</label>
              </div>

              <div class="check">
                <input id="footpad3Enabled" type="checkbox" />
                <label for="footpad3Enabled">Footpad 3</label>
              </div>

              <div class="row">
                <label>Footpad Transform X (mm)
                  <input id="footpadX" type="range" min="-100" max="150" step="1" value="62" />
                </label>
                <input class="valInput" id="footpadXVal" type="number" step="1" value="62" />
              </div>

              <div class="row">
                <label>Footpad Transform Y (mm)
                  <input id="footpadY" type="range" min="-100" max="150" step="1" value="95" />
                </label>
                <input class="valInput" id="footpadYVal" type="number" step="1" value="95" />
              </div>

              <div class="row">
                <label>Footpad Transform Z (mm)
                  <input id="footpadZ" type="range" min="-100" max="100" step="1" value="-19" />
                </label>
                <input class="valInput" id="footpadZVal" type="number" step="1" value="-19" />
              </div>

              <div class="row">
                <label>Footpad Rotate Plan (deg)
                  <input id="footpadRot" type="range" min="-180" max="180" step="1" value="0" />
                </label>
                <input class="valInput" id="footpadRotVal" type="number" step="1" value="0" />
              </div>
            </details>

            <!-- REFERENCE SHOE -->
            <details class="section">
              <summary>-Reference Shoe</summary>
              <div class="sectionMeta">OBJ overlay for fit and scale reference</div>

              <div class="check">
                <input id="shoeEnabled" type="checkbox" checked />
                <label for="shoeEnabled">Show shoe reference</label>
              </div>

              <div class="row">
                <label>Shoe Size (US 5â€“14)
                  <input id="shoeSize" type="range" min="5" max="14" step="0.5" value="10" />
                </label>
                <input class="valInput" id="shoeSizeVal" type="number" step="0.5" value="10" />
              </div>

              <div class="row">
                <label>Computed Scale  (relative to size 10)
                  <input id="shoeScale" type="range" min="0.50" max="1.25" step="0.001" value="1" disabled />
                </label>
                <input class="valInput" id="shoeScaleVal" type="number" min="0.50" max="1.25" step="0.001" value="1.000" disabled />
              </div>

              <div class="row">
                <label>Transparency (0 = solid, 1 = invisible)
                  <input id="shoeAlpha" type="range" min="0" max="1" step="0.01" value="0.5" />
                </label>
                <input class="valInput" id="shoeAlphaVal" type="number" step="0.01" value="0.5" />
              </div>

              <div class="row">
                <label>Transform X (mm)
                  <input id="shoeX" type="range" min="-200" max="200" step="1" value="0" />
                </label>
                <input class="valInput" id="shoeXVal" type="number" step="1" value="0" />
              </div>

              <div class="row">
                <label>Transform Y (mm)
                  <input id="shoeY" type="range" min="-200" max="200" step="1" value="0" />
                </label>
                <input class="valInput" id="shoeYVal" type="number" step="1" value="0" />
              </div>

              <div class="row">
                <label>Transform Z (mm)
                  <input id="shoeZ" type="range" min="-200" max="200" step="1" value="0" />
                </label>
                <input class="valInput" id="shoeZVal" type="number" step="1" value="0" />
              </div>

              <div class="row">
                <label>Rotate Plan (deg)
                  <input id="shoeRot" type="range" min="-180" max="180" step="1" value="0" />
                </label>
                <input class="valInput" id="shoeRotVal" type="number" step="1" value="0" />
              </div>
            </details>
          </details>

          <details class="section hasInlinePanelActions" id="paraHookParamsSection" open>
            <summary>Parahook Parameters</summary>
            <div class="sectionMeta">Primary geometry controls for the parahook model.</div>
            <div class="panelActionRow">
                <button id="paraHookParamsFloatToggle" type="button" class="panelActionBtn" aria-pressed="false" aria-label="Float panel" title="Float panel">▣</button>
                <button id="paraHookParamsWindowToggle" type="button" class="panelActionBtn" aria-pressed="false" aria-label="Open panel in window" title="Open panel in window">⇱</button>
            </div>
<!-- TRANSFORM (viewer-only) -->
<details class="section">
  <summary>Transform</summary>
  <div class="sectionMeta">Viewport-only transform for the generated parahook model (does not affect CAD params or export geometry).</div>
  <div class="btnStack" style="margin: 0 0 8px 0;">
    <button id="modelTransformReset" type="button" class="secondary">Reset</button>
  </div>
  <div class="check">
    <input id="modelMirrorXZ" type="checkbox" />
    <label for="modelMirrorXZ">Mirror (XZ plane)</label>
  </div>

  <div class="paramRow">
    <div class="paramTop">
      <div class="paramTag">MODEL_X</div>
      <div class="paramName">Model Transform X (mm)</div>
    </div>
    <div class="paramBody">
      <input id="modelX" type="range" min="-300" max="300" step="1" value="0" />
      <input class="valInput" id="modelXVal" type="number" step="1" value="0" />
    </div>
  </div>

  <div class="paramRow">
    <div class="paramTop">
      <div class="paramTag">MODEL_Y</div>
      <div class="paramName">Model Transform Y (mm)</div>
    </div>
    <div class="paramBody">
      <input id="modelY" type="range" min="-300" max="300" step="1" value="0" />
      <input class="valInput" id="modelYVal" type="number" step="1" value="0" />
    </div>
  </div>

  <div class="paramRow">
    <div class="paramTop">
      <div class="paramTag">MODEL_Z</div>
      <div class="paramName">Model Transform Z (mm)</div>
    </div>
    <div class="paramBody">
      <input id="modelZ" type="range" min="-300" max="300" step="1" value="0" />
      <input class="valInput" id="modelZVal" type="number" step="1" value="0" />
    </div>
  </div>

  <div class="paramRow">
    <div class="paramTop">
      <div class="paramTag">MODEL_RX</div>
      <div class="paramName">Model Rotate X (deg)</div>
    </div>
    <div class="paramBody">
      <input id="modelRotX" type="range" min="-180" max="180" step="1" value="0" />
      <input class="valInput" id="modelRotXVal" type="number" step="1" value="0" />
    </div>
  </div>

  <div class="paramRow">
    <div class="paramTop">
      <div class="paramTag">MODEL_RY</div>
      <div class="paramName">Model Rotate Y (deg)</div>
    </div>
    <div class="paramBody">
      <input id="modelRotY" type="range" min="-180" max="180" step="1" value="0" />
      <input class="valInput" id="modelRotYVal" type="number" step="1" value="0" />
    </div>
  </div>

  <div class="paramRow">
    <div class="paramTop">
      <div class="paramTag">MODEL_RZ</div>
      <div class="paramName">Model Rotate Plan (deg)</div>
    </div>
    <div class="paramBody">
      <input id="modelRot" type="range" min="-180" max="180" step="1" value="0" />
      <input class="valInput" id="modelRotVal" type="number" step="1" value="0" />
    </div>
  </div>
</details>
<!-- BASEPLATE -->
<details class="section">
  <summary>Baseplate</summary>
  <div class="sectionMeta">Primary baseplate controls</div>

  <div class="check">
    <input id="vizBasePts" type="checkbox" />
    <label for="vizBasePts">Show Baseplate control points</label>
  </div>

  <div class="check">
    <input id="baseEnabled" type="checkbox" checked />
    <label for="baseEnabled">Enable baseplate</label>
  </div>

  <!-- Dimensions -->
  <details class="section">
    <summary>-Dimensions</summary>
    <div class="sectionMeta">Overall size and spline controls</div>

    <!-- BP length -->
    <div class="paramRow">
      <div class="paramTop">
        <div class="paramTag">BP_LEN</div>
        <div class="paramName">Base Length (Y)</div>
      </div>
      <div class="paramBody">
        <input id="bp_len" name="bp_len" type="range" min="100" max="420" step="1" value="195" />
        <input class="valInput" id="bp_lenVal" type="number" step="1" value="195" />
      </div>
    </div>

    <!-- BP width -->
    <div class="paramRow">
      <div class="paramTop">
        <div class="paramTag">BP_WID</div>
        <div class="paramName">Base Width Offset (mm)</div>
      </div>
      <div class="paramBody">
        <input id="bp_wid" name="bp_wid" type="range" min="5" max="140" step="1" value="30" />
        <input class="valInput" id="bp_widVal" type="number" step="1" value="30" />
      </div>
    </div>

    <!-- BP thickness -->
    <div class="paramRow">
      <div class="paramTop">
        <div class="paramTag">BP_THK</div>
        <div class="paramName">Base Thickness (Z)</div>
      </div>
      <div class="paramBody">
        <input id="bp_thk" name="bp_thk" type="range" min="-40" max="30" step="1" value="12" />
        <input class="valInput" id="bp_thkVal" type="number" step="1" value="12" />
      </div>
    </div>

    <!-- BP heel% -->
    <div class="paramRow">
      <div class="paramTop">
        <div class="paramTag">BP_HEEL_PCT</div>
        <div class="paramName">Point Heel % (P3 Y as % of Base Length)</div>
      </div>
      <div class="paramBody">
        <input id="bp_heelPct" name="bp_heelPct" type="range" min="50" max="100" step="1" value="67" />
        <input class="valInput" id="bp_heelPctVal" type="number" step="1" value="67" />
      </div>
    </div>

    <!-- BP toe% -->
    <div class="paramRow">
      <div class="paramTop">
        <div class="paramTag">BP_TOE_PCT</div>
        <div class="paramName">Point Toe % (P2 Y as % of Heel Y)</div>
      </div>
      <div class="paramBody">
        <input id="bp_toePct" name="bp_toePct" type="range" min="5" max="95" step="1" value="46" />
        <input class="valInput" id="bp_toePctVal" type="number" step="1" value="46" />
      </div>
    </div>

    <!-- BP P2X -->
    <div class="paramRow">
      <div class="paramTop">
        <div class="paramTag">BP_P2X</div>
        <div class="paramName">Point 2 X</div>
      </div>
      <div class="paramBody">
        <input id="bp_p2x" name="bp_p2x" type="range" min="-80" max="40" step="1" value="-14" />
        <input class="valInput" id="bp_p2xVal" type="number" step="1" value="-14" />
      </div>
    </div>

    <!-- BP P3X -->
    <div class="paramRow">
      <div class="paramTop">
        <div class="paramTag">BP_P3X</div>
        <div class="paramName">Point 3 X</div>
      </div>
      <div class="paramBody">
        <input id="bp_p3x" name="bp_p3x" type="range" min="-80" max="40" step="1" value="-2" />
        <input class="valInput" id="bp_p3xVal" type="number" step="1" value="-2" />
      </div>
    </div>

    <!-- BP P4X -->
    <div class="paramRow">
      <div class="paramTop">
        <div class="paramTag">BP_P4X</div>
        <div class="paramName">Point 4 X</div>
      </div>
      <div class="paramBody">
        <input id="bp_p4x" name="bp_p4x" type="range" min="-80" max="80" step="1" value="1" />
        <input class="valInput" id="bp_p4xVal" type="number" step="1" value="1" />
      </div>
    </div>
  </details>

  <!-- Screw Holes (keep same as you already added) -->
  <details class="section">
    <summary>-Screw Holes</summary>
    <div class="sectionMeta">
      Slot pattern controls. Hole 1 X/Y are local offsets (mm) from the calibrated screw-hole origin. Slot length is 0 for a round hole.
    </div>

    <div class="paramRow">
      <div class="paramTop">
        <div class="paramTag">BP_SH_X</div>
        <div class="paramName">Hole 1 X Offset (mm)</div>
      </div>
      <div class="paramBody">
        <input id="bp_sh_x" name="bp_sh_x" type="range" min="-80" max="80" step="1" value="0" />
        <input class="valInput" id="bp_sh_xVal" type="number" step="1" value="0" />
      </div>
    </div>

    <div class="paramRow">
      <div class="paramTop">
        <div class="paramTag">BP_SH_Y</div>
        <div class="paramName">Hole 1 Y Offset (mm)</div>
      </div>
      <div class="paramBody">
        <input id="bp_sh_y" name="bp_sh_y" type="range" min="-120" max="120" step="1" value="0" />
        <input class="valInput" id="bp_sh_yVal" type="number" step="1" value="0" />
      </div>
    </div>

    <div class="paramRow">
      <div class="paramTop">
        <div class="paramTag">BP_SH_ANG</div>
        <div class="paramName">Hole 1 Angle (deg)</div>
      </div>
      <div class="paramBody">
        <input id="bp_sh_ang" name="bp_sh_ang" type="range" min="-180" max="180" step="1" value="12" />
        <input class="valInput" id="bp_sh_angVal" type="number" step="1" value="12" />
      </div>
    </div>

    <div class="paramRow">
      <div class="paramTop">
        <div class="paramTag">BP_SH_DIA</div>
        <div class="paramName">Screw Diameter (mm)</div>
      </div>
      <div class="paramBody">
        <input id="bp_sh_dia" name="bp_sh_dia" type="range" min="2" max="10" step="0.1" value="5" />
        <input class="valInput" id="bp_sh_diaVal" type="number" step="0.1" value="5.0" />
      </div>
    </div>

    <div class="paramRow">
      <div class="paramTop">
        <div class="paramTag">BP_SH_WASHER</div>
        <div class="paramName">Washer Diameter (mm)</div>
      </div>
      <div class="paramBody">
        <input id="bp_sh_washer" name="bp_sh_washer" type="range" min="5" max="30" step="0.5" value="10" />
        <input class="valInput" id="bp_sh_washerVal" type="number" min="5" max="30" step="0.5" value="10" />
      </div>
    </div>

    <div class="paramRow">
      <div class="paramTop">
        <div class="paramTag">BP_SH_SLOT</div>
        <div class="paramName">Screw Slot Length (mm)</div>
      </div>
      <div class="paramBody">
        <input id="bp_sh_slot" name="bp_sh_slot" type="range" min="0" max="40" step="0.5" value="30" />
        <input class="valInput" id="bp_sh_slotVal" type="number" step="0.5" value="30" />
      </div>
    </div>

    <div class="paramRow">
      <div class="paramTop">
        <div class="paramTag">BP_SH_DIST</div>
        <div class="paramName">Slot Distance (center-to-center, mm)</div>
      </div>
      <div class="paramBody">
        <input id="bp_sh_dist" name="bp_sh_dist" type="range" min="10" max="180" step="1" value="10" />
        <input class="valInput" id="bp_sh_distVal" type="number" step="1" value="10" />
      </div>
    </div>

    <div class="paramRow">
      <div class="paramTop">
        <div class="paramTag">BP_SH_ANG2</div>
        <div class="paramName">Hole 2 Angle (deg)</div>
      </div>
      <div class="paramBody">
        <input id="bp_sh_ang2" name="bp_sh_ang2" type="range" min="-180" max="180" step="1" value="-20" />
        <input class="valInput" id="bp_sh_ang2Val" type="number" step="1" value="-20" />
      </div>
    </div>

    <div class="paramRow">
      <div class="paramTop">
        <div class="paramTag">BP_SH_OFF2</div>
        <div class="paramName">Hole 2 Offset (mm, along axis)</div>
      </div>
      <div class="paramBody">
        <input id="bp_sh_off2" name="bp_sh_off2" type="range" min="-80" max="80" step="1" value="60" />
        <input class="valInput" id="bp_sh_off2Val" type="number" step="1" value="60" />
      </div>
    </div>
  </details>
</details>
          <!-- Toe Hook (named keys) -->
          <details class="section">
            <summary>Toe Hook</summary>
            <div class="sectionMeta">Profiles A â†’ B (mid) â†’ C (end). Stations measured in mm along the spline from origin.</div>
            <div class="check">
              <input id="toeAddProfileB" type="checkbox"  checked />
              <label for="toeAddProfileB">Add Profile B</label>
            </div>

            <!-- Profile A -->
            <details class="section">
              <summary>Profile A</summary>
              <div class="sectionMeta">
                Start profile at spline start. Uses a 2-point organic curve (Bezier) with a vertical start handle and an angled end handle.
              </div>

              <div class="check">
                <input id="vizAArcPts" type="checkbox" />
                <label for="vizAArcPts">Show Profile A control handles</label>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_THK</div>
                  <div class="paramName">Toe Hook Thickness (offset, mm)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_thk" name="toe_thk" type="range" min="5" max="25" step="0.5" value="12" />
                  <input class="valInput" id="toe_thkVal" type="number" step="0.5" value="12" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_A_P1S</div>
                  <div class="paramName">P1 Strength (vertical handle, mm)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_a_p1s" name="toe_a_p1s" type="range" min="0" max="140" step="1" value="25" />
                  <input class="valInput" id="toe_a_p1sVal" type="number" step="1" value="25" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_A_P3S</div>
                  <div class="paramName">End Handle Strength (mm)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_a_p3s" name="toe_a_p3s" type="range" min="0" max="140" step="1" value="35" />
                  <input class="valInput" id="toe_a_p3sVal" type="number" step="1" value="35" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_A_ENDX</div>
                  <div class="paramName">End X A (mm)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_a_endx" name="toe_a_endx" type="range" min="0" max="160" step="1" value="47" />
                  <input class="valInput" id="toe_a_endxVal" type="number" step="1" value="47" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_A_ENDZ</div>
                  <div class="paramName">End Z A (mm)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_a_endz" name="toe_a_endz" type="range" min="0" max="180" step="1" value="35" />
                  <input class="valInput" id="toe_a_endzVal" type="number" step="1" value="35" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_A_ENDA</div>
                  <div class="paramName">End Handle Angle (deg)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_a_enda" name="toe_a_enda" type="range" min="-180" max="180" step="1" value="0" />
                  <input class="valInput" id="toe_a_endaVal" type="number" step="1" value="0" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_A_STR</div>
                  <div class="paramName">Rail Strength at A</div>
                </div>
                <div class="paramBody">
                  <input id="toe_a_strength" name="toe_a_strength" type="range" min="0.2" max="8" step="0.01" value="2" />
                  <input class="valInput" id="toe_a_strengthVal" type="number" min="0.2" max="8" step="0.01" value="2" />
                </div>
              </div>
            </details>

            <!-- Profile B -->
            <details id="toeProfileBSection" class="section" open>
              <summary>Profile B</summary>
              <div class="sectionMeta">Mid control profile. Station is mm along spline from origin. Controls Aâ†’B intermediate sections.</div>

              <div class="sectionMeta" style="margin-top: 6px; opacity: 0.9;">
                Loft Params
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_B_STA</div>
                  <div class="paramName">Profile B Length (mm along spline)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_b_sta" name="toe_b_sta" type="range" min="1" max="260" step="1" value="60" />
                  <input class="valInput" id="toe_b_staVal" type="number" step="1" value="60" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_AB_MID</div>
                  <div class="paramName">Aâ†’B Intermediate Profiles (0 = Aâ†’B only)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_ab_mid" name="toe_ab_mid" type="range" min="0" max="60" step="1" value="20" />
                  <input class="valInput" id="toe_ab_midVal" type="number" step="1" value="10" />
                </div>
              </div>

              <div class="sectionMeta" style="margin-top: 10px; opacity: 0.9;">
                Profile Controls
              </div>

              <div class="check">
                <input id="vizBArcPts" type="checkbox" />
                <label for="vizBArcPts">Show Profile B control handles</label>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_B_P1S</div>
                  <div class="paramName">P1 Strength (vertical handle, mm)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_b_p1s" name="toe_b_p1s" type="range" min="0" max="140" step="1" value="25" />
                  <input class="valInput" id="toe_b_p1sVal" type="number" step="1" value="25" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_B_P3S</div>
                  <div class="paramName">End Handle Strength (mm)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_b_p3s" name="toe_b_p3s" type="range" min="0" max="140" step="1" value="36" />
                  <input class="valInput" id="toe_b_p3sVal" type="number" step="1" value="36" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_B_ENDX</div>
                  <div class="paramName">End X B (mm)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_b_endx" name="toe_b_endx" type="range" min="0" max="160" step="1" value="47" />
                  <input class="valInput" id="toe_b_endxVal" type="number" step="1" value="47" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_B_ENDZ</div>
                  <div class="paramName">End Z B (mm)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_b_endz" name="toe_b_endz" type="range" min="0" max="180" step="1" value="50" />
                  <input class="valInput" id="toe_b_endzVal" type="number" step="1" value="50" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_B_ENDA</div>
                  <div class="paramName">End Handle Angle (deg)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_b_enda" name="toe_b_enda" type="range" min="-180" max="180" step="1" value="-18" />
                  <input class="valInput" id="toe_b_endaVal" type="number" step="1" value="-18" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_B_STR</div>
                  <div class="paramName">Rail Strength at B</div>
                </div>
                <div class="paramBody">
                  <input id="toe_b_strength" name="toe_b_strength" type="range" min="0.2" max="8" step="0.01" value="2" />
                  <input class="valInput" id="toe_b_strengthVal" type="number" min="0.2" max="8" step="0.01" value="2" />
                </div>
              </div>
            </details>

            <!-- Profile C -->
            <details class="section">
              <summary>Profile C</summary>
              <div class="sectionMeta">End profile. Station is mm along spline from origin. Controls Bâ†’C intermediate sections.</div>

              <div class="sectionMeta" style="margin-top: 6px; opacity: 0.9;">
                Loft Params
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_C_STA</div>
                  <div class="paramName">Profile C Length (mm along spline)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_c_sta" name="toe_c_sta" type="range" min="1" max="260" step="1" value="137" />
                  <input class="valInput" id="toe_c_staVal" type="number" step="1" value="137" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_BC_MID</div>
                  <div class="paramName">Bâ†’C Intermediate Profiles (0 = Bâ†’C only)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_bc_mid" name="toe_bc_mid" type="range" min="0" max="60" step="1" value="20" />
                  <input class="valInput" id="toe_bc_midVal" type="number" step="1" value="15" />
                </div>
              </div>

              <div class="sectionMeta" style="margin-top: 10px; opacity: 0.9;">
                Profile Controls
              </div>

              <div class="check">
                <input id="vizCArcPts" type="checkbox" />
                <label for="vizCArcPts">Show Profile C control handles</label>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_C_P1S</div>
                  <div class="paramName">P1 Strength (vertical handle, mm)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_c_p1s" name="toe_c_p1s" type="range" min="0" max="140" step="1" value="25" />
                  <input class="valInput" id="toe_c_p1sVal" type="number" step="1" value="25" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_C_P3S</div>
                  <div class="paramName">End Handle Strength (mm)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_c_p3s" name="toe_c_p3s" type="range" min="0" max="140" step="1" value="35" />
                  <input class="valInput" id="toe_c_p3sVal" type="number" step="1" value="35" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_C_ENDX</div>
                  <div class="paramName">End X C (mm)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_c_endx" name="toe_c_endx" type="range" min="0" max="180" step="1" value="19" />
                  <input class="valInput" id="toe_c_endxVal" type="number" step="1" value="19" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_C_ENDZ</div>
                  <div class="paramName">End Z C (mm)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_c_endz" name="toe_c_endz" type="range" min="0" max="200" step="1" value="75" />
                  <input class="valInput" id="toe_c_endzVal" type="number" step="1" value="75" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_C_ENDA</div>
                  <div class="paramName">End Handle Angle (deg)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_c_enda" name="toe_c_enda" type="range" min="-180" max="180" step="1" value="-70" />
                  <input class="valInput" id="toe_c_endaVal" type="number" step="1" value="-70" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_C_STR</div>
                  <div class="paramName">Rail Strength at C</div>
                </div>
                <div class="paramBody">
                  <input id="toe_c_strength" name="toe_c_strength" type="range" min="0.2" max="8" step="0.01" value="7" />
                  <input class="valInput" id="toe_c_strengthVal" type="number" min="0.2" max="8" step="0.01" value="7" />
                </div>
              </div>

            </details>

          </details>

          <!-- Heel Kick (still paramN on purpose; we will rename after toe is stable) -->
          <details class="section">
            <summary>Heel Kick</summary>
            <div class="sectionMeta">Heights and fillet placeholders for the heel-kick loft.</div>

            <div class="check">
              <input id="heelEnabled" type="checkbox" checked />
              <label for="heelEnabled">Enable heel kick loft</label>
            </div>

            <div class="check">
              <input id="vizHeelArcPts" type="checkbox" />
              <label for="vizHeelArcPts">Show Heel Kick arc control points</label>
            </div>

            <div class="paramRow">
              <div class="paramTop">
                <div class="paramTag">HEEL_H_C</div>
                <div class="paramName">Heel Kick Height at Profile C (mm)</div>
              </div>
              <div class="paramBody">
                <input id="heel_h_c" name="heel_h_c" type="range" min="0" max="200" step="1" value="40" />
                <input class="valInput" id="heel_h_cVal" type="number" step="1" value="40" />
              </div>
            </div>

            <div class="check">
              <input id="heel_mid_ctrl" type="checkbox" />
              <label for="heel_mid_ctrl">heel midpoint control</label>
            </div>

            <div class="check">
              <input id="heel_sweep" type="checkbox" />
              <label for="heel_sweep">sweep</label>
            </div>
            <div id="heelSweepRm3Wrap" style="display:none; margin: 4px 0 8px 18px;">
              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">HEEL_RM3_SWEEP</div>
                  <div class="paramName">Heel RM3 Arc Sweep</div>
                </div>
                <div class="paramBody">
                  <input id="heel_sweep_rm3_sweep" type="range" min="0" max="2" step="0.01" value="1" />
                  <input class="valInput" id="heel_sweep_rm3_sweepVal" type="number" min="0" max="2" step="0.01" value="1" />
                </div>
              </div>
              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">HEEL_RM3_BIAS</div>
                  <div class="paramName">Heel RM3 Midpoint Bias</div>
                </div>
                <div class="paramBody">
                  <input id="heel_sweep_rm3_bias" type="range" min="-1" max="1" step="0.01" value="0" />
                  <input class="valInput" id="heel_sweep_rm3_biasVal" type="number" min="-1" max="1" step="0.01" value="0" />
                </div>
              </div>
              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">HEEL_RM3_BLEND</div>
                  <div class="paramName">Heel RM3 Blend</div>
                </div>
                <div class="paramBody">
                  <input id="heel_sweep_rm3_blend" type="range" min="0" max="1" step="0.01" value="1" />
                  <input class="valInput" id="heel_sweep_rm3_blendVal" type="number" min="0" max="1" step="0.01" value="1" />
                </div>
              </div>
            </div>

            <div class="paramRow">
              <div class="paramTop">
                <div class="paramTag">HEEL_H_D</div>
                <div class="paramName">Heel Kick Height at Profile D (mm)</div>
              </div>
              <div class="paramBody">
                <input id="heel_h_d" name="heel_h_d" type="range" min="0" max="200" step="1" value="10" />
                <input class="valInput" id="heel_h_dVal" type="number" step="1" value="10" />
              </div>
            </div>

            <div class="paramRow">
              <div class="paramTop">
                <div class="paramTag">HEEL_CD_MID</div>
                <div class="paramName">Heel Loft Intermediate Profiles (0 = Câ†’D only)</div>
              </div>
              <div class="paramBody">
                <input id="heel_cd_mid" name="heel_cd_mid" type="range" min="0" max="60" step="1" value="10" />
                <input class="valInput" id="heel_cd_midVal" type="number" step="1" value="2" />
              </div>
            </div>

            <div class="paramRow">
              <div class="paramTop">
                <div class="paramTag">HEEL_CD_MID_PCT</div>
                <div class="paramName">Heel D-Profile Midpoint (%)</div>
              </div>
              <div class="paramBody">
                <input id="heel_cd_mid_pct" name="heel_cd_mid_pct" type="range" min="10" max="90" step="1" value="50" />
                <input class="valInput" id="heel_cd_mid_pctVal" type="number" min="10" max="90" step="1" value="50" />
              </div>
            </div>

            <div class="paramRow">
              <div class="paramTop">
                <div class="paramTag">HEEL_F1</div>
                <div class="paramName">Heel Kick Fillet Radius 1 (mm) (placeholder)</div>
              </div>
              <div class="paramBody">
                <input id="heel_f1" name="heel_f1" type="range" min="0" max="30" step="0.5" value="0" />
                <input class="valInput" id="heel_f1Val" type="number" step="0.5" value="0" />
              </div>
            </div>

            <div class="paramRow">
              <div class="paramTop">
                <div class="paramTag">HEEL_F2</div>
                <div class="paramName">Heel Kick Fillet Radius 2 (mm) (placeholder)</div>
              </div>
              <div class="paramBody">
                <input id="heel_f2" name="heel_f2" type="range" min="0" max="30" step="0.5" value="0" />
                <input class="valInput" id="heel_f2Val" type="number" step="0.5" value="0" />
              </div>
            </div>
          </details>

          <!-- Fillets placeholders -->
          <details class="section">
            <summary>Fillets</summary>
            <div class="sectionMeta">Temporary global fillet params (placeholders). These do not affect the model yet.</div>
            <div class="check">
              <input id="dr_good_fillet" type="checkbox"  checked />
              <label for="dr_good_fillet">Dr Good Fillet</label>
            </div>
            <div class="check" id="dr_good_fillet_diet_wrap" style="display: none;">
              <input id="dr_good_fillet_diet" type="checkbox" />
              <label for="dr_good_fillet_diet">Diet</label>
            </div>
            <details class="section">
              <summary>Global (Placeholders)</summary>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">FIL_1</div>
                  <div class="paramName">Fillet Param 1 (mm) (placeholder)</div>
                </div>
                <div class="paramBody">
                  <input id="fil_1" name="fil_1" type="range" min="0" max="30" step="0.5" value="0" />
                  <input class="valInput" id="fil_1Val" type="number" step="0.5" value="0" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">FIL_2</div>
                  <div class="paramName">Fillet Param 2 (mm) (placeholder)</div>
                </div>
                <div class="paramBody">
                  <input id="fil_2" name="fil_2" type="range" min="0" max="30" step="0.5" value="0" />
                  <input class="valInput" id="fil_2Val" type="number" step="0.5" value="0" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">FIL_3</div>
                  <div class="paramName">Fillet Param 3 (mm) (placeholder)</div>
                </div>
                <div class="paramBody">
                  <input id="fil_3" name="fil_3" type="range" min="0" max="30" step="0.5" value="0" />
                  <input class="valInput" id="fil_3Val" type="number" step="0.5" value="0" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">FIL_4</div>
                  <div class="paramName">Fillet Param 4 (mm) (placeholder)</div>
                </div>
                <div class="paramBody">
                  <input id="fil_4" name="fil_4" type="range" min="0" max="30" step="0.5" value="0" />
                  <input class="valInput" id="fil_4Val" type="number" step="0.5" value="0" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">FIL_5</div>
                  <div class="paramName">Fillet Param 5 (mm) (placeholder)</div>
                </div>
                <div class="paramBody">
                  <input id="fil_5" name="fil_5" type="range" min="0" max="30" step="0.5" value="0" />
                  <input class="valInput" id="fil_5Val" type="number" step="0.5" value="0" />
                </div>
              </div>
            </details>

            <details class="section">
              <summary>Baseplate</summary>

              <div class="check">
                <input id="bp_fil_1" type="checkbox" checked />
                <label for="bp_fil_1">BP_FIL_1</label>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">BP_FIL_1_R</div>
                  <div class="paramName">Base Plate Fillet 1 Radius (mm)</div>
                </div>
                <div class="paramBody">
                  <input id="bp_fil_1_r" name="bp_fil_1_r" type="range" min="0" max="40" step="0.5" value="8" />
                  <input class="valInput" id="bp_fil_1_rVal" type="number" step="0.5" value="8" />
                </div>
              </div>

              <div class="check">
                <input id="sh_fil_1" type="checkbox" />
                <label for="sh_fil_1">SH_FIL_1</label>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">SH_FIL_1_R</div>
                  <div class="paramName">Screw Hole Fillet 1 Radius (mm)</div>
                </div>
                <div class="paramBody">
                  <input id="sh_fil_1_r" name="sh_fil_1_r" type="range" min="0" max="40" step="0.5" value="4" />
                  <input class="valInput" id="sh_fil_1_rVal" type="number" step="0.5" value="4" />
                </div>
              </div>
            </details>

            <details class="section">
              <summary>Toe Hook</summary>

              <div class="check">
                <input id="th_fil_1" type="checkbox"  checked />
                <label for="th_fil_1">TH_FIL_1</label>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TH_FIL_1_R</div>
                  <div class="paramName">TH Fillet 1 Radius (mm)</div>
                </div>
                <div class="paramBody">
                  <input id="th_fil_1_r" name="th_fil_1_r" type="range" min="0" max="40" step="0.5" value="4" />
                  <input class="valInput" id="th_fil_1_rVal" type="number" step="0.5" value="4" />
                </div>
              </div>

              <div class="check">
                <input id="th_fil_2" type="checkbox"  checked />
                <label for="th_fil_2">TH_FIL_2</label>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TH_FIL_2_R</div>
                  <div class="paramName">TH Fillet 2 Radius (mm)</div>
                </div>
                <div class="paramBody">
                  <input id="th_fil_2_r" name="th_fil_2_r" type="range" min="0" max="40" step="0.5" value="4" />
                  <input class="valInput" id="th_fil_2_rVal" type="number" step="0.5" value="4" />
                </div>
              </div>
            </details>

            <details class="section">
              <summary>Heel</summary>

              <div class="check">
                <input id="heel_fil_1" type="checkbox"  checked />
                <label for="heel_fil_1">HEEL_FIL_1</label>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">HEEL_FIL_1_R</div>
                  <div class="paramName">Heel Fillet 1 Radius (mm)</div>
                </div>
                <div class="paramBody">
                  <input id="heel_fil_1_r" name="heel_fil_1_r" type="range" min="0" max="40" step="0.5" value="4" />
                  <input class="valInput" id="heel_fil_1_rVal" type="number" step="0.5" value="4" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">HEEL_FIL_2_R</div>
                  <div class="paramName">Heel Fillet 2 Radius (mm)</div>
                </div>
                <div class="paramBody">
                  <input id="heel_fil_2_r" name="heel_fil_2_r" type="range" min="0" max="40" step="0.5" value="4" />
                  <input class="valInput" id="heel_fil_2_rVal" type="number" step="0.5" value="4" />
                </div>
              </div>
            </details>


          </details>
            <details class="section">
              <summary>Rail Math</summary>

              <details class="section" open>
                <summary>Tagent Profiles</summary>
                <div class="check">
                  <input id="tagent_profile_a" type="checkbox" />
                  <label for="tagent_profile_a">Tagent Profile A</label>
                </div>
                <div id="tagentProfileAControls" style="display:none; margin: 4px 0 10px 18px;">
                  <div class="paramRow">
                    <div class="paramTop">
                      <div class="paramTag">TAGENT_A_OFFSET_ROT</div>
                      <div class="paramName">Offset Rotation</div>
                    </div>
                    <div class="paramBody">
                      <input id="tagent_a_offset_rot" type="range" min="-180" max="180" step="1" value="0" />
                      <input class="valInput" id="tagent_a_offset_rotVal" type="number" min="-180" max="180" step="1" value="0" />
                    </div>
                  </div>
                  <div class="paramRow">
                    <div class="paramTop">
                      <div class="paramTag">TAGENT_A_MIDPOINT</div>
                      <div class="paramName">Midpoint</div>
                    </div>
                    <div class="paramBody">
                      <input id="tagent_a_midpoint" type="range" min="0" max="100" step="1" value="100" />
                      <input class="valInput" id="tagent_a_midpointVal" type="number" min="0" max="100" step="1" value="50" />
                    </div>
                  </div>
                  <div class="paramRow">
                    <div class="paramTop">
                      <div class="paramTag">TAGENT_A_PLACEHOLDER_1</div>
                      <div class="paramName">Placeholder 1</div>
                    </div>
                    <div class="paramBody">
                      <input id="tagent_a_placeholder_1" type="range" min="0" max="100" step="1" value="0" />
                      <input class="valInput" id="tagent_a_placeholder_1Val" type="number" min="0" max="100" step="1" value="0" />
                    </div>
                  </div>
                  <div class="paramRow">
                    <div class="paramTop">
                      <div class="paramTag">TAGENT_A_PLACEHOLDER_2</div>
                      <div class="paramName">Placeholder 2</div>
                    </div>
                    <div class="paramBody">
                      <input id="tagent_a_placeholder_2" type="range" min="0" max="100" step="1" value="0" />
                      <input class="valInput" id="tagent_a_placeholder_2Val" type="number" min="0" max="100" step="1" value="0" />
                    </div>
                  </div>
                  <div class="check">
                    <input id="tagent_a_bp_cut_perp" type="checkbox"  checked />
                    <label for="tagent_a_bp_cut_perp">Perpendicular Baseplate Cut @ A</label>
                  </div>
                </div>
                <div class="check">
                  <input id="tagent_profile_b" type="checkbox" checked />
                  <label for="tagent_profile_b">Tagent Profile B</label>
                </div>
                <div class="check">
                  <input id="tagent_profile_c" type="checkbox" checked />
                  <label for="tagent_profile_c">Tagent Profile C</label>
                </div>
                <div class="check">
                  <input id="tagent_profile_d" type="checkbox" checked />
                  <label for="tagent_profile_d">Tagent Profile D</label>
                </div>
                <div id="tagentProfileDControls" style="display:none; margin: 4px 0 10px 18px;">
                  <div class="check">
                    <input id="tagent_d_cut_perp" type="checkbox" />
                    <label for="tagent_d_cut_perp">Perpendicular Heel Cut @ D</label>
                  </div>
                </div>
              </details>

              <details class="section">
                <summary>Toe Hook Rail Math</summary>
                <div class="check">
                  <input id="rail_math_current" type="checkbox" checked />
                  <label for="rail_math_current">Default: Hermite Fit</label>
                </div>
                <div class="check">
                  <input id="rail_math_2" type="checkbox" />
                  <label for="rail_math_2">Rail Math 2: Linear Rails</label>
                </div>
                <div class="check">
                  <input id="rail_math_3" type="checkbox" />
                  <label for="rail_math_3">Rail Math 3: Linear + Fixed End Angle</label>
                </div>
                <div class="check">
                  <input id="rail_math_4" type="checkbox" />
                  <label for="rail_math_4">Rail Math 4: Arc Rails (Absolute Frame)</label>
                </div>
                <div class="check">
                  <input id="rail_math_5" type="checkbox" />
                  <label for="rail_math_5">Rail Math 5</label>
                </div>
                <div id="railMath5CullWrap" class="paramRow" style="display:none;">
                  <div class="paramTop">
                    <div class="paramTag">RAIL_MATH_5_CULL</div>
                    <div class="paramName">Rail Math 5 Cull Count (near C)</div>
                  </div>
                  <div class="paramBody">
                    <input id="rail_math_5_cull" name="rail_math_5_cull" type="range" min="0" max="4" step="1" value="1" />
                    <input class="valInput" id="rail_math_5_cullVal" type="number" min="0" max="4" step="1" value="1" />
                  </div>
                </div>
                <div id="railMath5AddbackWrap" class="paramRow" style="display:none;">
                  <div class="paramTop">
                    <div class="paramTag">RAIL_MATH_5_ADDBACK</div>
                    <div class="paramName">Rail Math 5 Add-Back Profiles (Last AC -> C)</div>
                  </div>
                  <div class="paramBody">
                    <input id="rail_math_5_addback" name="rail_math_5_addback" type="range" min="0" max="6" step="1" value="0" />
                    <input class="valInput" id="rail_math_5_addbackVal" type="number" min="0" max="6" step="1" value="0" />
                  </div>
                </div>
                <div class="check">
                  <input id="rail_math_6" type="checkbox" />
                  <label for="rail_math_6">Rail Math 6</label>
                </div>
                <div id="railMath6SubWrap" style="display:none; margin: 4px 0 8px 18px;">
                  <div class="check">
                    <input id="rail_math_6a" type="checkbox"  checked />
                    <label for="rail_math_6a">Rail Math 6A</label>
                  </div>
                  <div class="check">
                    <input id="rail_math_6b" type="checkbox" />
                    <label for="rail_math_6b">Rail Math 6B</label>
                  </div>
                  <div class="check">
                    <input id="rail_math_6c" type="checkbox" />
                    <label for="rail_math_6c">Rail Math 6C</label>
                  </div>
                </div>
                <div class="check">
                  <input id="rail_math_7" type="checkbox" />
                  <label for="rail_math_7">Rail Math 7</label>
                </div>
                <div class="check">
                  <input id="rail_math_8" type="checkbox" />
                  <label for="rail_math_8">Rail Math 8</label>
                </div>
                <div class="check">
                  <input id="rail_math_9" type="checkbox" />
                  <label for="rail_math_9">Rail Math 9</label>
                </div>
                <div class="check">
                  <input id="rail_math_10" type="checkbox" />
                  <label for="rail_math_10">Rail Math 10</label>
                </div>
              </details>

              <details class="section">
                <summary>Heel Kick Rail Math</summary>
                <div class="check">
                  <input id="heel_rail_math_1" type="checkbox" />
                  <label for="heel_rail_math_1">Heel Rail Math 1</label>
                </div>
                <div class="check">
                  <input id="heel_rail_math_2" type="checkbox" checked />
                  <label for="heel_rail_math_2">Heel Rail Math 2</label>
                </div>
                <div class="check">
                  <input id="heel_rail_math_3" type="checkbox" />
                  <label for="heel_rail_math_3">Heel Rail Math 3</label>
                </div>
                <div id="heelRailMath3Wrap" style="display:none; margin: 4px 0 8px 18px;">
                  <div class="paramRow">
                    <div class="paramTop">
                      <div class="paramTag">HEEL_RM3_SWEEP</div>
                      <div class="paramName">Heel RM3 Arc Sweep</div>
                    </div>
                    <div class="paramBody">
                      <input id="heel_rm3_sweep" name="heel_rm3_sweep" type="range" min="0" max="2" step="0.01" value="1" />
                      <input class="valInput" id="heel_rm3_sweepVal" type="number" min="0" max="2" step="0.01" value="1" />
                    </div>
                  </div>
                  <div class="paramRow">
                    <div class="paramTop">
                      <div class="paramTag">HEEL_RM3_BIAS</div>
                      <div class="paramName">Heel RM3 Midpoint Bias</div>
                    </div>
                    <div class="paramBody">
                      <input id="heel_rm3_bias" name="heel_rm3_bias" type="range" min="-1" max="1" step="0.01" value="0" />
                      <input class="valInput" id="heel_rm3_biasVal" type="number" min="-1" max="1" step="0.01" value="0" />
                    </div>
                  </div>
                  <div class="paramRow">
                    <div class="paramTop">
                      <div class="paramTag">HEEL_RM3_BLEND</div>
                      <div class="paramName">Heel RM3 Blend</div>
                    </div>
                    <div class="paramBody">
                      <input id="heel_rm3_blend" name="heel_rm3_blend" type="range" min="0" max="1" step="0.01" value="1" />
                      <input class="valInput" id="heel_rm3_blendVal" type="number" min="0" max="1" step="0.01" value="1" />
                    </div>
                  </div>
                </div>
                <div class="check">
                  <input id="heel_rail_math_4" type="checkbox" />
                  <label for="heel_rail_math_4">Heel Rail Math 4</label>
                </div>
                <div id="heelRailMath4SubWrap" style="display: none; margin: 6px 0 10px 18px;">
                  <div class="check">
                    <input id="heel_rail_math_4a" type="checkbox" checked />
                    <label for="heel_rail_math_4a">Heel Rail Math 4A</label>
                  </div>
                  <div class="check">
                    <input id="heel_rail_math_4b" type="checkbox" />
                    <label for="heel_rail_math_4b">Heel Rail Math 4B</label>
                  </div>
                  <div id="heelRailMath4bWrap" style="display:none; margin: 4px 0 8px 18px;">
                    <div class="paramRow">
                      <div class="paramTop">
                        <div class="paramTag">HEEL_RM4B_SWEEP</div>
                        <div class="paramName">Heel RM4B Arc Sweep</div>
                      </div>
                      <div class="paramBody">
                        <input id="heel_rm4b_sweep" name="heel_rm4b_sweep" type="range" min="0" max="2" step="0.01" value="1" />
                        <input class="valInput" id="heel_rm4b_sweepVal" type="number" min="0" max="2" step="0.01" value="1" />
                      </div>
                    </div>
                    <div class="paramRow">
                      <div class="paramTop">
                        <div class="paramTag">HEEL_RM4B_BIAS</div>
                        <div class="paramName">Heel RM4B Midpoint Bias</div>
                      </div>
                      <div class="paramBody">
                        <input id="heel_rm4b_bias" name="heel_rm4b_bias" type="range" min="-1" max="1" step="0.01" value="0" />
                        <input class="valInput" id="heel_rm4b_biasVal" type="number" min="-1" max="1" step="0.01" value="0" />
                      </div>
                    </div>
                    <div class="paramRow">
                      <div class="paramTop">
                        <div class="paramTag">HEEL_RM4B_BLEND</div>
                        <div class="paramName">Heel RM4B Blend</div>
                      </div>
                      <div class="paramBody">
                        <input id="heel_rm4b_blend" name="heel_rm4b_blend" type="range" min="0" max="1" step="0.01" value="1" />
                        <input class="valInput" id="heel_rm4b_blendVal" type="number" min="0" max="1" step="0.01" value="1" />
                      </div>
                    </div>
                  </div>
                </div>
                <div class="check">
                  <input id="heel_rail_math_5" type="checkbox" />
                  <label for="heel_rail_math_5">Heel Rail Math 5</label>
                </div>
              </details>
            </details>
          </details>

          <details class="section hasInlinePanelActions" id="layersSection" open>
            <summary>Layers</summary>
            <div class="layersHeaderRow" style="margin: 4px 0 8px 0;">
              <div class="sectionMeta" style="margin: 0;">Visibility + cached parahook settings layers</div>
              <button id="layersMaterialsToggle" type="button" class="panelActionBtn" aria-pressed="true" title="Toggle shoe materials">Mats On</button>
            </div>
            <div class="panelActionRow">
                  <button id="layersFloatToggle" type="button" class="panelActionBtn" aria-pressed="false" aria-label="Float panel" title="Float panel">▣</button>
                  <button id="layersWindowToggle" type="button" class="panelActionBtn" aria-pressed="false" aria-label="Open panel in window" title="Open panel in window">⇱</button>
            </div>

            <div class="layersHeaderRow">
              <div class="layersGroupTitle">Reference Views</div>
            </div>
            <div id="layersReferenceList" class="layersList"></div>

            <div class="layersHeaderRow" style="margin-top:10px;">
              <div class="layersGroupTitle">Generated Model</div>
            </div>
            <div id="layersModelVisibilityList" class="layersList"></div>

            <div class="btnRow twoCols" style="margin-top:10px;">
              <button id="layerSaveCurrent" type="button">Save Current</button>
              <button id="layerUpdateActive" type="button" class="secondary">Update Active</button>
            </div>
            <button id="layerDeleteActive" type="button" class="secondary" style="width:100%;">Delete Active</button>

            <div class="layersHeaderRow" style="margin-top:10px;">
              <div class="layersGroupTitle">Saved Layers</div>
            </div>
            <div id="layersModelList" class="layersList"></div>
          </details>

          <details class="section hasInlinePanelActions" id="radioSection">
            <summary>Gusano</summary>
            <div class="sectionMeta">Keota Radio</div>
            <div class="panelActionRow">
                  <button id="radioFloatToggle" type="button" class="panelActionBtn" aria-pressed="false" aria-label="Float panel" title="Float panel">▣</button>
                  <button id="radioWindowToggle" type="button" class="panelActionBtn" aria-pressed="false" aria-label="Open panel in window" title="Open panel in window">⇱</button>
            </div>

            <div class="radioRow">
              <button id="radioPlayPause" type="button" class="secondary" aria-label="Play">â–¶</button>
              <div id="radioStatus" class="radioTiny">idle</div>
              <button id="radioOpenLink" type="button" class="secondary">Open</button>
            </div>

            <div class="row">
              <label>Volume
                <input id="radioVolume" type="range" min="0" max="100" step="1" value="60" />
              </label>
            </div>

            <div class="row">
              <label>Seek
                <input id="radioSeek" type="range" min="0" max="1000" step="1" value="0" />
              </label>
              <div id="radioSeekTime" class="radioTiny">0:00 / 0:00</div>
            </div>

            <div class="row">
              <label>Sampler Burst (sec)
                <input id="radioBurstDuration" type="range" min="0.01" max="1" step="0.01" value="0.10" />
              </label>
              <input class="valInput" id="radioBurstDurationVal" type="number" min="0.01" max="1" step="0.01" value="0.10" />
            </div>

            <iframe
              id="radioScIframe"
              title="SoundCloud player"
              allow="autoplay"
              referrerpolicy="no-referrer"
              loading="lazy"
            ></iframe>
          </details>
        </form>

        
      </div>
    </div>

    <button
      id="toolbarMinimizeEdgeBtn"
      type="button"
      aria-pressed="false"
      aria-label="Hide toolbar"
      title="Hide toolbar"
    >&#9664;</button>
    <div id="materialsFloatPanel" class="floatHost" hidden>
      <div id="materialsHeader" class="floatHostHeader">
        <div class="floatHostTitleWrap">
          <div id="materialsTitle" class="floatHostTitle">Materials</div>
        </div>
        <div class="panelActionRow">
          <button id="materialsCloseBtn" type="button" class="panelActionBtn" aria-label="Close materials panel" title="Close">X</button>
        </div>
      </div>
      <div id="materialsBody" class="floatHostBody">
        <div id="materialsFocusText">Focused item: none</div>
        <div id="materialsPartSection">
          <div class="materialsSectionLabel">Object Part</div>
          <div class="materialsPartListWrap">
            <div id="materialsPartList" aria-label="Object part list"></div>
          </div>
        </div>
        <div id="materialsTuneSection">
          <div class="materialTuneRow">
            <label class="materialTuneLabel" for="materialsMetalnessRange">Metalness</label>
            <input id="materialsMetalnessRange" class="materialTuneRange" type="range" min="0" max="1" step="0.01" value="0.05" />
          </div>
          <div class="materialTuneRow">
            <label class="materialTuneLabel" for="materialsRoughnessRange">Roughness</label>
            <input id="materialsRoughnessRange" class="materialTuneRange" type="range" min="0" max="1" step="0.01" value="0.75" />
          </div>
          <div class="materialTuneRow">
            <label class="materialTuneLabel" for="materialsOpacityRange">Opacity</label>
            <input id="materialsOpacityRange" class="materialTuneRange" type="range" min="0.08" max="1" step="0.01" value="1" />
          </div>
          <div class="materialsColorRow">
            <input id="materialsColorPicker" type="color" value="#ffffff" aria-label="Material color" />
            <input id="materialsColorHex" type="text" value="#FFFFFF" maxlength="7" aria-label="Material hex color" />
          </div>
        </div>
        <button id="materialsNewBtn" type="button" class="secondary">New Material</button>
        <div class="materialsListWrap">
          <div class="materialsList" id="materialsPresetList">
            <button type="button" class="secondary materialPresetBtn" data-mat-name="Default Material" data-mat-kind="default">Default Material</button>
            <button type="button" class="secondary materialPresetBtn" data-mat-name="White" data-mat-color="#ffffff">White</button>
            <button type="button" class="secondary materialPresetBtn" data-mat-name="Gray" data-mat-color="#808080">Gray</button>
            <button type="button" class="secondary materialPresetBtn" data-mat-name="Black" data-mat-color="#111111">Black</button>
            <button type="button" class="secondary materialPresetBtn" data-mat-name="Blue" data-mat-color="#2f6fff">Blue</button>
            <button type="button" class="secondary materialPresetBtn" data-mat-name="Red" data-mat-color="#d63c3c">Red</button>
            <button type="button" class="secondary materialPresetBtn" data-mat-name="Green" data-mat-color="#2f9b4f">Green</button>
          </div>
        </div>
      </div>
    </div>
    <canvas id="c"></canvas>
    <div id="gizmoViewportResizeHandle" aria-label="Resize gizmo viewport" title="Drag to resize gizmo viewport"></div>
    <div id="gizmoToolbarResizeHandle" aria-label="Resize gizmo toolbar" title="Drag to resize gizmo toolbar"></div>
    <button id="gizmoToggleBtn" type="button" aria-label="Gizmo settings" aria-pressed="false">Gizmo</button>
    <div id="gizmoGizmoPanel">
      <div class="gizmoStarsLabel">Line Alpha</div>
      <input id="gizmoLineOpacityRange" class="gizmoStarsRange" type="range" min="0" max="100" step="1" value="12" />
      <div class="gizmoStarsLabel">Sphere Size</div>
      <input id="gizmoSphereSizeRange" class="gizmoStarsRange" type="range" min="40" max="250" step="1" value="100" />
      <div class="gizmoStarsLabel">Text Size</div>
      <input id="gizmoTextSizeRange" class="gizmoStarsRange" type="range" min="50" max="250" step="1" value="100" />
    </div>
    <button id="gizmoCardinalUpBadge" type="button" aria-label="Toggle cardinal up">Up +Z</button>
    <div id="gizmoFpsBadge" aria-label="Frames per second">-- fps</div>
    <button id="gizmoRollCcwBtn" type="button" aria-label="Roll clockwise" title="Roll +90ï¿½">&#8635;</button>
    <button id="gizmoRollCwBtn" type="button" aria-label="Roll counter-clockwise" title="Roll -90ï¿½">&#8634;</button>
    <div id="gizmoControlsPanel">
      <button id="gizmoModeCurrentBtn" class="gizmoModeBtn" type="button" aria-pressed="false">Ant Crawl</button>
      <button id="gizmoModeOrbitBtn" class="gizmoModeBtn" type="button" aria-pressed="true">Orbit</button>
      <button id="gizmoModeTrackballBtn" class="gizmoModeBtn" type="button" aria-pressed="false">Trackball</button>
      <button id="gizmoModeArcballBtn" class="gizmoModeBtn" type="button" aria-pressed="false">Arcball</button>
      <div id="gizmoGravityLabel" class="gizmoSliderLabel">Inertia</div>
      <input id="gizmoGravityRange" type="range" min="0" max="100" step="1" value="70" title="Gravity / inertia" aria-label="Camera inertia" />
      <div id="gizmoDecayLabel" class="gizmoSliderLabel">Decay</div>
      <input id="gizmoDecayRange" type="range" min="0" max="101" step="1" value="0" title="Decay time" aria-label="Decay time" />
      <button id="gizmoSpinToggleBtn" type="button" aria-pressed="false">Spin</button>
      <div id="gizmoSpinSpeedLabel" class="gizmoSliderLabel">Spin Speed</div>
      <input id="gizmoSpinSpeedRange" type="range" min="0" max="100" step="1" value="55" title="Spin speed" aria-label="Spin speed" />
      <button id="gizmoZoomStopsInertiaBtn" type="button" aria-pressed="false" title="Toggle zoom stopping inertia">Zoom Stops Inertia</button>
    </div>
    <button id="gizmoViewBtn" type="button">View</button>
    <button id="gizmoControlsBtn" type="button">Controls</button>
    <div id="gizmoViewPanel">
      <details class="gizmoSubSection" open>
        <summary>Camera</summary>
        <div class="gizmoSubSectionBody">
          <button id="gizmoViewResetBtn" class="gizmoViewActionBtn" type="button">Reset</button>
          <button id="gizmoViewPerspectiveBtn" class="gizmoViewActionBtn" type="button" aria-pressed="true">Perspective</button>
          <button id="gizmoViewOrthographicBtn" class="gizmoViewActionBtn" type="button" aria-pressed="false">Orthographic</button>
          <div class="gizmoStarsLabel">Zoom</div>
          <input id="gizmoViewZoomRange" type="range" min="25" max="400" step="1" value="100" title="Camera zoom" aria-label="Camera zoom" />
          <div class="gizmoStarsLabel">FOV</div>
          <input id="gizmoViewFovRange" type="range" min="0" max="100" step="1" value="45" title="Camera FOV (0 = Orthographic)" aria-label="Camera FOV" />
          <button id="gizmoViewTopBtn" class="gizmoViewActionBtn" type="button">Top</button>
          <button id="gizmoViewFrontBtn" class="gizmoViewActionBtn" type="button">Front</button>
        </div>
      </details>
      <details class="gizmoSubSection" open>
        <summary>Render</summary>
        <div class="gizmoSubSectionBody">
          <button id="gizmoViewStyleShadedBtn" class="gizmoViewActionBtn" type="button" aria-pressed="true">Shaded</button>
          <button id="gizmoViewStyleEdgesBtn" class="gizmoViewActionBtn" type="button" aria-pressed="false">Wireframe</button>
          <button id="gizmoViewStyleXrayBtn" class="gizmoViewActionBtn" type="button" aria-pressed="false">X-Ray</button>
          <button id="gizmoViewStyleClayBtn" class="gizmoViewActionBtn" type="button" aria-pressed="false">Clay</button>
        </div>
      </details>
      <details id="gizmoGridSection" class="gizmoSubSection">
        <summary>Grid</summary>
        <div class="gizmoSubSectionBody">
          <div id="gizmoGridControls" class="open">
            <div class="gizmoStarsLabel">Grid Size</div>
            <input id="gizmoGridSizeRange" class="gizmoStarsRange" type="range" min="100" max="4000" step="50" value="600" />
            <div class="gizmoStarsLabel">Grid Divisions</div>
            <input id="gizmoGridDivisionsRange" class="gizmoStarsRange" type="range" min="4" max="240" step="1" value="30" />
            <div class="gizmoStarsLabel">Major Step</div>
            <input id="gizmoGridMajorStepRange" class="gizmoStarsRange" type="range" min="1" max="40" step="1" value="5" />
            <div class="gizmoStarsLabel">Grid Opacity</div>
            <input id="gizmoGridOpacityRange" class="gizmoStarsRange" type="range" min="0" max="100" step="1" value="45" />
            <button id="gizmoGridContrastBtn" class="gizmoViewActionBtn" type="button" aria-pressed="false">High Contrast</button>
          </div>
        </div>
      </details>
      <details class="gizmoSubSection" open>
        <summary>Background</summary>
        <div class="gizmoSubSectionBody">
          <button id="gizmoViewBgDarkBlueBtn" class="gizmoViewActionBtn" type="button" aria-pressed="true">Dark Blue</button>
          <button id="gizmoViewBgBlackBtn" class="gizmoViewActionBtn" type="button" aria-pressed="false">Black</button>
          <details id="gizmoScenesSection" class="gizmoSubSection">
            <summary>Scenes</summary>
            <div class="gizmoSubSectionBody">
              <button id="gizmoViewStarsBtn" class="gizmoViewActionBtn" type="button">Stars</button>
              <button id="gizmoViewNebulaBtn" class="gizmoViewActionBtn" type="button">Nebula</button>
              <button id="gizmoViewSwarmBtn" class="gizmoViewActionBtn" type="button">Swarm</button>
              <div id="gizmoStarsControls">
                <div class="gizmoStarsLabel">Count</div>
                <input id="gizmoStarsCountRange" class="gizmoStarsRange" type="range" min="20" max="2000" step="1" value="80" />
                <div class="gizmoStarsLabel">Motion</div>
                <input id="gizmoStarsMotionRange" class="gizmoStarsRange" type="range" min="0" max="200" step="1" value="100" />
                <div class="gizmoStarsLabel">Glow</div>
                <input id="gizmoStarsGlowRange" class="gizmoStarsRange" type="range" min="0" max="200" step="1" value="100" />
                <div class="gizmoStarsLabel">Wires</div>
                <input id="gizmoStarsWireRange" class="gizmoStarsRange" type="range" min="0" max="100" step="1" value="24" />
                <div class="gizmoStarsLabel">Line Likelihood</div>
                <input id="gizmoStarsLikelihoodRange" class="gizmoStarsRange" type="range" min="0" max="100" step="1" value="50" />
                <div class="gizmoStarsLabel">Line Distance</div>
                <input id="gizmoStarsLineDistanceRange" class="gizmoStarsRange" type="range" min="25" max="500" step="1" value="100" />
                <div class="gizmoStarsLabel">Node Size</div>
                <input id="gizmoStarsSizeRange" class="gizmoStarsRange" type="range" min="50" max="250" step="1" value="100" />
                <div class="gizmoStarsLabel">Max Distance</div>
                <input id="gizmoStarsDistanceRange" class="gizmoStarsRange" type="range" min="25" max="10000" step="1" value="100" />
              </div>
              <div id="gizmoNebulaControls">
                <div class="gizmoStarsLabel">Density</div>
                <input id="gizmoNebulaDensityRange" class="gizmoStarsRange" type="range" min="10" max="1000" step="1" value="100" />
                <div class="gizmoStarsLabel">Scale</div>
                <input id="gizmoNebulaScaleRange" class="gizmoStarsRange" type="range" min="20" max="300" step="1" value="100" />
                <div class="gizmoStarsLabel">Turbulence</div>
                <input id="gizmoNebulaTurbulenceRange" class="gizmoStarsRange" type="range" min="0" max="150" step="1" value="35" />
                <div class="gizmoStarsLabel">Drift</div>
                <input id="gizmoNebulaDriftRange" class="gizmoStarsRange" type="range" min="0" max="300" step="1" value="100" />
                <div class="gizmoStarsLabel">Glow</div>
                <input id="gizmoNebulaGlowRange" class="gizmoStarsRange" type="range" min="0" max="300" step="1" value="100" />
                <div class="gizmoStarsLabel">Color Shift</div>
                <input id="gizmoNebulaColorShiftRange" class="gizmoStarsRange" type="range" min="0" max="100" step="1" value="0" />
              </div>
              <div id="gizmoSwarmControls">
                <div class="gizmoStarsLabel">Count</div>
                <input id="gizmoSwarmCountRange" class="gizmoStarsRange" type="range" min="50" max="2000" step="10" value="300" />
                <div class="gizmoStarsLabel">Speed</div>
                <input id="gizmoSwarmSpeedRange" class="gizmoStarsRange" type="range" min="10" max="300" step="1" value="100" />
                <div class="gizmoStarsLabel">Cohesion</div>
                <input id="gizmoSwarmCohesionRange" class="gizmoStarsRange" type="range" min="0" max="200" step="1" value="45" />
                <div class="gizmoStarsLabel">Separation</div>
                <input id="gizmoSwarmSeparationRange" class="gizmoStarsRange" type="range" min="0" max="200" step="1" value="50" />
                <div class="gizmoStarsLabel">Alignment</div>
                <input id="gizmoSwarmAlignmentRange" class="gizmoStarsRange" type="range" min="0" max="200" step="1" value="50" />
                <div class="gizmoStarsLabel">Jitter</div>
                <input id="gizmoSwarmJitterRange" class="gizmoStarsRange" type="range" min="0" max="200" step="1" value="20" />
                <div class="gizmoStarsLabel">Anim Length</div>
                <input id="gizmoSwarmDecayRange" class="gizmoStarsRange" type="range" min="1" max="101" step="1" value="40" />
                <div class="gizmoStarsLabel">Progress</div>
                <input id="gizmoSwarmProgressRange" class="gizmoStarsRange" type="range" min="0" max="100" step="1" value="0" />
                <button id="gizmoSwarmExplodeBtn" class="gizmoViewActionBtn" type="button" aria-pressed="false">Explode</button>
                <div class="gizmoStarsLabel">Explode Strength</div>
                <input id="gizmoSwarmExplodeStrengthRange" class="gizmoStarsRange" type="range" min="0" max="300" step="1" value="100" />
              </div>
            </div>
          </details>
        </div>
      </details>
    </div>
    <script type="module" src="/src/main.ts"></script>

    <script>
      function swapDomNodes(a, b) {
        if (!a || !b || !a.parentNode || !b.parentNode || a === b) return;
        const aMarker = document.createTextNode("");
        const bMarker = document.createTextNode("");
        a.parentNode.insertBefore(aMarker, a);
        b.parentNode.insertBefore(bMarker, b);
        aMarker.parentNode.replaceChild(b, aMarker);
        bMarker.parentNode.replaceChild(a, bMarker);
      }

      const titleBlockPanelSwapEl = document.getElementById("titleBlockPanel");
      const titlePanelSwapEl = document.getElementById("titlePanel");
      const appVersionSwapEl = document.getElementById("appVersion");
      const statusSwapEl = document.getElementById("status");
      if (titleBlockPanelSwapEl && titlePanelSwapEl && appVersionSwapEl && statusSwapEl) {
        titlePanelSwapEl.addEventListener("click", () => {
          swapDomNodes(appVersionSwapEl, statusSwapEl);
          titleBlockPanelSwapEl.classList.toggle("titleOnly");
          const isCollapsed = titleBlockPanelSwapEl.classList.contains("titleOnly");
          if (isCollapsed) {
            const titleStatsPanelEl = document.getElementById("titleStatsPanel");
            const titleStatsToggleBtnEl = document.getElementById("titleStatsToggleBtn");
            if (titleStatsPanelEl) {
              titleStatsPanelEl.classList.remove("open");
              titleStatsPanelEl.setAttribute("aria-hidden", "true");
            }
            if (titleStatsToggleBtnEl) {
              titleStatsToggleBtnEl.textContent = "Show Stats";
              titleStatsToggleBtnEl.setAttribute("aria-pressed", "false");
              titleStatsToggleBtnEl.setAttribute("title", "Show stats");
            }
          }
          window.dispatchEvent(
            new CustomEvent("toolbarTitleCollapseChange", {
              detail: { collapsed: isCollapsed }
            })
          );
        });
      }

      const debugToggleEl = document.getElementById("debug");
      if (debugToggleEl) {
        debugToggleEl.addEventListener("click", (e) => {
          const target = e.target;
          if (target instanceof HTMLElement && target.closest("input, button, a, label")) return;
          debugToggleEl.classList.toggle("collapsed");
        });
      }

      function clamp(n, lo, hi) {
        return Math.min(hi, Math.max(lo, n));
      }

      function bindRangeToNumber(rangeId, numberId) {
        const r = document.getElementById(rangeId);
        const n = document.getElementById(numberId);
        if (!r || !n) return;
        let numberChangeDebounceTimer = null;
        const NUMBER_CHANGE_DEBOUNCE_MS = 120;

        if (typeof r.min === "string") n.min = r.min;
        if (typeof r.max === "string") n.max = r.max;
        if (typeof r.step === "string") n.step = r.step || n.step || "1";

        const syncNumber = () => { n.value = String(r.value); };

        const syncRange = (immediateChange = false) => {
          const raw = String(n.value ?? "");
          if (!immediateChange) {
            // Allow partial typing in number boxes (e.g. "1.", "-", ".")
            // without immediately normalizing and resetting the caret.
            if (
              raw === "" ||
              raw === "-" ||
              raw === "+" ||
              raw === "." ||
              raw === "-." ||
              raw === "+." ||
              /[.]$/.test(raw)
            ) {
              return;
            }
          }
          const lo = Number.isFinite(Number(r.min)) ? Number(r.min) : -Infinity;
          const hi = Number.isFinite(Number(r.max)) ? Number(r.max) : Infinity;
          const v = clamp(Number(n.value), lo, hi);
          if (!Number.isFinite(v)) return;

          r.value = String(v);
          if (immediateChange) n.value = String(v);
          r.dispatchEvent(new Event("input", { bubbles: true }));
          if (numberChangeDebounceTimer != null) {
            clearTimeout(numberChangeDebounceTimer);
            numberChangeDebounceTimer = null;
          }
          if (immediateChange) {
            r.dispatchEvent(new Event("change", { bubbles: true }));
            return;
          }
          numberChangeDebounceTimer = setTimeout(() => {
            numberChangeDebounceTimer = null;
            r.dispatchEvent(new Event("change", { bubbles: true }));
          }, NUMBER_CHANGE_DEBOUNCE_MS);
        };

        r.addEventListener("input", syncNumber);
        n.addEventListener("input", () => syncRange(false));
        n.addEventListener("change", () => syncRange(true));

        syncNumber();
      }

      // -----------------------------
      // Range <-> Number bindings
      // -----------------------------
      const ids = [
        ["tolerance", "toleranceVal"],
        ["debounceMs", "debounceMsVal"],
        ["sectionCutOffset", "sectionCutOffsetVal"],

        // Shoe
        ["shoeSize", "shoeSizeVal"],
        ["shoeScale", "shoeScaleVal"],
        ["shoeAlpha", "shoeAlphaVal"],
        ["shoeX", "shoeXVal"],
        ["shoeY", "shoeYVal"],
        ["shoeZ", "shoeZVal"],
        ["shoeRot", "shoeRotVal"],

        // Footpad
        ["footpadX", "footpadXVal"],
        ["footpadY", "footpadYVal"],
        ["footpadZ", "footpadZVal"],
        ["footpadRot", "footpadRotVal"],

        // Premade Hooks
        ["hookX", "hookXVal"],
        ["hookY", "hookYVal"],
        ["hookZ", "hookZVal"],
        ["hookRot", "hookRotVal"],

        // Generated model (viewer-only transform)
        ["modelX", "modelXVal"],
        ["modelY", "modelYVal"],
        ["modelZ", "modelZVal"],
        ["modelRotX", "modelRotXVal"],
        ["modelRotY", "modelRotYVal"],
        ["modelRot", "modelRotVal"],

        // Baseplate
        // Baseplate
        ["bp_len", "bp_lenVal"],
        ["bp_wid", "bp_widVal"],
        ["bp_thk", "bp_thkVal"],
        ["bp_heelPct", "bp_heelPctVal"],
        ["bp_toePct", "bp_toePctVal"],
        ["bp_p2x", "bp_p2xVal"],
        ["bp_p3x", "bp_p3xVal"],
        ["bp_p4x", "bp_p4xVal"],


        // Baseplate Screw Holes
        ["bp_sh_x", "bp_sh_xVal"],
        ["bp_sh_y", "bp_sh_yVal"],
        ["bp_sh_ang", "bp_sh_angVal"],
        ["bp_sh_dia", "bp_sh_diaVal"],
        ["bp_sh_washer", "bp_sh_washerVal"],
        ["bp_sh_slot", "bp_sh_slotVal"],
        ["bp_sh_dist", "bp_sh_distVal"],
        ["bp_sh_ang2", "bp_sh_ang2Val"],
        ["bp_sh_off2", "bp_sh_off2Val"],

        // Toe
        ["toe_thk", "toe_thkVal"],

        // Toe A
        ["toe_a_p1s", "toe_a_p1sVal"],
        ["toe_a_p3s", "toe_a_p3sVal"],
        ["toe_a_endx", "toe_a_endxVal"],
        ["toe_a_endz", "toe_a_endzVal"],
        ["toe_a_enda", "toe_a_endaVal"],
        ["toe_a_strength", "toe_a_strengthVal"],

        // Toe B
        ["toe_b_sta", "toe_b_staVal"],
        ["toe_ab_mid", "toe_ab_midVal"],
        ["toe_b_p1s", "toe_b_p1sVal"],
        ["toe_b_p3s", "toe_b_p3sVal"],
        ["toe_b_endx", "toe_b_endxVal"],
        ["toe_b_endz", "toe_b_endzVal"],
        ["toe_b_enda", "toe_b_endaVal"],
        ["toe_b_strength", "toe_b_strengthVal"],

        // Toe C
        ["toe_c_sta", "toe_c_staVal"],
        ["toe_bc_mid", "toe_bc_midVal"],
        ["toe_c_p1s", "toe_c_p1sVal"],
        ["toe_c_p3s", "toe_c_p3sVal"],
        ["toe_c_endx", "toe_c_endxVal"],
        ["toe_c_endz", "toe_c_endzVal"],
        ["toe_c_enda", "toe_c_endaVal"],
        ["toe_c_strength", "toe_c_strengthVal"],

        // Heel
        ["heel_h_c", "heel_h_cVal"],
        ["heel_h_d", "heel_h_dVal"],
        ["heel_cd_mid", "heel_cd_midVal"],
        ["heel_cd_mid_pct", "heel_cd_mid_pctVal"],
        ["heel_f1", "heel_f1Val"],
        ["heel_f2", "heel_f2Val"],

        // Fillets
        ["fil_1", "fil_1Val"],
        ["fil_2", "fil_2Val"],
        ["fil_3", "fil_3Val"],
        ["fil_4", "fil_4Val"],
        ["fil_5", "fil_5Val"],
        ["sh_fil_1_r", "sh_fil_1_rVal"],
        ["th_fil_1_r", "th_fil_1_rVal"],
        ["th_fil_2_r", "th_fil_2_rVal"],
        ["heel_fil_1_r", "heel_fil_1_rVal"],
        ["heel_fil_2_r", "heel_fil_2_rVal"],
        ["bp_fil_1_r", "bp_fil_1_rVal"],
        ["tagent_a_offset_rot", "tagent_a_offset_rotVal"],
        ["tagent_a_midpoint", "tagent_a_midpointVal"],
        ["tagent_a_placeholder_1", "tagent_a_placeholder_1Val"],
        ["tagent_a_placeholder_2", "tagent_a_placeholder_2Val"],
      ];

      for (const pair of ids) bindRangeToNumber(pair[0], pair[1]);

      // -----------------------------
      // Shoe size -> scale mapping
      // -----------------------------
      const shoeSizeEl = document.getElementById("shoeSize");
      const shoeScaleEl = document.getElementById("shoeScale");
      const shoeScaleValEl = document.getElementById("shoeScaleVal");

      function computeShoeScaleFromSize(size) {
        // UI-calibrated display scale: size 5 => 0.50, size 14 => 1.25 (linear)
        const clamped = Math.min(14, Math.max(5, Number(size) || 10));
        const t = (clamped - 5) / 9;
        return 0.5 + t * 0.75;
      }

      function updateShoeScale() {
        if (!shoeSizeEl || !shoeScaleEl || !shoeScaleValEl) return;
        const size = Number(shoeSizeEl.value);
        const scale = computeShoeScaleFromSize(size);

        shoeScaleEl.value = String(scale.toFixed(3));
        shoeScaleValEl.value = String(scale.toFixed(3));
        shoeScaleEl.dispatchEvent(new Event("input", { bubbles: true }));
      }

      if (shoeSizeEl) {
        shoeSizeEl.addEventListener("input", updateShoeScale);
        updateShoeScale();
      }

      const tagentProfileAEl = document.getElementById("tagent_profile_a");
      const tagentProfileAControlsEl = document.getElementById("tagentProfileAControls");
      const tagentProfileDEl = document.getElementById("tagent_profile_d");
      const tagentProfileDControlsEl = document.getElementById("tagentProfileDControls");
      function syncTagentProfileAControls() {
        if (!tagentProfileAEl || !tagentProfileAControlsEl) return;
        tagentProfileAControlsEl.style.display = tagentProfileAEl.checked ? "none" : "";
      }
      function syncTagentProfileDControls() {
        if (!tagentProfileDEl || !tagentProfileDControlsEl) return;
        tagentProfileDControlsEl.style.display = tagentProfileDEl.checked ? "none" : "";
      }
      if (tagentProfileAEl && tagentProfileAControlsEl) {
        tagentProfileAEl.addEventListener("change", syncTagentProfileAControls);
        syncTagentProfileAControls();
      }
      if (tagentProfileDEl && tagentProfileDControlsEl) {
        tagentProfileDEl.addEventListener("change", syncTagentProfileDControls);
        syncTagentProfileDControls();
      }

      (function setupPanelPopouts() {
        const panelStates = new Map();
        const mobileLayoutQuery = window.matchMedia("(max-width: 900px), (pointer: coarse)");
        const PANEL_BTN_ICONS = {
          float: "▣",
          window: "⇱",
          dock: "↩"
        };

        function isMobileLayout() {
          return mobileLayoutQuery.matches || document.body.classList.contains("mobile-layout");
        }

        function getPopupDoc(win, title) {
          if (!win || win.closed) return null;
          const d = win.document;
          if (!d.body || !d.getElementById("popupPanelHost")) {
            d.open();
            d.write(`<!doctype html><html><head><title>${title}</title>
              <meta charset="utf-8" />
              <style>
                html,body{margin:0;padding:0;height:100%;overflow:hidden;background:#0b0b0f;color:#e8e8ea;font-family:system-ui,Segoe UI,Arial,sans-serif}
                #popupPanelHost{box-sizing:border-box;height:100%;padding:12px;display:flex;flex-direction:column;min-height:0}
                button{font:inherit}
              </style>
            </head><body><div id="popupPanelHost"></div></body></html>`);
            d.close();

            const head = d.head;
            if (head) {
              const styleNodes = document.querySelectorAll('style, link[rel="stylesheet"]');
              styleNodes.forEach((node) => {
                head.appendChild(node.cloneNode(true));
              });
            }
          }
          return d;
        }

        function ensureState(key, panelEl, floatBtn, winBtn, title) {
          let st = panelStates.get(key);
          if (st) return st;
          st = {
            key,
            title,
            panelEl,
            floatBtn,
            winBtn,
            mode: "docked",
            popup: null,
            floatHost: null,
            floatShellHeader: null,
            floatShellBody: null,
            floatShellFloatBtn: null,
            floatShellWinBtn: null,
            popupShellHeader: null,
            popupShellBody: null,
            popupShellFloatBtn: null,
            popupShellWinBtn: null,
            toolbarStubEl: null,
            placeholder: document.createComment(`${key}-placeholder`)
          };
          panelStates.set(key, st);
          return st;
        }

        function ensurePlaceholder(st) {
          if (!st.placeholder.parentNode && st.panelEl.parentNode) {
            st.panelEl.parentNode.insertBefore(st.placeholder, st.panelEl);
          }
        }

        function prepareFloatScrollLayout(_st) {}
        function restoreFloatScrollLayout(_st) {}

        function createFloatToolbarStub(st) {
          if (!(st.panelEl instanceof HTMLDetailsElement)) return;
          if (st.toolbarStubEl) return;
          const stub = document.createElement("details");
          stub.className = "section floatToolbarStub";
          const summary = document.createElement("summary");
          summary.textContent = st.title;
          const meta = document.createElement("div");
          meta.className = "sectionMeta";
          meta.textContent = "Floated. Click to dock.";
          stub.appendChild(summary);
          stub.appendChild(meta);
          summary.addEventListener("click", (ev) => {
            ev.preventDefault();
            ev.stopPropagation();
            dock(st);
          });
          st.toolbarStubEl = stub;
          if (st.placeholder.parentNode) {
            st.placeholder.parentNode.insertBefore(stub, st.placeholder.nextSibling);
          }
        }

        function removeFloatToolbarStub(st) {
          if (!st.toolbarStubEl) return;
          st.toolbarStubEl.remove();
          st.toolbarStubEl = null;
        }

        function createFloatShell(st, host) {
          const header = document.createElement("div");
          header.className = "floatHostHeader";

          const titleWrap = document.createElement("div");
          titleWrap.className = "floatHostTitleWrap";
          const titleEl = document.createElement("div");
          titleEl.className = "floatHostTitle";
          titleEl.textContent = st.title;
          titleWrap.appendChild(titleEl);

          if (st.panelEl instanceof Element) {
            const directMeta = st.panelEl.querySelector(":scope > .sectionMeta");
            if (directMeta && (directMeta.textContent ?? "").trim()) {
              const sub = document.createElement("div");
              sub.className = "floatHostSub";
              sub.textContent = directMeta.textContent ?? "";
              titleWrap.appendChild(sub);
            }
          }

          const actions = document.createElement("div");
          actions.className = "panelActionRow";
          const floatBtn = document.createElement("button");
          floatBtn.type = "button";
          floatBtn.className = "panelActionBtn";
          const winBtn = document.createElement("button");
          winBtn.type = "button";
          winBtn.className = "panelActionBtn";
          actions.appendChild(floatBtn);
          actions.appendChild(winBtn);

          floatBtn.addEventListener("click", (ev) => {
            ev.preventDefault();
            ev.stopPropagation();
            toggleFloat(st);
          });
          winBtn.addEventListener("click", (ev) => {
            ev.preventDefault();
            ev.stopPropagation();
            toggleWindow(st);
          });

          header.appendChild(titleWrap);
          header.appendChild(actions);

          const body = document.createElement("div");
          body.className = "floatHostBody";

          host.appendChild(header);
          host.appendChild(body);

          st.floatShellHeader = header;
          st.floatShellBody = body;
          st.floatShellFloatBtn = floatBtn;
          st.floatShellWinBtn = winBtn;
        }

        function clearFloatShellRefs(st) {
          st.floatShellHeader = null;
          st.floatShellBody = null;
          st.floatShellFloatBtn = null;
          st.floatShellWinBtn = null;
        }

        function createPopupShell(st, host, d) {
          const header = d.createElement("div");
          header.className = "floatHostHeader";

          const titleWrap = d.createElement("div");
          titleWrap.className = "floatHostTitleWrap";
          const titleEl = d.createElement("div");
          titleEl.className = "floatHostTitle";
          titleEl.textContent = st.title;
          titleWrap.appendChild(titleEl);

          if (st.panelEl instanceof Element) {
            const directMeta = st.panelEl.querySelector(":scope > .sectionMeta");
            if (directMeta && (directMeta.textContent ?? "").trim()) {
              const sub = d.createElement("div");
              sub.className = "floatHostSub";
              sub.textContent = directMeta.textContent ?? "";
              titleWrap.appendChild(sub);
            }
          }

          const actions = d.createElement("div");
          actions.className = "panelActionRow";
          const floatBtn = d.createElement("button");
          floatBtn.type = "button";
          floatBtn.className = "panelActionBtn";
          const winBtn = d.createElement("button");
          winBtn.type = "button";
          winBtn.className = "panelActionBtn";
          actions.appendChild(floatBtn);
          actions.appendChild(winBtn);

          floatBtn.addEventListener("click", (ev) => {
            ev.preventDefault();
            ev.stopPropagation();
            toggleFloat(st);
          });
          winBtn.addEventListener("click", (ev) => {
            ev.preventDefault();
            ev.stopPropagation();
            toggleWindow(st);
          });

          header.appendChild(titleWrap);
          header.appendChild(actions);

          const body = d.createElement("div");
          body.className = "floatHostBody";

          host.appendChild(header);
          host.appendChild(body);

          st.popupShellHeader = header;
          st.popupShellBody = body;
          st.popupShellFloatBtn = floatBtn;
          st.popupShellWinBtn = winBtn;
        }

        function clearPopupShellRefs(st) {
          st.popupShellHeader = null;
          st.popupShellBody = null;
          st.popupShellFloatBtn = null;
          st.popupShellWinBtn = null;
        }

        function enableFloatDrag(host) {
          let drag = null;

          host.addEventListener("pointerdown", (ev) => {
            if (ev.button !== 0) return;
            const target = ev.target;
            if (!(target instanceof Element)) return;
            if (target.closest("button, input, select, textarea, a, label")) return;

            const rect = host.getBoundingClientRect();
            const y = ev.clientY - rect.top;
            const headerEl = host.querySelector(":scope > .floatHostHeader");
            const dragHandleHeight = headerEl instanceof HTMLElement
              ? Math.ceil(headerEl.getBoundingClientRect().height) + 4
              : 72;
            if (y < 0 || y > dragHandleHeight) return;

            drag = {
              dx: ev.clientX - rect.left,
              dy: ev.clientY - rect.top
            };

            host.style.left = `${Math.round(rect.left)}px`;
            host.style.top = `${Math.round(rect.top)}px`;
            host.style.right = "auto";
            host.classList.add("dragging");

            try { host.setPointerCapture(ev.pointerId); } catch {}
            ev.preventDefault();
          });

          host.addEventListener("pointermove", (ev) => {
            if (!drag) return;
            const hostRect = host.getBoundingClientRect();
            const maxLeft = Math.max(0, window.innerWidth - hostRect.width);
            const maxTop = Math.max(0, window.innerHeight - Math.min(hostRect.height, window.innerHeight));
            const nextLeft = clamp(ev.clientX - drag.dx, 0, maxLeft);
            const nextTop = clamp(ev.clientY - drag.dy, 0, maxTop);
            host.style.left = `${Math.round(nextLeft)}px`;
            host.style.top = `${Math.round(nextTop)}px`;
          });

          const endDrag = (ev) => {
            if (!drag) return;
            drag = null;
            host.classList.remove("dragging");
            if (ev && "pointerId" in ev) {
              try { host.releasePointerCapture(ev.pointerId); } catch {}
            }
          };

          host.addEventListener("pointerup", endDrag);
          host.addEventListener("pointercancel", endDrag);
        }

        function updateButtons(st) {
          const setBtnState = (btn, active, inactiveLabel, activeLabel, inactiveIcon, activeIcon) => {
            if (!btn) return;
            btn.textContent = active ? activeIcon : inactiveIcon;
            btn.setAttribute("aria-pressed", active ? "true" : "false");
            btn.setAttribute("aria-label", active ? activeLabel : inactiveLabel);
            btn.title = active ? activeLabel : inactiveLabel;
          };
          if (st.floatBtn) {
            const floatActive = st.mode === "float";
            setBtnState(st.floatBtn, floatActive, "Float panel", "Dock panel", PANEL_BTN_ICONS.float, PANEL_BTN_ICONS.dock);
          }
          if (st.winBtn) {
            const winActive = st.mode === "window";
            setBtnState(st.winBtn, winActive, "Open panel in window", "Dock panel", PANEL_BTN_ICONS.window, PANEL_BTN_ICONS.dock);
          }
          if (st.floatShellFloatBtn) {
            const floatActive = st.mode === "float";
            setBtnState(st.floatShellFloatBtn, floatActive, "Float panel", "Dock panel", PANEL_BTN_ICONS.float, PANEL_BTN_ICONS.dock);
          }
          if (st.floatShellWinBtn) {
            const winActive = st.mode === "window";
            setBtnState(st.floatShellWinBtn, winActive, "Open panel in window", "Dock panel", PANEL_BTN_ICONS.window, PANEL_BTN_ICONS.dock);
          }
          if (st.popupShellFloatBtn) {
            const floatActive = st.mode === "float";
            setBtnState(st.popupShellFloatBtn, floatActive, "Float panel", "Dock panel", PANEL_BTN_ICONS.float, PANEL_BTN_ICONS.dock);
          }
          if (st.popupShellWinBtn) {
            const winActive = st.mode === "window";
            setBtnState(st.popupShellWinBtn, winActive, "Open panel in window", "Dock panel", PANEL_BTN_ICONS.window, PANEL_BTN_ICONS.dock);
          }
        }

        function dock(st) {
          restoreFloatScrollLayout(st);
          removeFloatToolbarStub(st);
          if (st.popup && !st.popup.closed) {
            try { st.popup.close(); } catch {}
          }
          st.popup = null;
          st.floatHost?.remove();
          st.floatHost = null;
          clearFloatShellRefs(st);
          clearPopupShellRefs(st);
          if (st.placeholder.parentNode) {
            st.placeholder.parentNode.insertBefore(st.panelEl, st.placeholder.nextSibling);
          }
          st.mode = "docked";
          updateButtons(st);
        }

        function toggleFloat(st) {
          if (isMobileLayout()) return;
          if (st.mode === "float") return dock(st);
          ensurePlaceholder(st);
          if (st.mode === "window") {
            if (st.popup && !st.popup.closed) {
              try { st.popup.close(); } catch {}
            }
            st.popup = null;
            clearPopupShellRefs(st);
          }
          if (st.floatHost) st.floatHost.remove();
          const host = document.createElement("div");
          host.className = "floatHost";
          host.dataset.floatKey = st.key;
          const panelRect = st.panelEl.getBoundingClientRect();
          const targetWidth = Math.min(Math.max(320, Math.round(panelRect.width || 520)), Math.max(320, window.innerWidth - 32));
          const targetHeight = Math.min(Math.max(220, Math.round(panelRect.height || 640)), Math.max(220, window.innerHeight - 32));
          host.style.width = `${targetWidth}px`;
          host.style.height = `${targetHeight}px`;
          document.body.appendChild(host);
          enableFloatDrag(host);
          createFloatShell(st, host);
          createFloatToolbarStub(st);
          (st.floatShellBody || host).appendChild(st.panelEl);
          st.floatHost = host;
          st.mode = "float";
          updateButtons(st);
        }

        function toggleWindow(st) {
          if (isMobileLayout()) return;
          if (st.mode === "window") return dock(st);
          ensurePlaceholder(st);
          restoreFloatScrollLayout(st);
          createFloatToolbarStub(st);
          if (st.floatHost) {
            st.floatHost.remove();
            st.floatHost = null;
            clearFloatShellRefs(st);
          }

          const popup = window.open("", `${st.key}Popup`, "width=560,height=760,resizable=yes,scrollbars=yes");
          if (!popup) return;
          st.popup = popup;
          const d = getPopupDoc(popup, st.title);
          if (!d) return;
          const host = d.getElementById("popupPanelHost");
          if (!host) return;
          host.textContent = "";
          createPopupShell(st, host, d);
          (st.popupShellBody || host).appendChild(st.panelEl);
          st.mode = "window";
          updateButtons(st);

          const onClose = () => {
            clearPopupShellRefs(st);
            dock(st);
          };
          popup.addEventListener("beforeunload", onClose, { once: true });
        }

        function bindPanel(key, panelId, floatBtnId, winBtnId, title) {
          const panelEl = document.getElementById(panelId);
          const floatBtn = document.getElementById(floatBtnId);
          const winBtn = document.getElementById(winBtnId);
          if (!panelEl || (!floatBtn && !winBtn)) return;
          const st = ensureState(key, panelEl, floatBtn, winBtn, title);
          updateButtons(st);

          const swallow = (ev) => {
            ev.preventDefault();
            ev.stopPropagation();
          };
          if (floatBtn) {
            floatBtn.addEventListener("click", (ev) => {
              swallow(ev);
              if (isMobileLayout()) return;
              toggleFloat(st);
            });
          }
          if (winBtn) {
            winBtn.addEventListener("click", (ev) => {
              swallow(ev);
              if (isMobileLayout()) return;
              toggleWindow(st);
            });
          }
        }

        bindPanel("parahookParams", "paraHookParamsSection", "paraHookParamsFloatToggle", "paraHookParamsWindowToggle", "Parahook Parameters");
        bindPanel("layers", "layersSection", "layersFloatToggle", "layersWindowToggle", "Layers");
        bindPanel("radio", "radioSection", "radioFloatToggle", "radioWindowToggle", "Gusano");
        bindPanel("debug", "debugPanel", "debugFloatToggle", "debugWindowToggle", "Debug");

        function syncPanelPopoutButtonVisibility() {
          const hidden = isMobileLayout();
          const btns = document.querySelectorAll(
            "#paraHookParamsFloatToggle, #paraHookParamsWindowToggle, #layersFloatToggle, #layersWindowToggle, #radioFloatToggle, #radioWindowToggle, #debugFloatToggle, #debugWindowToggle"
          );
          btns.forEach((btn) => {
            if (!(btn instanceof HTMLElement)) return;
            btn.style.display = hidden ? "none" : "";
          });
        }

        syncPanelPopoutButtonVisibility();
        if ("addEventListener" in mobileLayoutQuery) {
          mobileLayoutQuery.addEventListener("change", syncPanelPopoutButtonVisibility);
        }
        window.addEventListener("resize", syncPanelPopoutButtonVisibility);
      })();
    </script>
  </body>
</html>






