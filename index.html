<!-- FILE: index.html -->
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ParaHook Generator</title>
    <style>
      html, body {
        margin: 0;
        height: 100%;
        overflow: hidden;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      }

      #c { width: 100vw; height: 100vh; display: block; }

      /* Allow text selection in debug + status */
      #log,
      #status {
        user-select: text;
        -webkit-user-select: text;
      }

      /* OUTER container only (position + sizing + resize) */
      #ui {
        position: fixed;
        top: 16px;
        left: 16px;

        width: 360px;
        min-width: 300px;
        max-width: min(700px, calc(100vw - 32px));

        height: 85vh;
        min-height: 360px;
        max-height: calc(100vh - 5px);

        overflow: hidden; /* panels manage their own scroll */
        resize: both;
        box-sizing: border-box;

        display: flex;
        flex-direction: column;
        gap: 10px; /* space between boxes */
      }

      /* REUSABLE big box style */
      .panelBox {
        background: rgba(20,20,24,0.9);
        border-radius: 12px;
        color: #e8e8ea;
        box-shadow: 0 10px 30px rgba(0,0,0,0.45);
        user-select: none;
        box-sizing: border-box;
        padding: 14px 14px 10px 14px;
      }

      /* Title/Version panel */
      #titlePanel {
        background: rgba(0,0,0,0.20);
        border: 1px solid rgba(255,255,255,0.14);
        border-radius: 12px;
        padding: 10px 12px;
        box-sizing: border-box;

        display: flex;
        align-items: baseline;
        justify-content: space-between;
        gap: 12px;
        margin-bottom: 10px;
      }

      #appTitle {
        font-weight: 900;
        letter-spacing: 0.2px;
        font-size: 14px;
        line-height: 1.2;
      }

      #appVersion {
        font-size: 12px;
        opacity: 0.8;
        font-variant-numeric: tabular-nums;
        white-space: nowrap;
      }

      /* Middle panel scrolls */
      #controlsPanel {
        flex: 1 1 auto;
        overflow: auto;
        min-height: 0; /* critical for flex children to scroll */
      }

      /* Debug panel stays its own box */
      #debugPanel {
        flex: 0 0 auto;
      }

      form { margin: 0; }

      .row { display: grid; grid-template-columns: 1fr auto; gap: 10px; align-items: center; margin: 8px 0; }
      .row.header { grid-template-columns: auto 1fr; margin-top: 0; margin-bottom: 10px; }

      .btnRow {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 8px;
        margin: 8px 0 10px 0;
      }

      label { display: grid; grid-template-columns: 1fr; gap: 6px; font-size: 13px; line-height: 1.2; }
      input[type="range"] { width: 100%; }

      button { padding: 7px 10px; border: 0; border-radius: 8px; cursor: pointer; background: #e8e8ea; color: #111; font-weight: 600; }
      button.secondary { background: #cfd1d6; }
      button:disabled { opacity: 0.6; cursor: not-allowed; }

      #status { font-size: 13px; opacity: 0.9; text-align: left; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

      details.section {
        margin-top: 10px;
        border-top: 1px solid rgba(255,255,255,0.15);
        padding-top: 10px;
      }
      details.section summary {
        cursor: pointer;
        font-weight: 800;
        font-size: 13px;
        letter-spacing: 0.2px;
        list-style: none;
      }
      details.section summary::-webkit-details-marker { display: none; }
      .sectionMeta { font-size: 12px; opacity: 0.8; margin: 4px 0 8px 0; }


      /* Subsection styling (nested inside another section) */
details.section details.section {
  margin-left: 0px;
  margin-top: 8px;
  padding: 10px 12px;
  border-left: 3px solid rgba(255,255,255,0.18);
  border-top: none;
  background: rgba(255,255,255,0.03);
  border-radius: 8px;
}

/* Slightly smaller summary for subsections */
details.section details.section > summary {
  font-size: 12px;
  font-weight: 700;
  opacity: 0.9;
}
      .check {
        display: grid;
        grid-template-columns: auto 1fr;
        gap: 10px;
        align-items: center;
        margin: 8px 0;
      }
      .check input[type="checkbox"] { width: 16px; height: 16px; }
      .check label { display: block; font-size: 13px; line-height: 1.2; }

      /* Value input boxes */
      .valInput {
        width: 78px;
        padding: 4px 6px;
        border-radius: 8px;
        border: 1px solid rgba(255,255,255,0.22);
        background: rgba(0,0,0,0.25);
        color: #e8e8ea;
        font-size: 13px;
        text-align: right;
        font-variant-numeric: tabular-nums;
        outline: none;
        box-sizing: border-box;
      }
      .valInput:focus { border-color: rgba(255,255,255,0.45); }
      .valInput:disabled { opacity: 0.65; }

      /* Param rows */
      .paramRow { margin: 10px 0; }
      .paramTop {
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        margin-bottom: 6px;
      }
      .paramTag {
        font-size: 11px;
        letter-spacing: 0.08em;
        opacity: 0.75;
        text-transform: uppercase;
      }
      .paramName {
        font-size: 12px;
        opacity: 0.95;
      }
      .paramBody {
        display: flex;
        gap: 10px;
        align-items: center;
      }
      .paramBody input[type="range"] { flex: 1 1 auto; width: auto; }

      /* DEBUG (inside its own panel now) */
      #debug {
        margin: 0;
        padding: 0;

        height: 260px;
        min-height: 140px;
        max-height: 70vh;

        resize: vertical;
        overflow: hidden;

        display: flex;
        flex-direction: column;
        gap: 6px;

        font-size: 12px;
        line-height: 1.35;
        opacity: 0.95;
        box-sizing: border-box;
      }

      #debugHeader { font-weight: 700; opacity: 0.95; flex: 0 0 auto; }

      #log {
        flex: 1 1 auto;
        min-height: 0;
        margin: 0;
        padding: 8px;
        background: rgba(0,0,0,0.35);
        border-radius: 8px;

        overflow: auto;
        white-space: pre-wrap;
        word-break: break-word;

        box-sizing: border-box;
      }
    </style>
  </head>

  <body>
    <div id="ui">
      <!-- BOX 1: Title + Version + Toolbar -->
      <div id="toolbarPanel" class="panelBox">
        <div id="titlePanel">
          <div id="appTitle">Parahook Generator</div>
          <div id="appVersion">v 0.14.0</div>
        </div>

        <div class="row header">
          <div id="status">idle</div>
        </div>

        <div class="btnRow">
          <button id="rebuild" type="button">Rebuild</button>
          <button id="exportStl" type="button" class="secondary">Export STL</button>
          <button id="exportStep" type="button" class="secondary">Export STEP</button>
        </div>

        <!-- MODEL TOGGLE -->
        <div class="check">
          <input id="modelEnabled" type="checkbox" checked />
          <label for="modelEnabled">Enable model (model.ts)</label>
        </div>
      </div>

      <!-- BOX 2: Controls (scrollable) -->
      <div id="controlsPanel" class="panelBox">
        <form id="controls" autocomplete="off">

          <!-- REFERENCE (collapsible group) -->
          <details class="section">
            <summary>Reference</summary>

            <!-- Notes -->
            <details class="section">
              <summary>-Notes</summary>
              <div class="sectionMeta">0.14.0 - renamed params to named keys (legacy paramN still present in payload later)</div>
            </details>

            <!-- SECTION CUT -->
            <details class="section">
              <summary>-Section Cut</summary>
              <div class="sectionMeta">Slice preview/export. Offset is in mm along the active cut normal.</div>

              <div class="check">
                <input id="sectionCutEnabled" type="checkbox" />
                <label for="sectionCutEnabled">Enable section cut</label>
              </div>

              <div class="check">
                <input id="sectionCutFlip" type="checkbox" />
                <label for="sectionCutFlip">Flip section cut</label>
              </div>

              <div class="check">
                <input id="sectionCutZswitch" type="checkbox" />
                <label for="sectionCutZswitch">Plan / Section</label>
              </div>

              <div class="row">
                <label>Section Cut Offset
                  <input id="sectionCutOffset" type="range" min="-200" max="420" step="1" value="0" />
                </label>
                <input class="valInput" id="sectionCutOffsetVal" type="number" step="1" value="0" />
              </div>
            </details>

            <!-- Quality -->
            <details class="section">
              <summary>-Quality</summary>
              <div class="sectionMeta">Preview mesh settings</div>

              <div class="row">
                <label>Mesh Tolerance (higher = faster)
                  <input id="tolerance" name="tolerance" type="range" min="0.3" max="3.0" step="0.1" value="1.5" />
                </label>
                <input class="valInput" id="toleranceVal" type="number" step="0.1" value="1.5" />
              </div>
            </details>

            <!-- PREMADE HOOKS -->
            <details class="section">
              <summary>-Premade Hooks</summary>
              <div class="sectionMeta">STEP overlays (small / medium / large / XL)</div>

              <div class="check">
                <input id="hookSmallEnabled" type="checkbox" />
                <label for="hookSmallEnabled">Small</label>
              </div>

              <div class="check">
                <input id="hookMediumEnabled" type="checkbox" />
                <label for="hookMediumEnabled">Medium</label>
              </div>

              <div class="check">
                <input id="hookLargeEnabled" type="checkbox" />
                <label for="hookLargeEnabled">Large</label>
              </div>

              <div class="check">
                <input id="hookXLEnabled" type="checkbox" />
                <label for="hookXLEnabled">XL</label>
              </div>

              <div class="row">
                <label>Hook Transform X (mm)
                  <input id="hookX" type="range" min="-150" max="150" step="1" value="0" />
                </label>
                <input class="valInput" id="hookXVal" type="number" step="1" value="0" />
              </div>

              <div class="row">
                <label>Hook Transform Y (mm)
                  <input id="hookY" type="range" min="-150" max="150" step="1" value="0" />
                </label>
                <input class="valInput" id="hookYVal" type="number" step="1" value="0" />
              </div>

              <div class="row">
                <label>Hook Transform Z (mm)
                  <input id="hookZ" type="range" min="-100" max="100" step="1" value="0" />
                </label>
                <input class="valInput" id="hookZVal" type="number" step="1" value="0" />
              </div>

              <div class="row">
                <label>Hook Rotate Plan (deg)
                  <input id="hookRot" type="range" min="-180" max="180" step="1" value="0" />
                </label>
                <input class="valInput" id="hookRotVal" type="number" step="1" value="0" />
              </div>
            </details>

            <!-- REFERENCE FOOTPAD -->
            <details class="section">
              <summary>-Reference Footpad</summary>
              <div class="sectionMeta">STL overlays for pad fit reference</div>

              <div class="check">
                <input id="footpad1Enabled" type="checkbox" />
                <label for="footpad1Enabled">Footpad 1</label>
              </div>

              <div class="check">
                <input id="footpad2Enabled" type="checkbox" checked />
                <label for="footpad2Enabled">Footpad 2</label>
              </div>

              <div class="check">
                <input id="footpad3Enabled" type="checkbox" />
                <label for="footpad3Enabled">Footpad 3</label>
              </div>

              <div class="row">
                <label>Footpad Transform X (mm)
                  <input id="footpadX" type="range" min="-100" max="150" step="1" value="62" />
                </label>
                <input class="valInput" id="footpadXVal" type="number" step="1" value="62" />
              </div>

              <div class="row">
                <label>Footpad Transform Y (mm)
                  <input id="footpadY" type="range" min="-100" max="150" step="1" value="95" />
                </label>
                <input class="valInput" id="footpadYVal" type="number" step="1" value="95" />
              </div>

              <div class="row">
                <label>Footpad Transform Z (mm)
                  <input id="footpadZ" type="range" min="-100" max="100" step="1" value="-19" />
                </label>
                <input class="valInput" id="footpadZVal" type="number" step="1" value="-19" />
              </div>

              <div class="row">
                <label>Footpad Rotate Plan (deg)
                  <input id="footpadRot" type="range" min="-180" max="180" step="1" value="0" />
                </label>
                <input class="valInput" id="footpadRotVal" type="number" step="1" value="0" />
              </div>
            </details>

            <!-- REFERENCE SHOE -->
            <details class="section">
              <summary>-Reference Shoe</summary>
              <div class="sectionMeta">OBJ overlay for fit and scale reference</div>

              <div class="check">
                <input id="shoeEnabled" type="checkbox" checked />
                <label for="shoeEnabled">Show shoe reference</label>
              </div>

              <div class="row">
                <label>Shoe Size (US 5–15) (10 = 1.00x)
                  <input id="shoeSize" type="range" min="5" max="15" step="0.5" value="10" />
                </label>
                <input class="valInput" id="shoeSizeVal" type="number" step="0.5" value="10" />
              </div>

              <div class="row">
                <label>Computed Scale (relative to size 10)
                  <input id="shoeScale" type="range" min="0.90" max="1.10" step="0.001" value="1.000" disabled />
                </label>
                <input class="valInput" id="shoeScaleVal" type="number" step="0.001" value="1.000" disabled />
              </div>

              <div class="row">
                <label>Transparency (0 = solid, 1 = invisible)
                  <input id="shoeAlpha" type="range" min="0" max="1" step="0.01" value="0.5" />
                </label>
                <input class="valInput" id="shoeAlphaVal" type="number" step="0.01" value="0.5" />
              </div>

              <div class="row">
                <label>Transform X (mm)
                  <input id="shoeX" type="range" min="-200" max="200" step="1" value="0" />
                </label>
                <input class="valInput" id="shoeXVal" type="number" step="1" value="0" />
              </div>

              <div class="row">
                <label>Transform Y (mm)
                  <input id="shoeY" type="range" min="-200" max="200" step="1" value="0" />
                </label>
                <input class="valInput" id="shoeYVal" type="number" step="1" value="0" />
              </div>

              <div class="row">
                <label>Transform Z (mm)
                  <input id="shoeZ" type="range" min="-200" max="200" step="1" value="0" />
                </label>
                <input class="valInput" id="shoeZVal" type="number" step="1" value="0" />
              </div>

              <div class="row">
                <label>Rotate Plan (deg)
                  <input id="shoeRot" type="range" min="-180" max="180" step="1" value="0" />
                </label>
                <input class="valInput" id="shoeRotVal" type="number" step="1" value="0" />
              </div>
            </details>
          </details>

<!-- BASEPLATE -->
<details class="section">
  <summary>Baseplate</summary>
  <div class="sectionMeta">Primary baseplate controls</div>

  <div class="check">
    <input id="vizBasePts" type="checkbox" />
    <label for="vizBasePts">Show Baseplate control points</label>
  </div>

  <div class="check">
    <input id="baseEnabled" type="checkbox" checked />
    <label for="baseEnabled">Enable baseplate</label>
  </div>

  <!-- Dimensions -->
  <details class="section">
    <summary>-Dimensions</summary>
    <div class="sectionMeta">Overall size and spline controls</div>

    <!-- BP length -->
    <div class="paramRow">
      <div class="paramTop">
        <div class="paramTag">BP_LEN</div>
        <div class="paramName">Base Length (Y)</div>
      </div>
      <div class="paramBody">
        <input id="bp_len" name="bp_len" type="range" min="100" max="420" step="1" value="195" />
        <input class="valInput" id="bp_lenVal" type="number" step="1" value="195" />
      </div>
    </div>

    <!-- BP width -->
    <div class="paramRow">
      <div class="paramTop">
        <div class="paramTag">BP_WID</div>
        <div class="paramName">Base Width Offset (mm)</div>
      </div>
      <div class="paramBody">
        <input id="bp_wid" name="bp_wid" type="range" min="5" max="140" step="1" value="30" />
        <input class="valInput" id="bp_widVal" type="number" step="1" value="30" />
      </div>
    </div>

    <!-- BP thickness -->
    <div class="paramRow">
      <div class="paramTop">
        <div class="paramTag">BP_THK</div>
        <div class="paramName">Base Thickness (Z)</div>
      </div>
      <div class="paramBody">
        <input id="bp_thk" name="bp_thk" type="range" min="-40" max="30" step="1" value="12" />
        <input class="valInput" id="bp_thkVal" type="number" step="1" value="12" />
      </div>
    </div>

    <!-- BP heel% -->
    <div class="paramRow">
      <div class="paramTop">
        <div class="paramTag">BP_HEEL_PCT</div>
        <div class="paramName">Point Heel % (P3 Y as % of Base Length)</div>
      </div>
      <div class="paramBody">
        <input id="bp_heelPct" name="bp_heelPct" type="range" min="50" max="100" step="1" value="67" />
        <input class="valInput" id="bp_heelPctVal" type="number" step="1" value="67" />
      </div>
    </div>

    <!-- BP toe% -->
    <div class="paramRow">
      <div class="paramTop">
        <div class="paramTag">BP_TOE_PCT</div>
        <div class="paramName">Point Toe % (P2 Y as % of Heel Y)</div>
      </div>
      <div class="paramBody">
        <input id="bp_toePct" name="bp_toePct" type="range" min="5" max="95" step="1" value="46" />
        <input class="valInput" id="bp_toePctVal" type="number" step="1" value="46" />
      </div>
    </div>

    <!-- BP P2X -->
    <div class="paramRow">
      <div class="paramTop">
        <div class="paramTag">BP_P2X</div>
        <div class="paramName">Point 2 X</div>
      </div>
      <div class="paramBody">
        <input id="bp_p2x" name="bp_p2x" type="range" min="-80" max="40" step="1" value="-14" />
        <input class="valInput" id="bp_p2xVal" type="number" step="1" value="-14" />
      </div>
    </div>

    <!-- BP P3X -->
    <div class="paramRow">
      <div class="paramTop">
        <div class="paramTag">BP_P3X</div>
        <div class="paramName">Point 3 X</div>
      </div>
      <div class="paramBody">
        <input id="bp_p3x" name="bp_p3x" type="range" min="-80" max="40" step="1" value="-2" />
        <input class="valInput" id="bp_p3xVal" type="number" step="1" value="-2" />
      </div>
    </div>

    <!-- BP P4X -->
    <div class="paramRow">
      <div class="paramTop">
        <div class="paramTag">BP_P4X</div>
        <div class="paramName">Point 4 X</div>
      </div>
      <div class="paramBody">
        <input id="bp_p4x" name="bp_p4x" type="range" min="-80" max="80" step="1" value="1" />
        <input class="valInput" id="bp_p4xVal" type="number" step="1" value="1" />
      </div>
    </div>
  </details>

  <!-- Screw Holes (keep same as you already added) -->
  <details class="section">
    <summary>-Screw Holes</summary>
    <div class="sectionMeta">
      Slot pattern controls. Move offsets shift the whole pattern. Slot length is 0 for a round hole.
    </div>

    <div class="paramRow">
      <div class="paramTop">
        <div class="paramTag">BP_SH_X</div>
        <div class="paramName">Move X (mm)</div>
      </div>
      <div class="paramBody">
        <input id="bp_sh_x" name="bp_sh_x" type="range" min="-80" max="80" step="1" value="0" />
        <input class="valInput" id="bp_sh_xVal" type="number" step="1" value="0" />
      </div>
    </div>

    <div class="paramRow">
      <div class="paramTop">
        <div class="paramTag">BP_SH_Y</div>
        <div class="paramName">Move Y (mm)</div>
      </div>
      <div class="paramBody">
        <input id="bp_sh_y" name="bp_sh_y" type="range" min="-120" max="120" step="1" value="0" />
        <input class="valInput" id="bp_sh_yVal" type="number" step="1" value="0" />
      </div>
    </div>

    <div class="paramRow">
      <div class="paramTop">
        <div class="paramTag">BP_SH_DIA</div>
        <div class="paramName">Screw Diameter (mm)</div>
      </div>
      <div class="paramBody">
        <input id="bp_sh_dia" name="bp_sh_dia" type="range" min="2" max="10" step="0.1" value="5.0" />
        <input class="valInput" id="bp_sh_diaVal" type="number" step="0.1" value="5.0" />
      </div>
    </div>

    <div class="paramRow">
      <div class="paramTop">
        <div class="paramTag">BP_SH_SLOT</div>
        <div class="paramName">Screw Slot Length (mm)</div>
      </div>
      <div class="paramBody">
        <input id="bp_sh_slot" name="bp_sh_slot" type="range" min="0" max="40" step="0.5" value="0" />
        <input class="valInput" id="bp_sh_slotVal" type="number" step="0.5" value="0" />
      </div>
    </div>

    <div class="paramRow">
      <div class="paramTop">
        <div class="paramTag">BP_SH_DIST</div>
        <div class="paramName">Slot Distance (center-to-center, mm)</div>
      </div>
      <div class="paramBody">
        <input id="bp_sh_dist" name="bp_sh_dist" type="range" min="10" max="180" step="1" value="60" />
        <input class="valInput" id="bp_sh_distVal" type="number" step="1" value="60" />
      </div>
    </div>

    <div class="paramRow">
      <div class="paramTop">
        <div class="paramTag">BP_SH_ANG</div>
        <div class="paramName">Slot Angle (deg)</div>
      </div>
      <div class="paramBody">
        <input id="bp_sh_ang" name="bp_sh_ang" type="range" min="-180" max="180" step="1" value="0" />
        <input class="valInput" id="bp_sh_angVal" type="number" step="1" value="0" />
      </div>
    </div>
  </details>
</details>
          <!-- Toe Hook (named keys) -->
          <details class="section">
            <summary>Toe Hook</summary>
            <div class="sectionMeta">Profiles A → B (mid) → C (end). Stations measured in mm along the spline from origin.</div>

            <div class="check">
              <input id="toeBEnabled" type="checkbox" checked />
              <label for="toeBEnabled">Enable Profile B loft (A → B)</label>
            </div>

            <div class="check">
              <input id="toeCEnabled" type="checkbox" checked />
              <label for="toeCEnabled">Enable Profile C loft (B → C)</label>
            </div>

            <!-- Profile A -->
            <details class="section" open>
              <summary>Profile A</summary>
              <div class="sectionMeta">
                Start profile at spline start. Uses a 2-point organic curve (Bezier) with a vertical start handle and an angled end handle.
              </div>

              <div class="check">
                <input id="vizAArcPts" type="checkbox" />
                <label for="vizAArcPts">Show Profile A control handles</label>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_THK</div>
                  <div class="paramName">Toe Hook Thickness (offset, mm)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_thk" name="toe_thk" type="range" min="5" max="25" step="0.5" value="12" />
                  <input class="valInput" id="toe_thkVal" type="number" step="0.5" value="12" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_A_P1S</div>
                  <div class="paramName">P1 Strength (vertical handle, mm)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_a_p1s" name="toe_a_p1s" type="range" min="0" max="140" step="1" value="25" />
                  <input class="valInput" id="toe_a_p1sVal" type="number" step="1" value="25" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_A_P3S</div>
                  <div class="paramName">End Handle Strength (mm)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_a_p3s" name="toe_a_p3s" type="range" min="0" max="140" step="1" value="35" />
                  <input class="valInput" id="toe_a_p3sVal" type="number" step="1" value="35" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_A_ENDX</div>
                  <div class="paramName">End X A (mm)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_a_endx" name="toe_a_endx" type="range" min="0" max="160" step="1" value="47" />
                  <input class="valInput" id="toe_a_endxVal" type="number" step="1" value="47" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_A_ENDZ</div>
                  <div class="paramName">End Z A (mm)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_a_endz" name="toe_a_endz" type="range" min="0" max="180" step="1" value="35" />
                  <input class="valInput" id="toe_a_endzVal" type="number" step="1" value="35" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_A_ENDA</div>
                  <div class="paramName">End Handle Angle (deg)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_a_enda" name="toe_a_enda" type="range" min="-180" max="180" step="1" value="0" />
                  <input class="valInput" id="toe_a_endaVal" type="number" step="1" value="0" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_A_STR</div>
                  <div class="paramName">Rail Strength at A</div>
                </div>
                <div class="paramBody">
                  <input id="toe_a_strength" name="toe_a_strength" type="range" min="0.2" max="8" step="0.01" value="2" />
                  <input class="valInput" id="toe_a_strengthVal" type="number" min="0.2" max="8" step="0.01" value="2" />
                </div>
              </div>
            </details>

            <!-- Profile B -->
            <details class="section" open>
              <summary>Profile B</summary>
              <div class="sectionMeta">Mid control profile. Station is mm along spline from origin. Controls A→B intermediate sections.</div>

              <div class="sectionMeta" style="margin-top: 6px; opacity: 0.9;">
                Loft Params
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_B_STA</div>
                  <div class="paramName">Profile B Length (mm along spline)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_b_sta" name="toe_b_sta" type="range" min="1" max="260" step="1" value="60" />
                  <input class="valInput" id="toe_b_staVal" type="number" step="1" value="60" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_AB_MID</div>
                  <div class="paramName">A→B Intermediate Profiles (0 = A→B only)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_ab_mid" name="toe_ab_mid" type="range" min="0" max="60" step="1" value="10" />
                  <input class="valInput" id="toe_ab_midVal" type="number" step="1" value="10" />
                </div>
              </div>

              <div class="sectionMeta" style="margin-top: 10px; opacity: 0.9;">
                Profile Controls
              </div>

              <div class="check">
                <input id="vizBArcPts" type="checkbox" />
                <label for="vizBArcPts">Show Profile B control handles</label>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_B_P1S</div>
                  <div class="paramName">P1 Strength (vertical handle, mm)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_b_p1s" name="toe_b_p1s" type="range" min="0" max="140" step="1" value="25" />
                  <input class="valInput" id="toe_b_p1sVal" type="number" step="1" value="25" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_B_P3S</div>
                  <div class="paramName">End Handle Strength (mm)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_b_p3s" name="toe_b_p3s" type="range" min="0" max="140" step="1" value="36" />
                  <input class="valInput" id="toe_b_p3sVal" type="number" step="1" value="36" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_B_ENDX</div>
                  <div class="paramName">End X B (mm)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_b_endx" name="toe_b_endx" type="range" min="0" max="160" step="1" value="47" />
                  <input class="valInput" id="toe_b_endxVal" type="number" step="1" value="47" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_B_ENDZ</div>
                  <div class="paramName">End Z B (mm)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_b_endz" name="toe_b_endz" type="range" min="0" max="180" step="1" value="50" />
                  <input class="valInput" id="toe_b_endzVal" type="number" step="1" value="50" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_B_ENDA</div>
                  <div class="paramName">End Handle Angle (deg)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_b_enda" name="toe_b_enda" type="range" min="-180" max="180" step="1" value="-18" />
                  <input class="valInput" id="toe_b_endaVal" type="number" step="1" value="-18" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_B_STR</div>
                  <div class="paramName">Rail Strength at B</div>
                </div>
                <div class="paramBody">
                  <input id="toe_b_strength" name="toe_b_strength" type="range" min="0.2" max="8" step="0.01" value="2" />
                  <input class="valInput" id="toe_b_strengthVal" type="number" min="0.2" max="8" step="0.01" value="2" />
                </div>
              </div>
            </details>

            <!-- Profile C -->
            <details class="section" open>
              <summary>Profile C</summary>
              <div class="sectionMeta">End profile. Station is mm along spline from origin. Controls B→C intermediate sections.</div>

              <div class="sectionMeta" style="margin-top: 6px; opacity: 0.9;">
                Loft Params
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_C_STA</div>
                  <div class="paramName">Profile C Length (mm along spline)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_c_sta" name="toe_c_sta" type="range" min="1" max="260" step="1" value="137" />
                  <input class="valInput" id="toe_c_staVal" type="number" step="1" value="137" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_BC_MID</div>
                  <div class="paramName">B→C Intermediate Profiles (0 = B→C only)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_bc_mid" name="toe_bc_mid" type="range" min="0" max="60" step="1" value="15" />
                  <input class="valInput" id="toe_bc_midVal" type="number" step="1" value="15" />
                </div>
              </div>

              <div class="sectionMeta" style="margin-top: 10px; opacity: 0.9;">
                Profile Controls
              </div>

              <div class="check">
                <input id="vizCArcPts" type="checkbox" />
                <label for="vizCArcPts">Show Profile C control handles</label>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_C_P1S</div>
                  <div class="paramName">P1 Strength (vertical handle, mm)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_c_p1s" name="toe_c_p1s" type="range" min="0" max="140" step="1" value="25" />
                  <input class="valInput" id="toe_c_p1sVal" type="number" step="1" value="25" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_C_P3S</div>
                  <div class="paramName">End Handle Strength (mm)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_c_p3s" name="toe_c_p3s" type="range" min="0" max="140" step="1" value="35" />
                  <input class="valInput" id="toe_c_p3sVal" type="number" step="1" value="35" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_C_ENDX</div>
                  <div class="paramName">End X C (mm)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_c_endx" name="toe_c_endx" type="range" min="0" max="180" step="1" value="19" />
                  <input class="valInput" id="toe_c_endxVal" type="number" step="1" value="19" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_C_ENDZ</div>
                  <div class="paramName">End Z C (mm)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_c_endz" name="toe_c_endz" type="range" min="0" max="200" step="1" value="75" />
                  <input class="valInput" id="toe_c_endzVal" type="number" step="1" value="75" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_C_ENDA</div>
                  <div class="paramName">End Handle Angle (deg)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_c_enda" name="toe_c_enda" type="range" min="-180" max="180" step="1" value="-70" />
                  <input class="valInput" id="toe_c_endaVal" type="number" step="1" value="-70" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_C_STR</div>
                  <div class="paramName">Rail Strength at C</div>
                </div>
                <div class="paramBody">
                  <input id="toe_c_strength" name="toe_c_strength" type="range" min="0.2" max="8" step="0.01" value="7" />
                  <input class="valInput" id="toe_c_strengthVal" type="number" min="0.2" max="8" step="0.01" value="7" />
                </div>
              </div>
            </details>
          </details>

          <!-- Heel Kick (still paramN on purpose; we will rename after toe is stable) -->
          <details class="section">
            <summary>Heel Kick</summary>
            <div class="sectionMeta">Heights and fillet placeholders for the heel-kick loft.</div>

            <div class="check">
              <input id="heelEnabled" type="checkbox" checked />
              <label for="heelEnabled">Enable heel kick loft</label>
            </div>

            <div class="check">
              <input id="vizHeelArcPts" type="checkbox" />
              <label for="vizHeelArcPts">Show Heel Kick arc control points</label>
            </div>

            <div class="paramRow">
              <div class="paramTop">
                <div class="paramTag">HEEL_H_C</div>
                <div class="paramName">Heel Kick Height at Profile C (mm)</div>
              </div>
              <div class="paramBody">
                <input id="heel_h_c" name="heel_h_c" type="range" min="0" max="200" step="1" value="40" />
                <input class="valInput" id="heel_h_cVal" type="number" step="1" value="40" />
              </div>
            </div>

            <div class="paramRow">
              <div class="paramTop">
                <div class="paramTag">HEEL_H_D</div>
                <div class="paramName">Heel Kick Height at Profile D (mm)</div>
              </div>
              <div class="paramBody">
                <input id="heel_h_d" name="heel_h_d" type="range" min="0" max="200" step="1" value="10" />
                <input class="valInput" id="heel_h_dVal" type="number" step="1" value="10" />
              </div>
            </div>

            <div class="paramRow">
              <div class="paramTop">
                <div class="paramTag">HEEL_CD_MID</div>
                <div class="paramName">Heel Loft Intermediate Profiles (0 = C→D only)</div>
              </div>
              <div class="paramBody">
                <input id="heel_cd_mid" name="heel_cd_mid" type="range" min="0" max="60" step="1" value="2" />
                <input class="valInput" id="heel_cd_midVal" type="number" step="1" value="2" />
              </div>
            </div>

            <div class="paramRow">
              <div class="paramTop">
                <div class="paramTag">HEEL_F1</div>
                <div class="paramName">Heel Kick Fillet Radius 1 (mm) (placeholder)</div>
              </div>
              <div class="paramBody">
                <input id="heel_f1" name="heel_f1" type="range" min="0" max="30" step="0.5" value="0" />
                <input class="valInput" id="heel_f1Val" type="number" step="0.5" value="0" />
              </div>
            </div>

            <div class="paramRow">
              <div class="paramTop">
                <div class="paramTag">HEEL_F2</div>
                <div class="paramName">Heel Kick Fillet Radius 2 (mm) (placeholder)</div>
              </div>
              <div class="paramBody">
                <input id="heel_f2" name="heel_f2" type="range" min="0" max="30" step="0.5" value="0" />
                <input class="valInput" id="heel_f2Val" type="number" step="0.5" value="0" />
              </div>
            </div>
          </details>

          <!-- Fillets placeholders -->
          <details class="section">
            <summary>Fillets</summary>
            <div class="sectionMeta">Temporary global fillet params (placeholders). These do not affect the model yet.</div>

            <div class="paramRow">
              <div class="paramTop">
                <div class="paramTag">FIL_1</div>
                <div class="paramName">Fillet Param 1 (mm) (placeholder)</div>
              </div>
              <div class="paramBody">
                <input id="fil_1" name="fil_1" type="range" min="0" max="30" step="0.5" value="0" />
                <input class="valInput" id="fil_1Val" type="number" step="0.5" value="0" />
              </div>
            </div>

            <div class="paramRow">
              <div class="paramTop">
                <div class="paramTag">FIL_2</div>
                <div class="paramName">Fillet Param 2 (mm) (placeholder)</div>
              </div>
              <div class="paramBody">
                <input id="fil_2" name="fil_2" type="range" min="0" max="30" step="0.5" value="0" />
                <input class="valInput" id="fil_2Val" type="number" step="0.5" value="0" />
              </div>
            </div>

            <div class="paramRow">
              <div class="paramTop">
                <div class="paramTag">FIL_3</div>
                <div class="paramName">Fillet Param 3 (mm) (placeholder)</div>
              </div>
              <div class="paramBody">
                <input id="fil_3" name="fil_3" type="range" min="0" max="30" step="0.5" value="0" />
                <input class="valInput" id="fil_3Val" type="number" step="0.5" value="0" />
              </div>
            </div>

            <div class="paramRow">
              <div class="paramTop">
                <div class="paramTag">FIL_4</div>
                <div class="paramName">Fillet Param 4 (mm) (placeholder)</div>
              </div>
              <div class="paramBody">
                <input id="fil_4" name="fil_4" type="range" min="0" max="30" step="0.5" value="0" />
                <input class="valInput" id="fil_4Val" type="number" step="0.5" value="0" />
              </div>
            </div>

            <div class="paramRow">
              <div class="paramTop">
                <div class="paramTag">FIL_5</div>
                <div class="paramName">Fillet Param 5 (mm) (placeholder)</div>
              </div>
              <div class="paramBody">
                <input id="fil_5" name="fil_5" type="range" min="0" max="30" step="0.5" value="0" />
                <input class="valInput" id="fil_5Val" type="number" step="0.5" value="0" />
              </div>
            </div>
          </details>

        </form>
      </div>

      <!-- BOX 3: Debug (own big box) -->
      <div id="debugPanel" class="panelBox">
        <div id="debug">
          <div id="debugHeader">Debug</div>
          <pre id="log"></pre>
        </div>
      </div>
    </div>

    <canvas id="c"></canvas>
    <script type="module" src="/src/main.ts"></script>

    <script>
      function clamp(n, lo, hi) {
        return Math.min(hi, Math.max(lo, n));
      }

      function bindRangeToNumber(rangeId, numberId) {
        const r = document.getElementById(rangeId);
        const n = document.getElementById(numberId);
        if (!r || !n) return;

        if (typeof r.min === "string") n.min = r.min;
        if (typeof r.max === "string") n.max = r.max;
        if (typeof r.step === "string") n.step = r.step || n.step || "1";

        const syncNumber = () => { n.value = String(r.value); };

        const syncRange = () => {
          const lo = Number.isFinite(Number(r.min)) ? Number(r.min) : -Infinity;
          const hi = Number.isFinite(Number(r.max)) ? Number(r.max) : Infinity;
          const v = clamp(Number(n.value), lo, hi);
          if (!Number.isFinite(v)) return;

          r.value = String(v);
          n.value = String(v);
          r.dispatchEvent(new Event("input", { bubbles: true }));
        };

        r.addEventListener("input", syncNumber);
        n.addEventListener("input", syncRange);
        n.addEventListener("change", syncRange);

        syncNumber();
      }

      // -----------------------------
      // Range <-> Number bindings
      // -----------------------------
      const ids = [
        ["tolerance", "toleranceVal"],
        ["sectionCutOffset", "sectionCutOffsetVal"],

        // Shoe
        ["shoeSize", "shoeSizeVal"],
        ["shoeScale", "shoeScaleVal"],
        ["shoeAlpha", "shoeAlphaVal"],
        ["shoeX", "shoeXVal"],
        ["shoeY", "shoeYVal"],
        ["shoeZ", "shoeZVal"],
        ["shoeRot", "shoeRotVal"],

        // Footpad
        ["footpadX", "footpadXVal"],
        ["footpadY", "footpadYVal"],
        ["footpadZ", "footpadZVal"],
        ["footpadRot", "footpadRotVal"],

        // Premade Hooks
        ["hookX", "hookXVal"],
        ["hookY", "hookYVal"],
        ["hookZ", "hookZVal"],
        ["hookRot", "hookRotVal"],

        // Baseplate
        // Baseplate
        ["bp_len", "bp_lenVal"],
        ["bp_wid", "bp_widVal"],
        ["bp_thk", "bp_thkVal"],
        ["bp_heelPct", "bp_heelPctVal"],
        ["bp_toePct", "bp_toePctVal"],
        ["bp_p2x", "bp_p2xVal"],
        ["bp_p3x", "bp_p3xVal"],
        ["bp_p4x", "bp_p4xVal"],


        // Baseplate Screw Holes
        ["bp_sh_x", "bp_sh_xVal"],
        ["bp_sh_y", "bp_sh_yVal"],
        ["bp_sh_dia", "bp_sh_diaVal"],
        ["bp_sh_slot", "bp_sh_slotVal"],
        ["bp_sh_dist", "bp_sh_distVal"],
        ["bp_sh_ang", "bp_sh_angVal"],

        // Toe
        ["toe_thk", "toe_thkVal"],

        // Toe A
        ["toe_a_p1s", "toe_a_p1sVal"],
        ["toe_a_p3s", "toe_a_p3sVal"],
        ["toe_a_endx", "toe_a_endxVal"],
        ["toe_a_endz", "toe_a_endzVal"],
        ["toe_a_enda", "toe_a_endaVal"],
        ["toe_a_strength", "toe_a_strengthVal"],

        // Toe B
        ["toe_b_sta", "toe_b_staVal"],
        ["toe_ab_mid", "toe_ab_midVal"],
        ["toe_b_p1s", "toe_b_p1sVal"],
        ["toe_b_p3s", "toe_b_p3sVal"],
        ["toe_b_endx", "toe_b_endxVal"],
        ["toe_b_endz", "toe_b_endzVal"],
        ["toe_b_enda", "toe_b_endaVal"],
        ["toe_b_strength", "toe_b_strengthVal"],

        // Toe C
        ["toe_c_sta", "toe_c_staVal"],
        ["toe_bc_mid", "toe_bc_midVal"],
        ["toe_c_p1s", "toe_c_p1sVal"],
        ["toe_c_p3s", "toe_c_p3sVal"],
        ["toe_c_endx", "toe_c_endxVal"],
        ["toe_c_endz", "toe_c_endzVal"],
        ["toe_c_enda", "toe_c_endaVal"],
        ["toe_c_strength", "toe_c_strengthVal"],

        // Heel
        ["heel_h_c", "heel_h_cVal"],
        ["heel_h_d", "heel_h_dVal"],
        ["heel_cd_mid", "heel_cd_midVal"],
        ["heel_f1", "heel_f1Val"],
        ["heel_f2", "heel_f2Val"],

        // Fillets
        ["fil_1", "fil_1Val"],
        ["fil_2", "fil_2Val"],
        ["fil_3", "fil_3Val"],
        ["fil_4", "fil_4Val"],
        ["fil_5", "fil_5Val"],
      ];

      for (const pair of ids) bindRangeToNumber(pair[0], pair[1]);

      // -----------------------------
      // Shoe size -> scale mapping
      // -----------------------------
      const shoeSizeEl = document.getElementById("shoeSize");
      const shoeScaleEl = document.getElementById("shoeScale");
      const shoeScaleValEl = document.getElementById("shoeScaleVal");

      function computeShoeScaleFromSize(size) {
        const step = 1 / 3; // inches per full size
        const L10 = 10;     // baseline inches (ratio)
        const L = L10 + (size - 10) * step;
        return L / L10;
      }

      function updateShoeScale() {
        if (!shoeSizeEl || !shoeScaleEl || !shoeScaleValEl) return;
        const size = Number(shoeSizeEl.value);
        const scale = computeShoeScaleFromSize(size);

        shoeScaleEl.value = String(scale.toFixed(3));
        shoeScaleValEl.value = String(scale.toFixed(3));
        shoeScaleEl.dispatchEvent(new Event("input", { bubbles: true }));
      }

      if (shoeSizeEl) {
        shoeSizeEl.addEventListener("input", updateShoeScale);
        updateShoeScale();
      }
    </script>
  </body>
</html>
