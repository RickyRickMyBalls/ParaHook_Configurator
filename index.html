<!-- FILE: index.html -->
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ParaHook Generator</title>
    <style>
      html, body {
        margin: 0;
        height: 100%;
        overflow: hidden;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      }

      #c { width: 100vw; height: 100vh; display: block; }

      /* Allow text selection in debug + status */
      #log,
      #status {
        user-select: text;
        -webkit-user-select: text;
      }

      /* OUTER container only (position + sizing + resize) */
      #ui {
        position: fixed;
        top: 16px;
        left: 16px;

        width: 360px;
        min-width: 300px;
        max-width: min(700px, calc(100vw - 32px));

        height: 85vh;
        min-height: 360px;
        max-height: calc(100vh - 5px);

        overflow: hidden; /* panels manage their own scroll */
        resize: both;
        box-sizing: border-box;

        display: flex;
        flex-direction: column;
        gap: 0px; /* space between boxes */
      }

      /* REUSABLE big box style */
      .panelBox {
        background: rgba(20,20,24,0.9);
        border-radius: 12px;
        color: #e8e8ea;
        box-shadow: 0 10px 30px rgba(0,0,0,0.45);
        user-select: none;
        box-sizing: border-box;
        padding: 14px 14px 10px 14px;
      }

      /* Title/Version panel */
      #titlePanel {
        background: rgba(0,0,0,0.20);
        border: 1px solid rgba(255,255,255,0.14);
        border-radius: 12px;
        padding: 10px 12px;
        box-sizing: border-box;

        display: flex;
        align-items: baseline;
        justify-content: space-between;
        gap: 12px;
        margin-bottom: 10px;
        cursor: pointer;
      }

      #appTitle {
        font-weight: 900;
        letter-spacing: 0.2px;
        font-size: 14px;
        line-height: 1.2;
      }

      #appVersion {
        font-size: 12px;
        opacity: 0.8;
        font-variant-numeric: tabular-nums;
        white-space: nowrap;
      }

      /* Middle panel scrolls */
      #controlsPanel {
        flex: 1 1 auto;
        overflow: auto;
        min-height: 0; /* critical for flex children to scroll */
        margin-top: 5px;
      }
      #controlsPanelTitle {
        text-align: center;
        font-size: 12px;
        font-weight: 700;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        opacity: 0.75;
        margin: 5px 0 8px 0;
      }

      /* Debug panel stays its own box */
      #debugPanel {
        flex: 0 0 auto;
        background: transparent;
        box-shadow: none;
        padding: 0;
        border-radius: 0;
        margin-top: -8px; /* keep seam overlap, but shift debug panel down 5px */
        position: relative;
        z-index: 1;
      }
      #toolbarPanel {
        padding-top: 10px;
        padding-bottom: 8px;
      }
      #toolbarPanel #titlePanel {
        margin-bottom: 6px;
      }
      #toolbarPanel .row.header {
        margin-bottom: 6px;
      }
      #toolbarPanel .check {
        margin: 4px 0;
      }
      #toolbarPanel.titleOnly {
        padding-top: 8px;
        padding-bottom: 8px;
      }
      #toolbarPanel.titleOnly #titlePanel {
        margin-bottom: 0;
        justify-content: space-between;
      }
      #toolbarPanel.titleOnly .row.header,
      #toolbarPanel.titleOnly .check {
        display: none;
      }
      #toolbarPanel.titleOnly #appVersion,
      #toolbarPanel.titleOnly #appVersion {
        display: none;
      }

      form { margin: 0; }

      .row { display: grid; grid-template-columns: 1fr auto; gap: 10px; align-items: center; margin: 8px 0; }
      .row.header { grid-template-columns: auto 1fr; margin-top: 0; margin-bottom: 10px; }

      .btnRow {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 8px;
        margin: 8px 0 10px 0;
      }
      .btnRow.twoCols {
        grid-template-columns: 1fr 1fr;
        margin-top: 0;
      }
      .btnStack {
        display: grid;
        grid-template-columns: 1fr;
        gap: 8px;
        margin: 8px 0 0 0;
      }

      label { display: grid; grid-template-columns: 1fr; gap: 6px; font-size: 13px; line-height: 1.2; }
      input[type="range"] { width: 100%; }

      button { padding: 7px 10px; border: 0; border-radius: 8px; cursor: pointer; background: #e8e8ea; color: #111; font-weight: 600; }
      button.secondary { background: #cfd1d6; }
      button:disabled { opacity: 0.6; cursor: not-allowed; }

      #status { font-size: 13px; opacity: 0.9; text-align: left; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

      details.section {
        margin-top: 10px;
        border-top: 1px solid rgba(255,255,255,0.15);
        padding-top: 15px;
      }
      details.section summary {
        cursor: pointer;
        font-weight: 800;
        font-size: 13px;
        letter-spacing: 0.2px;
        list-style: none;
      }
      details.section summary::-webkit-details-marker { display: none; }
      .sectionMeta { font-size: 12px; opacity: 0.8; margin: 4px 0 8px 0; }
      .endDivider {
        margin: 10px 0 2px 0;
        border-top: 1px solid rgba(255,255,255,0.15);
      }


      /* Subsection styling (nested inside another section) */
details.section details.section {
  margin-left: 0px;
  margin-top: 8px;
  padding: 10px 12px;
  border-left: 3px solid rgba(255,255,255,0.18);
  border-top: none;
  background: rgba(255,255,255,0.03);
  border-radius: 8px;
}

/* Slightly smaller summary for subsections */
details.section details.section > summary {
  font-size: 12px;
  font-weight: 700;
  opacity: 0.9;
}
      .check {
        display: grid;
        grid-template-columns: auto 1fr;
        gap: 10px;
        align-items: center;
        margin: 8px 0;
      }
      .check.withSideStats {
        grid-template-columns: auto 1fr auto;
        gap: 10px 12px;
      }
      .check input[type="checkbox"] { width: 16px; height: 16px; }
      .check label { display: block; font-size: 13px; line-height: 1.2; }
      .miniStats {
        display: grid;
        grid-template-rows: 1fr 1fr;
        gap: 4px;
        min-width: 100px;
        transform: translateX(-70px);
      }
      .miniStatsRow {
        display: grid;
        grid-template-columns: auto 1fr;
        align-items: center;
        gap: 6px;
        min-height: 16px;
        line-height: 1;
        font-size: 11px;
        border-radius: 6px;
        padding: 2px 6px;
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.10);
        font-variant-numeric: tabular-nums;
      }
      .miniStatsKey {
        opacity: 0.75;
        text-transform: lowercase;
      }
      .miniStatsVal {
        text-align: right;
        opacity: 0.95;
      }

      /* Value input boxes */
      .valInput {
        width: 78px;
        padding: 4px 6px;
        border-radius: 8px;
        border: 1px solid rgba(255,255,255,0.22);
        background: rgba(0,0,0,0.25);
        color: #e8e8ea;
        font-size: 13px;
        text-align: right;
        font-variant-numeric: tabular-nums;
        outline: none;
        box-sizing: border-box;
      }
      .valInput:focus { border-color: rgba(255,255,255,0.45); }
      .valInput:disabled { opacity: 0.65; }

      /* Param rows */
      .paramRow { margin: 10px 0; }
      .paramTop {
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        margin-bottom: 6px;
      }
      .paramTag {
        font-size: 11px;
        letter-spacing: 0.08em;
        opacity: 0.75;
        text-transform: uppercase;
      }
      .paramName {
        font-size: 12px;
        opacity: 0.95;
      }
      .paramBody {
        display: flex;
        gap: 10px;
        align-items: center;
      }
      .paramBody input[type="range"] { flex: 1 1 auto; width: auto; }

      /* DEBUG (inside its own panel now) */
      #debug {
        margin: 0;
        padding: 0;

        height: 260px;
        min-height: 140px;
        max-height: 70vh;

        resize: vertical;
        overflow: hidden;

        display: flex;
        flex-direction: column;
        gap: 6px;

        font-size: 12px;
        line-height: 1.35;
        opacity: 0.95;
        box-sizing: border-box;
      }
      #debug.collapsed {
        height: auto;
        min-height: 0;
        max-height: none;
        resize: none;
      }

      #debugHeader { font-weight: 700; opacity: 0.95; flex: 0 0 auto; position: relative; top: 2px; }

      #log {
        flex: 1 1 auto;
        min-height: 0;
        margin: 0;
        padding: 8px;
        background: rgba(0,0,0,0.35);
        border-radius: 8px;

        overflow: auto;
        white-space: pre-wrap;
        word-break: break-word;

        box-sizing: border-box;
      }
      #debug.collapsed #log {
        flex: 0 0 auto;
        min-height: 0;
        max-height: calc(1.5em + 7px);
        overflow: hidden;
        white-space: nowrap;
        text-overflow: ellipsis;
      }
    </style>
  </head>

  <body>
    <div id="ui">
      <!-- BOX 1: Title + Version + Toolbar -->
      <div id="toolbarPanel" class="panelBox">
        <div id="titlePanel">
          <div id="appTitle">ParaHook Generator</div>
          <div id="appVersion">v 0.14.3</div>
        </div>

        <div class="row header">
          <div id="status">idle</div>
        </div>

        <!-- MODEL TOGGLE -->
        <div class="check withSideStats">
          <input id="modelEnabled" type="checkbox" checked />
          <label for="modelEnabled">Enable model (model.ts)</label>
          <div id="meshMiniStats" class="miniStats" aria-label="Mesh statistics">
            <div class="miniStatsRow">
              <span class="miniStatsKey">verts =</span>
              <span id="meshVerts" class="miniStatsVal">-</span>
            </div>
            <div class="miniStatsRow">
              <span class="miniStatsKey">tris =</span>
              <span id="meshTris" class="miniStatsVal">-</span>
            </div>
          </div>
        </div>
      </div>

      <!-- BOX 2: Controls (scrollable) -->
      <div id="controlsPanel" class="panelBox">
        <div id="controlsPanelTitle">Toolbar</div>
        <form id="controls" autocomplete="off">

          <!-- BUTTONS (collapsible group) -->
          <details class="section">
            <summary>Buttons</summary>
            <div class="sectionMeta">Custom button actions and presets (WIP)</div>
            <div class="btnStack">
              <button id="rebuild" type="button">Rebuild</button>
              <button id="exportStl" type="button" class="secondary">Export STL</button>
              <button id="exportStep" type="button" class="secondary">Export STEP</button>
              <button id="loadSettings" type="button" class="secondary">Load Settings</button>
              <button id="exportSettings" type="button" class="secondary">Export Settings</button>
            </div>
          </details>

          <!-- REFERENCE (collapsible group) -->
          <details class="section">
            <summary>Reference</summary>

            <!-- Notes -->
            <details class="section">
              <summary>-Releases</summary>
              <details class="section" open>
                <summary>0.14.3</summary>
                <div class="sectionMeta">Dr good fillet, Smooth &amp; Wiggly.</div>
                <div class="sectionMeta">Added Load Settings / Export Settings buttons (JSON) to save and restore the full UI input state.</div>
                <div class="sectionMeta">Heel crown fillet flow was reworked into a separate crown object path for preview performance and fused export output.</div>
                <div class="sectionMeta">HEEL_FIL_1 is now the heel crown enable toggle (master on/off for the added crown on the top of the heel kick).</div>
                <div class="sectionMeta">HEEL_FIL_1_R and HEEL_FIL_2_R now control the two crown shoulder radii (the two rounded top corners of the raised heel cap strip).</div>
                <div class="sectionMeta">When only the crown is enabled, the crown still builds fully; each side radius can be adjusted independently using the two heel fillet radius sliders.</div>
                <div class="sectionMeta">Dr Good Fillet auto-enables BP_FIL_1, TH_FIL_1, TH_FIL_2, and HEEL_FIL_1. Diet unchecked switches heel behavior to Sweep ON + Heel Midpoint Control OFF.</div>
                <div class="sectionMeta">Toe Hook now uses a single Add Profile B toggle (default OFF). OFF = direct A→C loft. ON = A→B→C loft. Profile B params are hidden when OFF and their values are preserved.</div>
                <div class="sectionMeta">TOE_AB_MID is ignored when Add Profile B is OFF. TOE_BC_MID is reused as the A→C intermediate profile count in that mode.</div>
                <div class="sectionMeta">Toe Hook Rail Math modes were added. Rail Math 1 = default Hermite fit, 2 = linear rails, 3 = linear + fixed end angle behavior, 4 = arc rails with absolute frame, 5/6 are experimental branches for custom end/transition rail tuning.</div>
                <div class="sectionMeta">Rail Math 5 adds two tuning controls: Rail Math 5 Cull Count (how many near-C intermediates are removed) and Rail Math 5 Add-Back Profiles (separate tail-loft transition profiles from the last AC intermediate to final Profile C).</div>
                <div class="sectionMeta">Heel Kick Rail Math modes were added (1–5). Heel Rail Math 2 mirrors the Sweep behavior. Heel Rail Math 4 keeps heel profiles parallel (fixed vertical section orientation) while 4A/4B are experimental sub-modes.</div>
                <div class="sectionMeta">Heel Rail Math 3 / Sweep and Heel Rail Math 4B now expose arc-shape tuning sliders: Sweep, Bias, and Blend. Sweep and Heel Rail Math 3 are UI-synced and share the same RM3 slider values.</div>
              </details>

              <details class="section">
                <summary>0.14.2</summary>
                <div class="sectionMeta">Added baseplate screw holes / slot controls. BP_SH_X and BP_SH_Y move the screw-hole pair origin relative to the UI screw-hole reference point on the baseplate.</div>
                <div class="sectionMeta">BP_SH_ANG sets the primary screw-hole axis angle. BP_SH_DIST sets spacing between hole centers along that axis. BP_SH_ANG2 and BP_SH_OFF2 control the second hole orientation/offset for non-matching slot alignment.</div>
                <div class="sectionMeta">BP_SH_DIA sets the actual hole diameter. BP_SH_WASHER sets the washer footprint diameter. BP_SH_SLOT adds slot length to the inline hole/washer profile (0 = round hole / round washer).</div>
                <div class="sectionMeta">BP_FIL_1 note: baseplate fillet path now renders as a 3-point arc (cleaner than tiny line segments), and the fillet on the corner touching the inner spline was removed.</div>
              </details>

              <details class="section">
                <summary>0.14.1</summary>
                <div class="sectionMeta">New Wiggle technology. toe A->B->C loft path is grounded to the baseplate for the solid model; toe hook arc controls now use P1S / P3S handle strengths (replacing older arc controls), and the new result is super wiggly.</div>
                <div class="sectionMeta">Toe rail architecture is driven by Profile A/B/C with per-profile rail strengths (TOE_A_STR, TOE_B_STR, TOE_C_STR) used to blend/control the outer/inner rail behavior across the loft.</div>
                <div class="sectionMeta">Heel kick: Profile C/D and C->D intermediates use a normal-cap cut workflow (cut by Z height, cap perpendicular to the outer tangent).</div>
                <div class="sectionMeta">Heel heights are clamped in app logic to the current Profile C top range; HEEL_H_C / HEEL_H_D may snap down if set too high.</div>
                <div class="sectionMeta">Debug window now logs worker build receives (sequence + dt) to help tune rebuild/debounce behavior.</div>
                <div class="sectionMeta">HEEL_F1 / HEEL_F2 and FIL_1..FIL_5 remain experimental / placeholder controls unless noted in current code behavior.</div>
              </details>

              <details class="section">
                <summary>0.13.0</summary>
                <div class="sectionMeta">13.423 - added section cut</div>
                <div class="sectionMeta">13.422 - updated shoe rotation</div>
              </details>
            </details>

            <!-- SECTION CUT -->
            <details class="section">
              <summary>-Section Cut</summary>
              <div class="sectionMeta">Slice preview/export. Offset is in mm along the active cut normal.</div>

              <div class="check">
                <input id="sectionCutEnabled" type="checkbox" />
                <label for="sectionCutEnabled">Enable section cut</label>
              </div>

              <div class="check">
                <input id="sectionCutFlip" type="checkbox" />
                <label for="sectionCutFlip">Flip section cut</label>
              </div>

              <div class="check">
                <input id="sectionCutZswitch" type="checkbox" />
                <label for="sectionCutZswitch">Plan / Section</label>
              </div>

              <div class="row">
                <label>Section Cut Offset
                  <input id="sectionCutOffset" type="range" min="-200" max="420" step="1" value="0" />
                </label>
                <input class="valInput" id="sectionCutOffsetVal" type="number" step="1" value="0" />
              </div>
            </details>

            <!-- Quality -->
            <details class="section">
              <summary>-Quality</summary>
              <div class="sectionMeta">Preview mesh settings</div>

              <div class="row">
                <label>Mesh Tolerance (higher = faster)
                  <input id="tolerance" name="tolerance" type="range" min="0.3" max="3.0" step="0.1" value="1.5" />
                </label>
                <input class="valInput" id="toleranceVal" type="number" step="0.1" value="1.5" />
              </div>

              <div class="row">
                <label>Rebuild Debounce (ms)
                  <input id="debounceMs" type="range" min="0" max="1000" step="10" value="200" />
                </label>
                <input class="valInput" id="debounceMsVal" type="number" min="0" max="1000" step="10" value="200" />
              </div>

              <div class="check">
                <input id="rebuildAsOne" type="checkbox" />
                <label for="rebuildAsOne">rebuild as one</label>
              </div>
            </details>

            <!-- PREMADE HOOKS -->
            <details class="section">
              <summary>-Premade Hooks</summary>
              <div class="sectionMeta">STEP overlays (small / medium / large / XL)</div>

              <div class="check">
                <input id="hookSmallEnabled" type="checkbox" />
                <label for="hookSmallEnabled">Small</label>
              </div>

              <div class="check">
                <input id="hookMediumEnabled" type="checkbox" />
                <label for="hookMediumEnabled">Medium</label>
              </div>

              <div class="check">
                <input id="hookLargeEnabled" type="checkbox" />
                <label for="hookLargeEnabled">Large</label>
              </div>

              <div class="check">
                <input id="hookXLEnabled" type="checkbox" />
                <label for="hookXLEnabled">XL</label>
              </div>

              <div class="row">
                <label>Hook Transform X (mm)
                  <input id="hookX" type="range" min="-150" max="150" step="1" value="0" />
                </label>
                <input class="valInput" id="hookXVal" type="number" step="1" value="0" />
              </div>

              <div class="row">
                <label>Hook Transform Y (mm)
                  <input id="hookY" type="range" min="-150" max="150" step="1" value="0" />
                </label>
                <input class="valInput" id="hookYVal" type="number" step="1" value="0" />
              </div>

              <div class="row">
                <label>Hook Transform Z (mm)
                  <input id="hookZ" type="range" min="-100" max="100" step="1" value="0" />
                </label>
                <input class="valInput" id="hookZVal" type="number" step="1" value="0" />
              </div>

              <div class="row">
                <label>Hook Rotate Plan (deg)
                  <input id="hookRot" type="range" min="-180" max="180" step="1" value="0" />
                </label>
                <input class="valInput" id="hookRotVal" type="number" step="1" value="0" />
              </div>
            </details>

            <!-- REFERENCE FOOTPAD -->
            <details class="section">
              <summary>-Reference Footpad</summary>
              <div class="sectionMeta">STL overlays for pad fit reference</div>

              <div class="check">
                <input id="footpad1Enabled" type="checkbox" />
                <label for="footpad1Enabled">Footpad 1</label>
              </div>

              <div class="check">
                <input id="footpad2Enabled" type="checkbox" checked />
                <label for="footpad2Enabled">Footpad 2</label>
              </div>

              <div class="check">
                <input id="footpad3Enabled" type="checkbox" />
                <label for="footpad3Enabled">Footpad 3</label>
              </div>

              <div class="row">
                <label>Footpad Transform X (mm)
                  <input id="footpadX" type="range" min="-100" max="150" step="1" value="62" />
                </label>
                <input class="valInput" id="footpadXVal" type="number" step="1" value="62" />
              </div>

              <div class="row">
                <label>Footpad Transform Y (mm)
                  <input id="footpadY" type="range" min="-100" max="150" step="1" value="95" />
                </label>
                <input class="valInput" id="footpadYVal" type="number" step="1" value="95" />
              </div>

              <div class="row">
                <label>Footpad Transform Z (mm)
                  <input id="footpadZ" type="range" min="-100" max="100" step="1" value="-19" />
                </label>
                <input class="valInput" id="footpadZVal" type="number" step="1" value="-19" />
              </div>

              <div class="row">
                <label>Footpad Rotate Plan (deg)
                  <input id="footpadRot" type="range" min="-180" max="180" step="1" value="0" />
                </label>
                <input class="valInput" id="footpadRotVal" type="number" step="1" value="0" />
              </div>
            </details>

            <!-- REFERENCE SHOE -->
            <details class="section">
              <summary>-Reference Shoe</summary>
              <div class="sectionMeta">OBJ overlay for fit and scale reference</div>

              <div class="check">
                <input id="shoeEnabled" type="checkbox" checked />
                <label for="shoeEnabled">Show shoe reference</label>
              </div>

              <div class="row">
                <label>Shoe Size (US 5–15) (10 = 1.00x)
                  <input id="shoeSize" type="range" min="5" max="15" step="0.5" value="10" />
                </label>
                <input class="valInput" id="shoeSizeVal" type="number" step="0.5" value="10" />
              </div>

              <div class="row">
                <label>Computed Scale //(relative to size 10)
                  <input id="shoeScale" type="range" min="0.80" max="1.25" step="0.001" value="1" disabled />
                </label>
                <input class="valInput" id="shoeScaleVal" type="number" step="0.001" value="1.000" disabled />
              </div>

              <div class="row">
                <label>Transparency (0 = solid, 1 = invisible)
                  <input id="shoeAlpha" type="range" min="0" max="1" step="0.01" value="0.5" />
                </label>
                <input class="valInput" id="shoeAlphaVal" type="number" step="0.01" value="0.5" />
              </div>

              <div class="row">
                <label>Transform X (mm)
                  <input id="shoeX" type="range" min="-200" max="200" step="1" value="0" />
                </label>
                <input class="valInput" id="shoeXVal" type="number" step="1" value="0" />
              </div>

              <div class="row">
                <label>Transform Y (mm)
                  <input id="shoeY" type="range" min="-200" max="200" step="1" value="0" />
                </label>
                <input class="valInput" id="shoeYVal" type="number" step="1" value="0" />
              </div>

              <div class="row">
                <label>Transform Z (mm)
                  <input id="shoeZ" type="range" min="-200" max="200" step="1" value="0" />
                </label>
                <input class="valInput" id="shoeZVal" type="number" step="1" value="0" />
              </div>

              <div class="row">
                <label>Rotate Plan (deg)
                  <input id="shoeRot" type="range" min="-180" max="180" step="1" value="0" />
                </label>
                <input class="valInput" id="shoeRotVal" type="number" step="1" value="0" />
              </div>
            </details>
          </details>

<!-- BASEPLATE -->
<details class="section">
  <summary>Baseplate</summary>
  <div class="sectionMeta">Primary baseplate controls</div>

  <div class="check">
    <input id="vizBasePts" type="checkbox" />
    <label for="vizBasePts">Show Baseplate control points</label>
  </div>

  <div class="check">
    <input id="baseEnabled" type="checkbox" checked />
    <label for="baseEnabled">Enable baseplate</label>
  </div>

  <!-- Dimensions -->
  <details class="section">
    <summary>-Dimensions</summary>
    <div class="sectionMeta">Overall size and spline controls</div>

    <!-- BP length -->
    <div class="paramRow">
      <div class="paramTop">
        <div class="paramTag">BP_LEN</div>
        <div class="paramName">Base Length (Y)</div>
      </div>
      <div class="paramBody">
        <input id="bp_len" name="bp_len" type="range" min="100" max="420" step="1" value="195" />
        <input class="valInput" id="bp_lenVal" type="number" step="1" value="195" />
      </div>
    </div>

    <!-- BP width -->
    <div class="paramRow">
      <div class="paramTop">
        <div class="paramTag">BP_WID</div>
        <div class="paramName">Base Width Offset (mm)</div>
      </div>
      <div class="paramBody">
        <input id="bp_wid" name="bp_wid" type="range" min="5" max="140" step="1" value="30" />
        <input class="valInput" id="bp_widVal" type="number" step="1" value="30" />
      </div>
    </div>

    <!-- BP thickness -->
    <div class="paramRow">
      <div class="paramTop">
        <div class="paramTag">BP_THK</div>
        <div class="paramName">Base Thickness (Z)</div>
      </div>
      <div class="paramBody">
        <input id="bp_thk" name="bp_thk" type="range" min="-40" max="30" step="1" value="12" />
        <input class="valInput" id="bp_thkVal" type="number" step="1" value="12" />
      </div>
    </div>

    <!-- BP heel% -->
    <div class="paramRow">
      <div class="paramTop">
        <div class="paramTag">BP_HEEL_PCT</div>
        <div class="paramName">Point Heel % (P3 Y as % of Base Length)</div>
      </div>
      <div class="paramBody">
        <input id="bp_heelPct" name="bp_heelPct" type="range" min="50" max="100" step="1" value="67" />
        <input class="valInput" id="bp_heelPctVal" type="number" step="1" value="67" />
      </div>
    </div>

    <!-- BP toe% -->
    <div class="paramRow">
      <div class="paramTop">
        <div class="paramTag">BP_TOE_PCT</div>
        <div class="paramName">Point Toe % (P2 Y as % of Heel Y)</div>
      </div>
      <div class="paramBody">
        <input id="bp_toePct" name="bp_toePct" type="range" min="5" max="95" step="1" value="46" />
        <input class="valInput" id="bp_toePctVal" type="number" step="1" value="46" />
      </div>
    </div>

    <!-- BP P2X -->
    <div class="paramRow">
      <div class="paramTop">
        <div class="paramTag">BP_P2X</div>
        <div class="paramName">Point 2 X</div>
      </div>
      <div class="paramBody">
        <input id="bp_p2x" name="bp_p2x" type="range" min="-80" max="40" step="1" value="-14" />
        <input class="valInput" id="bp_p2xVal" type="number" step="1" value="-14" />
      </div>
    </div>

    <!-- BP P3X -->
    <div class="paramRow">
      <div class="paramTop">
        <div class="paramTag">BP_P3X</div>
        <div class="paramName">Point 3 X</div>
      </div>
      <div class="paramBody">
        <input id="bp_p3x" name="bp_p3x" type="range" min="-80" max="40" step="1" value="-2" />
        <input class="valInput" id="bp_p3xVal" type="number" step="1" value="-2" />
      </div>
    </div>

    <!-- BP P4X -->
    <div class="paramRow">
      <div class="paramTop">
        <div class="paramTag">BP_P4X</div>
        <div class="paramName">Point 4 X</div>
      </div>
      <div class="paramBody">
        <input id="bp_p4x" name="bp_p4x" type="range" min="-80" max="80" step="1" value="1" />
        <input class="valInput" id="bp_p4xVal" type="number" step="1" value="1" />
      </div>
    </div>
  </details>

  <!-- Screw Holes (keep same as you already added) -->
  <details class="section">
    <summary>-Screw Holes</summary>
    <div class="sectionMeta">
      Slot pattern controls. Hole 1 X/Y are local offsets (mm) from the calibrated screw-hole origin. Slot length is 0 for a round hole.
    </div>

    <div class="paramRow">
      <div class="paramTop">
        <div class="paramTag">BP_SH_X</div>
        <div class="paramName">Hole 1 X Offset (mm)</div>
      </div>
      <div class="paramBody">
        <input id="bp_sh_x" name="bp_sh_x" type="range" min="-80" max="80" step="1" value="0" />
        <input class="valInput" id="bp_sh_xVal" type="number" step="1" value="0" />
      </div>
    </div>

    <div class="paramRow">
      <div class="paramTop">
        <div class="paramTag">BP_SH_Y</div>
        <div class="paramName">Hole 1 Y Offset (mm)</div>
      </div>
      <div class="paramBody">
        <input id="bp_sh_y" name="bp_sh_y" type="range" min="-120" max="120" step="1" value="0" />
        <input class="valInput" id="bp_sh_yVal" type="number" step="1" value="0" />
      </div>
    </div>

    <div class="paramRow">
      <div class="paramTop">
        <div class="paramTag">BP_SH_ANG</div>
        <div class="paramName">Hole 1 Angle (deg)</div>
      </div>
      <div class="paramBody">
        <input id="bp_sh_ang" name="bp_sh_ang" type="range" min="-180" max="180" step="1" value="12" />
        <input class="valInput" id="bp_sh_angVal" type="number" step="1" value="12" />
      </div>
    </div>

    <div class="paramRow">
      <div class="paramTop">
        <div class="paramTag">BP_SH_DIA</div>
        <div class="paramName">Screw Diameter (mm)</div>
      </div>
      <div class="paramBody">
        <input id="bp_sh_dia" name="bp_sh_dia" type="range" min="2" max="10" step="0.1" value="5" />
        <input class="valInput" id="bp_sh_diaVal" type="number" step="0.1" value="5.0" />
      </div>
    </div>

    <div class="paramRow">
      <div class="paramTop">
        <div class="paramTag">BP_SH_WASHER</div>
        <div class="paramName">Washer Diameter (mm)</div>
      </div>
      <div class="paramBody">
        <input id="bp_sh_washer" name="bp_sh_washer" type="range" min="5" max="30" step="0.5" value="10" />
        <input class="valInput" id="bp_sh_washerVal" type="number" min="5" max="30" step="0.5" value="10" />
      </div>
    </div>

    <div class="paramRow">
      <div class="paramTop">
        <div class="paramTag">BP_SH_SLOT</div>
        <div class="paramName">Screw Slot Length (mm)</div>
      </div>
      <div class="paramBody">
        <input id="bp_sh_slot" name="bp_sh_slot" type="range" min="0" max="40" step="0.5" value="30" />
        <input class="valInput" id="bp_sh_slotVal" type="number" step="0.5" value="30" />
      </div>
    </div>

    <div class="paramRow">
      <div class="paramTop">
        <div class="paramTag">BP_SH_DIST</div>
        <div class="paramName">Slot Distance (center-to-center, mm)</div>
      </div>
      <div class="paramBody">
        <input id="bp_sh_dist" name="bp_sh_dist" type="range" min="10" max="180" step="1" value="10" />
        <input class="valInput" id="bp_sh_distVal" type="number" step="1" value="10" />
      </div>
    </div>

    <div class="paramRow">
      <div class="paramTop">
        <div class="paramTag">BP_SH_ANG2</div>
        <div class="paramName">Hole 2 Angle (deg)</div>
      </div>
      <div class="paramBody">
        <input id="bp_sh_ang2" name="bp_sh_ang2" type="range" min="-180" max="180" step="1" value="-20" />
        <input class="valInput" id="bp_sh_ang2Val" type="number" step="1" value="-20" />
      </div>
    </div>

    <div class="paramRow">
      <div class="paramTop">
        <div class="paramTag">BP_SH_OFF2</div>
        <div class="paramName">Hole 2 Offset (mm, along axis)</div>
      </div>
      <div class="paramBody">
        <input id="bp_sh_off2" name="bp_sh_off2" type="range" min="-80" max="80" step="1" value="60" />
        <input class="valInput" id="bp_sh_off2Val" type="number" step="1" value="60" />
      </div>
    </div>
  </details>
</details>
          <!-- Toe Hook (named keys) -->
          <details class="section">
            <summary>Toe Hook</summary>
            <div class="sectionMeta">Profiles A → B (mid) → C (end). Stations measured in mm along the spline from origin.</div>
            <div class="check">
              <input id="toeAddProfileB" type="checkbox"  checked />
              <label for="toeAddProfileB">Add Profile B</label>
            </div>

            <!-- Profile A -->
            <details class="section">
              <summary>Profile A</summary>
              <div class="sectionMeta">
                Start profile at spline start. Uses a 2-point organic curve (Bezier) with a vertical start handle and an angled end handle.
              </div>

              <div class="check">
                <input id="vizAArcPts" type="checkbox" />
                <label for="vizAArcPts">Show Profile A control handles</label>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_THK</div>
                  <div class="paramName">Toe Hook Thickness (offset, mm)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_thk" name="toe_thk" type="range" min="5" max="25" step="0.5" value="12" />
                  <input class="valInput" id="toe_thkVal" type="number" step="0.5" value="12" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_A_P1S</div>
                  <div class="paramName">P1 Strength (vertical handle, mm)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_a_p1s" name="toe_a_p1s" type="range" min="0" max="140" step="1" value="25" />
                  <input class="valInput" id="toe_a_p1sVal" type="number" step="1" value="25" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_A_P3S</div>
                  <div class="paramName">End Handle Strength (mm)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_a_p3s" name="toe_a_p3s" type="range" min="0" max="140" step="1" value="35" />
                  <input class="valInput" id="toe_a_p3sVal" type="number" step="1" value="35" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_A_ENDX</div>
                  <div class="paramName">End X A (mm)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_a_endx" name="toe_a_endx" type="range" min="0" max="160" step="1" value="47" />
                  <input class="valInput" id="toe_a_endxVal" type="number" step="1" value="47" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_A_ENDZ</div>
                  <div class="paramName">End Z A (mm)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_a_endz" name="toe_a_endz" type="range" min="0" max="180" step="1" value="35" />
                  <input class="valInput" id="toe_a_endzVal" type="number" step="1" value="35" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_A_ENDA</div>
                  <div class="paramName">End Handle Angle (deg)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_a_enda" name="toe_a_enda" type="range" min="-180" max="180" step="1" value="0" />
                  <input class="valInput" id="toe_a_endaVal" type="number" step="1" value="0" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_A_STR</div>
                  <div class="paramName">Rail Strength at A</div>
                </div>
                <div class="paramBody">
                  <input id="toe_a_strength" name="toe_a_strength" type="range" min="0.2" max="8" step="0.01" value="2" />
                  <input class="valInput" id="toe_a_strengthVal" type="number" min="0.2" max="8" step="0.01" value="2" />
                </div>
              </div>
            </details>

            <!-- Profile B -->
            <details id="toeProfileBSection" class="section" open>
              <summary>Profile B</summary>
              <div class="sectionMeta">Mid control profile. Station is mm along spline from origin. Controls A→B intermediate sections.</div>

              <div class="sectionMeta" style="margin-top: 6px; opacity: 0.9;">
                Loft Params
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_B_STA</div>
                  <div class="paramName">Profile B Length (mm along spline)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_b_sta" name="toe_b_sta" type="range" min="1" max="260" step="1" value="60" />
                  <input class="valInput" id="toe_b_staVal" type="number" step="1" value="60" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_AB_MID</div>
                  <div class="paramName">A→B Intermediate Profiles (0 = A→B only)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_ab_mid" name="toe_ab_mid" type="range" min="0" max="60" step="1" value="20" />
                  <input class="valInput" id="toe_ab_midVal" type="number" step="1" value="10" />
                </div>
              </div>

              <div class="sectionMeta" style="margin-top: 10px; opacity: 0.9;">
                Profile Controls
              </div>

              <div class="check">
                <input id="vizBArcPts" type="checkbox" />
                <label for="vizBArcPts">Show Profile B control handles</label>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_B_P1S</div>
                  <div class="paramName">P1 Strength (vertical handle, mm)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_b_p1s" name="toe_b_p1s" type="range" min="0" max="140" step="1" value="25" />
                  <input class="valInput" id="toe_b_p1sVal" type="number" step="1" value="25" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_B_P3S</div>
                  <div class="paramName">End Handle Strength (mm)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_b_p3s" name="toe_b_p3s" type="range" min="0" max="140" step="1" value="36" />
                  <input class="valInput" id="toe_b_p3sVal" type="number" step="1" value="36" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_B_ENDX</div>
                  <div class="paramName">End X B (mm)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_b_endx" name="toe_b_endx" type="range" min="0" max="160" step="1" value="47" />
                  <input class="valInput" id="toe_b_endxVal" type="number" step="1" value="47" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_B_ENDZ</div>
                  <div class="paramName">End Z B (mm)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_b_endz" name="toe_b_endz" type="range" min="0" max="180" step="1" value="50" />
                  <input class="valInput" id="toe_b_endzVal" type="number" step="1" value="50" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_B_ENDA</div>
                  <div class="paramName">End Handle Angle (deg)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_b_enda" name="toe_b_enda" type="range" min="-180" max="180" step="1" value="-18" />
                  <input class="valInput" id="toe_b_endaVal" type="number" step="1" value="-18" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_B_STR</div>
                  <div class="paramName">Rail Strength at B</div>
                </div>
                <div class="paramBody">
                  <input id="toe_b_strength" name="toe_b_strength" type="range" min="0.2" max="8" step="0.01" value="2" />
                  <input class="valInput" id="toe_b_strengthVal" type="number" min="0.2" max="8" step="0.01" value="2" />
                </div>
              </div>
            </details>

            <!-- Profile C -->
            <details class="section">
              <summary>Profile C</summary>
              <div class="sectionMeta">End profile. Station is mm along spline from origin. Controls B→C intermediate sections.</div>

              <div class="sectionMeta" style="margin-top: 6px; opacity: 0.9;">
                Loft Params
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_C_STA</div>
                  <div class="paramName">Profile C Length (mm along spline)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_c_sta" name="toe_c_sta" type="range" min="1" max="260" step="1" value="137" />
                  <input class="valInput" id="toe_c_staVal" type="number" step="1" value="137" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_BC_MID</div>
                  <div class="paramName">B→C Intermediate Profiles (0 = B→C only)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_bc_mid" name="toe_bc_mid" type="range" min="0" max="60" step="1" value="20" />
                  <input class="valInput" id="toe_bc_midVal" type="number" step="1" value="15" />
                </div>
              </div>

              <div class="sectionMeta" style="margin-top: 10px; opacity: 0.9;">
                Profile Controls
              </div>

              <div class="check">
                <input id="vizCArcPts" type="checkbox" />
                <label for="vizCArcPts">Show Profile C control handles</label>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_C_P1S</div>
                  <div class="paramName">P1 Strength (vertical handle, mm)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_c_p1s" name="toe_c_p1s" type="range" min="0" max="140" step="1" value="25" />
                  <input class="valInput" id="toe_c_p1sVal" type="number" step="1" value="25" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_C_P3S</div>
                  <div class="paramName">End Handle Strength (mm)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_c_p3s" name="toe_c_p3s" type="range" min="0" max="140" step="1" value="35" />
                  <input class="valInput" id="toe_c_p3sVal" type="number" step="1" value="35" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_C_ENDX</div>
                  <div class="paramName">End X C (mm)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_c_endx" name="toe_c_endx" type="range" min="0" max="180" step="1" value="19" />
                  <input class="valInput" id="toe_c_endxVal" type="number" step="1" value="19" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_C_ENDZ</div>
                  <div class="paramName">End Z C (mm)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_c_endz" name="toe_c_endz" type="range" min="0" max="200" step="1" value="75" />
                  <input class="valInput" id="toe_c_endzVal" type="number" step="1" value="75" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_C_ENDA</div>
                  <div class="paramName">End Handle Angle (deg)</div>
                </div>
                <div class="paramBody">
                  <input id="toe_c_enda" name="toe_c_enda" type="range" min="-180" max="180" step="1" value="-70" />
                  <input class="valInput" id="toe_c_endaVal" type="number" step="1" value="-70" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TOE_C_STR</div>
                  <div class="paramName">Rail Strength at C</div>
                </div>
                <div class="paramBody">
                  <input id="toe_c_strength" name="toe_c_strength" type="range" min="0.2" max="8" step="0.01" value="7" />
                  <input class="valInput" id="toe_c_strengthVal" type="number" min="0.2" max="8" step="0.01" value="7" />
                </div>
              </div>

            </details>

          </details>

          <!-- Heel Kick (still paramN on purpose; we will rename after toe is stable) -->
          <details class="section">
            <summary>Heel Kick</summary>
            <div class="sectionMeta">Heights and fillet placeholders for the heel-kick loft.</div>

            <div class="check">
              <input id="heelEnabled" type="checkbox" checked />
              <label for="heelEnabled">Enable heel kick loft</label>
            </div>

            <div class="check">
              <input id="vizHeelArcPts" type="checkbox" />
              <label for="vizHeelArcPts">Show Heel Kick arc control points</label>
            </div>

            <div class="paramRow">
              <div class="paramTop">
                <div class="paramTag">HEEL_H_C</div>
                <div class="paramName">Heel Kick Height at Profile C (mm)</div>
              </div>
              <div class="paramBody">
                <input id="heel_h_c" name="heel_h_c" type="range" min="0" max="200" step="1" value="40" />
                <input class="valInput" id="heel_h_cVal" type="number" step="1" value="40" />
              </div>
            </div>

            <div class="check">
              <input id="heel_mid_ctrl" type="checkbox" />
              <label for="heel_mid_ctrl">heel midpoint control</label>
            </div>

            <div class="check">
              <input id="heel_sweep" type="checkbox" />
              <label for="heel_sweep">sweep</label>
            </div>
            <div id="heelSweepRm3Wrap" style="display:none; margin: 4px 0 8px 18px;">
              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">HEEL_RM3_SWEEP</div>
                  <div class="paramName">Heel RM3 Arc Sweep</div>
                </div>
                <div class="paramBody">
                  <input id="heel_sweep_rm3_sweep" type="range" min="0" max="2" step="0.01" value="1" />
                  <input class="valInput" id="heel_sweep_rm3_sweepVal" type="number" min="0" max="2" step="0.01" value="1" />
                </div>
              </div>
              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">HEEL_RM3_BIAS</div>
                  <div class="paramName">Heel RM3 Midpoint Bias</div>
                </div>
                <div class="paramBody">
                  <input id="heel_sweep_rm3_bias" type="range" min="-1" max="1" step="0.01" value="0" />
                  <input class="valInput" id="heel_sweep_rm3_biasVal" type="number" min="-1" max="1" step="0.01" value="0" />
                </div>
              </div>
              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">HEEL_RM3_BLEND</div>
                  <div class="paramName">Heel RM3 Blend</div>
                </div>
                <div class="paramBody">
                  <input id="heel_sweep_rm3_blend" type="range" min="0" max="1" step="0.01" value="1" />
                  <input class="valInput" id="heel_sweep_rm3_blendVal" type="number" min="0" max="1" step="0.01" value="1" />
                </div>
              </div>
            </div>

            <div class="paramRow">
              <div class="paramTop">
                <div class="paramTag">HEEL_H_D</div>
                <div class="paramName">Heel Kick Height at Profile D (mm)</div>
              </div>
              <div class="paramBody">
                <input id="heel_h_d" name="heel_h_d" type="range" min="0" max="200" step="1" value="10" />
                <input class="valInput" id="heel_h_dVal" type="number" step="1" value="10" />
              </div>
            </div>

            <div class="paramRow">
              <div class="paramTop">
                <div class="paramTag">HEEL_CD_MID</div>
                <div class="paramName">Heel Loft Intermediate Profiles (0 = C→D only)</div>
              </div>
              <div class="paramBody">
                <input id="heel_cd_mid" name="heel_cd_mid" type="range" min="0" max="60" step="1" value="10" />
                <input class="valInput" id="heel_cd_midVal" type="number" step="1" value="2" />
              </div>
            </div>

            <div class="paramRow">
              <div class="paramTop">
                <div class="paramTag">HEEL_CD_MID_PCT</div>
                <div class="paramName">Heel D-Profile Midpoint (%)</div>
              </div>
              <div class="paramBody">
                <input id="heel_cd_mid_pct" name="heel_cd_mid_pct" type="range" min="10" max="90" step="1" value="50" />
                <input class="valInput" id="heel_cd_mid_pctVal" type="number" min="10" max="90" step="1" value="50" />
              </div>
            </div>

            <div class="paramRow">
              <div class="paramTop">
                <div class="paramTag">HEEL_F1</div>
                <div class="paramName">Heel Kick Fillet Radius 1 (mm) (placeholder)</div>
              </div>
              <div class="paramBody">
                <input id="heel_f1" name="heel_f1" type="range" min="0" max="30" step="0.5" value="0" />
                <input class="valInput" id="heel_f1Val" type="number" step="0.5" value="0" />
              </div>
            </div>

            <div class="paramRow">
              <div class="paramTop">
                <div class="paramTag">HEEL_F2</div>
                <div class="paramName">Heel Kick Fillet Radius 2 (mm) (placeholder)</div>
              </div>
              <div class="paramBody">
                <input id="heel_f2" name="heel_f2" type="range" min="0" max="30" step="0.5" value="0" />
                <input class="valInput" id="heel_f2Val" type="number" step="0.5" value="0" />
              </div>
            </div>
          </details>

          <!-- Fillets placeholders -->
          <details class="section">
            <summary>Fillets</summary>
            <div class="sectionMeta">Temporary global fillet params (placeholders). These do not affect the model yet.</div>
            <div class="check">
              <input id="dr_good_fillet" type="checkbox"  checked />
              <label for="dr_good_fillet">Dr Good Fillet</label>
            </div>
            <div class="check" id="dr_good_fillet_diet_wrap" style="display: none;">
              <input id="dr_good_fillet_diet" type="checkbox" />
              <label for="dr_good_fillet_diet">Diet</label>
            </div>
            <details class="section">
              <summary>Global (Placeholders)</summary>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">FIL_1</div>
                  <div class="paramName">Fillet Param 1 (mm) (placeholder)</div>
                </div>
                <div class="paramBody">
                  <input id="fil_1" name="fil_1" type="range" min="0" max="30" step="0.5" value="0" />
                  <input class="valInput" id="fil_1Val" type="number" step="0.5" value="0" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">FIL_2</div>
                  <div class="paramName">Fillet Param 2 (mm) (placeholder)</div>
                </div>
                <div class="paramBody">
                  <input id="fil_2" name="fil_2" type="range" min="0" max="30" step="0.5" value="0" />
                  <input class="valInput" id="fil_2Val" type="number" step="0.5" value="0" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">FIL_3</div>
                  <div class="paramName">Fillet Param 3 (mm) (placeholder)</div>
                </div>
                <div class="paramBody">
                  <input id="fil_3" name="fil_3" type="range" min="0" max="30" step="0.5" value="0" />
                  <input class="valInput" id="fil_3Val" type="number" step="0.5" value="0" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">FIL_4</div>
                  <div class="paramName">Fillet Param 4 (mm) (placeholder)</div>
                </div>
                <div class="paramBody">
                  <input id="fil_4" name="fil_4" type="range" min="0" max="30" step="0.5" value="0" />
                  <input class="valInput" id="fil_4Val" type="number" step="0.5" value="0" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">FIL_5</div>
                  <div class="paramName">Fillet Param 5 (mm) (placeholder)</div>
                </div>
                <div class="paramBody">
                  <input id="fil_5" name="fil_5" type="range" min="0" max="30" step="0.5" value="0" />
                  <input class="valInput" id="fil_5Val" type="number" step="0.5" value="0" />
                </div>
              </div>
            </details>

            <details class="section">
              <summary>Baseplate</summary>

              <div class="check">
                <input id="bp_fil_1" type="checkbox" checked />
                <label for="bp_fil_1">BP_FIL_1</label>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">BP_FIL_1_R</div>
                  <div class="paramName">Base Plate Fillet 1 Radius (mm)</div>
                </div>
                <div class="paramBody">
                  <input id="bp_fil_1_r" name="bp_fil_1_r" type="range" min="0" max="40" step="0.5" value="8" />
                  <input class="valInput" id="bp_fil_1_rVal" type="number" step="0.5" value="8" />
                </div>
              </div>

              <div class="check">
                <input id="sh_fil_1" type="checkbox" />
                <label for="sh_fil_1">SH_FIL_1</label>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">SH_FIL_1_R</div>
                  <div class="paramName">Screw Hole Fillet 1 Radius (mm)</div>
                </div>
                <div class="paramBody">
                  <input id="sh_fil_1_r" name="sh_fil_1_r" type="range" min="0" max="40" step="0.5" value="4" />
                  <input class="valInput" id="sh_fil_1_rVal" type="number" step="0.5" value="4" />
                </div>
              </div>
            </details>

            <details class="section">
              <summary>Toe Hook</summary>

              <div class="check">
                <input id="th_fil_1" type="checkbox"  checked />
                <label for="th_fil_1">TH_FIL_1</label>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TH_FIL_1_R</div>
                  <div class="paramName">TH Fillet 1 Radius (mm)</div>
                </div>
                <div class="paramBody">
                  <input id="th_fil_1_r" name="th_fil_1_r" type="range" min="0" max="40" step="0.5" value="4" />
                  <input class="valInput" id="th_fil_1_rVal" type="number" step="0.5" value="4" />
                </div>
              </div>

              <div class="check">
                <input id="th_fil_2" type="checkbox"  checked />
                <label for="th_fil_2">TH_FIL_2</label>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">TH_FIL_2_R</div>
                  <div class="paramName">TH Fillet 2 Radius (mm)</div>
                </div>
                <div class="paramBody">
                  <input id="th_fil_2_r" name="th_fil_2_r" type="range" min="0" max="40" step="0.5" value="4" />
                  <input class="valInput" id="th_fil_2_rVal" type="number" step="0.5" value="4" />
                </div>
              </div>
            </details>

            <details class="section">
              <summary>Heel</summary>

              <div class="check">
                <input id="heel_fil_1" type="checkbox"  checked />
                <label for="heel_fil_1">HEEL_FIL_1</label>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">HEEL_FIL_1_R</div>
                  <div class="paramName">Heel Fillet 1 Radius (mm)</div>
                </div>
                <div class="paramBody">
                  <input id="heel_fil_1_r" name="heel_fil_1_r" type="range" min="0" max="40" step="0.5" value="4" />
                  <input class="valInput" id="heel_fil_1_rVal" type="number" step="0.5" value="4" />
                </div>
              </div>

              <div class="paramRow">
                <div class="paramTop">
                  <div class="paramTag">HEEL_FIL_2_R</div>
                  <div class="paramName">Heel Fillet 2 Radius (mm)</div>
                </div>
                <div class="paramBody">
                  <input id="heel_fil_2_r" name="heel_fil_2_r" type="range" min="0" max="40" step="0.5" value="4" />
                  <input class="valInput" id="heel_fil_2_rVal" type="number" step="0.5" value="4" />
                </div>
              </div>
            </details>


          </details>
            <details class="section">
              <summary>Rail Math</summary>

              <details class="section" open>
                <summary>Tagent Profiles</summary>
                <div class="check">
                  <input id="tagent_profile_a" type="checkbox" />
                  <label for="tagent_profile_a">Tagent Profile A</label>
                </div>
                <div id="tagentProfileAControls" style="display:none; margin: 4px 0 10px 18px;">
                  <div class="paramRow">
                    <div class="paramTop">
                      <div class="paramTag">TAGENT_A_OFFSET_ROT</div>
                      <div class="paramName">Offset Rotation</div>
                    </div>
                    <div class="paramBody">
                      <input id="tagent_a_offset_rot" type="range" min="-180" max="180" step="1" value="0" />
                      <input class="valInput" id="tagent_a_offset_rotVal" type="number" min="-180" max="180" step="1" value="0" />
                    </div>
                  </div>
                  <div class="paramRow">
                    <div class="paramTop">
                      <div class="paramTag">TAGENT_A_MIDPOINT</div>
                      <div class="paramName">Midpoint</div>
                    </div>
                    <div class="paramBody">
                      <input id="tagent_a_midpoint" type="range" min="0" max="100" step="1" value="100" />
                      <input class="valInput" id="tagent_a_midpointVal" type="number" min="0" max="100" step="1" value="50" />
                    </div>
                  </div>
                  <div class="paramRow">
                    <div class="paramTop">
                      <div class="paramTag">TAGENT_A_PLACEHOLDER_1</div>
                      <div class="paramName">Placeholder 1</div>
                    </div>
                    <div class="paramBody">
                      <input id="tagent_a_placeholder_1" type="range" min="0" max="100" step="1" value="0" />
                      <input class="valInput" id="tagent_a_placeholder_1Val" type="number" min="0" max="100" step="1" value="0" />
                    </div>
                  </div>
                  <div class="paramRow">
                    <div class="paramTop">
                      <div class="paramTag">TAGENT_A_PLACEHOLDER_2</div>
                      <div class="paramName">Placeholder 2</div>
                    </div>
                    <div class="paramBody">
                      <input id="tagent_a_placeholder_2" type="range" min="0" max="100" step="1" value="0" />
                      <input class="valInput" id="tagent_a_placeholder_2Val" type="number" min="0" max="100" step="1" value="0" />
                    </div>
                  </div>
                  <div class="check">
                    <input id="tagent_a_bp_cut_perp" type="checkbox"  checked />
                    <label for="tagent_a_bp_cut_perp">Perpendicular Baseplate Cut @ A</label>
                  </div>
                </div>
                <div class="check">
                  <input id="tagent_profile_b" type="checkbox" checked />
                  <label for="tagent_profile_b">Tagent Profile B</label>
                </div>
                <div class="check">
                  <input id="tagent_profile_c" type="checkbox" checked />
                  <label for="tagent_profile_c">Tagent Profile C</label>
                </div>
                <div class="check">
                  <input id="tagent_profile_d" type="checkbox" checked />
                  <label for="tagent_profile_d">Tagent Profile D</label>
                </div>
                <div id="tagentProfileDControls" style="display:none; margin: 4px 0 10px 18px;">
                  <div class="check">
                    <input id="tagent_d_cut_perp" type="checkbox" />
                    <label for="tagent_d_cut_perp">Perpendicular Heel Cut @ D</label>
                  </div>
                </div>
              </details>

              <details class="section">
                <summary>Toe Hook Rail Math</summary>
                <div class="check">
                  <input id="rail_math_current" type="checkbox" checked />
                  <label for="rail_math_current">Default: Hermite Fit</label>
                </div>
                <div class="check">
                  <input id="rail_math_2" type="checkbox" />
                  <label for="rail_math_2">Rail Math 2: Linear Rails</label>
                </div>
                <div class="check">
                  <input id="rail_math_3" type="checkbox" />
                  <label for="rail_math_3">Rail Math 3: Linear + Fixed End Angle</label>
                </div>
                <div class="check">
                  <input id="rail_math_4" type="checkbox" />
                  <label for="rail_math_4">Rail Math 4: Arc Rails (Absolute Frame)</label>
                </div>
                <div class="check">
                  <input id="rail_math_5" type="checkbox" />
                  <label for="rail_math_5">Rail Math 5</label>
                </div>
                <div id="railMath5CullWrap" class="paramRow" style="display:none;">
                  <div class="paramTop">
                    <div class="paramTag">RAIL_MATH_5_CULL</div>
                    <div class="paramName">Rail Math 5 Cull Count (near C)</div>
                  </div>
                  <div class="paramBody">
                    <input id="rail_math_5_cull" name="rail_math_5_cull" type="range" min="0" max="4" step="1" value="1" />
                    <input class="valInput" id="rail_math_5_cullVal" type="number" min="0" max="4" step="1" value="1" />
                  </div>
                </div>
                <div id="railMath5AddbackWrap" class="paramRow" style="display:none;">
                  <div class="paramTop">
                    <div class="paramTag">RAIL_MATH_5_ADDBACK</div>
                    <div class="paramName">Rail Math 5 Add-Back Profiles (Last AC -> C)</div>
                  </div>
                  <div class="paramBody">
                    <input id="rail_math_5_addback" name="rail_math_5_addback" type="range" min="0" max="6" step="1" value="0" />
                    <input class="valInput" id="rail_math_5_addbackVal" type="number" min="0" max="6" step="1" value="0" />
                  </div>
                </div>
                <div class="check">
                  <input id="rail_math_6" type="checkbox" />
                  <label for="rail_math_6">Rail Math 6</label>
                </div>
                <div id="railMath6SubWrap" style="display:none; margin: 4px 0 8px 18px;">
                  <div class="check">
                    <input id="rail_math_6a" type="checkbox"  checked />
                    <label for="rail_math_6a">Rail Math 6A</label>
                  </div>
                  <div class="check">
                    <input id="rail_math_6b" type="checkbox" />
                    <label for="rail_math_6b">Rail Math 6B</label>
                  </div>
                  <div class="check">
                    <input id="rail_math_6c" type="checkbox" />
                    <label for="rail_math_6c">Rail Math 6C</label>
                  </div>
                </div>
                <div class="check">
                  <input id="rail_math_7" type="checkbox" />
                  <label for="rail_math_7">Rail Math 7</label>
                </div>
                <div class="check">
                  <input id="rail_math_8" type="checkbox" />
                  <label for="rail_math_8">Rail Math 8</label>
                </div>
                <div class="check">
                  <input id="rail_math_9" type="checkbox" />
                  <label for="rail_math_9">Rail Math 9</label>
                </div>
                <div class="check">
                  <input id="rail_math_10" type="checkbox" />
                  <label for="rail_math_10">Rail Math 10</label>
                </div>
              </details>

              <details class="section">
                <summary>Heel Kick Rail Math</summary>
                <div class="check">
                  <input id="heel_rail_math_1" type="checkbox" />
                  <label for="heel_rail_math_1">Heel Rail Math 1</label>
                </div>
                <div class="check">
                  <input id="heel_rail_math_2" type="checkbox" checked />
                  <label for="heel_rail_math_2">Heel Rail Math 2</label>
                </div>
                <div class="check">
                  <input id="heel_rail_math_3" type="checkbox" />
                  <label for="heel_rail_math_3">Heel Rail Math 3</label>
                </div>
                <div id="heelRailMath3Wrap" style="display:none; margin: 4px 0 8px 18px;">
                  <div class="paramRow">
                    <div class="paramTop">
                      <div class="paramTag">HEEL_RM3_SWEEP</div>
                      <div class="paramName">Heel RM3 Arc Sweep</div>
                    </div>
                    <div class="paramBody">
                      <input id="heel_rm3_sweep" name="heel_rm3_sweep" type="range" min="0" max="2" step="0.01" value="1" />
                      <input class="valInput" id="heel_rm3_sweepVal" type="number" min="0" max="2" step="0.01" value="1" />
                    </div>
                  </div>
                  <div class="paramRow">
                    <div class="paramTop">
                      <div class="paramTag">HEEL_RM3_BIAS</div>
                      <div class="paramName">Heel RM3 Midpoint Bias</div>
                    </div>
                    <div class="paramBody">
                      <input id="heel_rm3_bias" name="heel_rm3_bias" type="range" min="-1" max="1" step="0.01" value="0" />
                      <input class="valInput" id="heel_rm3_biasVal" type="number" min="-1" max="1" step="0.01" value="0" />
                    </div>
                  </div>
                  <div class="paramRow">
                    <div class="paramTop">
                      <div class="paramTag">HEEL_RM3_BLEND</div>
                      <div class="paramName">Heel RM3 Blend</div>
                    </div>
                    <div class="paramBody">
                      <input id="heel_rm3_blend" name="heel_rm3_blend" type="range" min="0" max="1" step="0.01" value="1" />
                      <input class="valInput" id="heel_rm3_blendVal" type="number" min="0" max="1" step="0.01" value="1" />
                    </div>
                  </div>
                </div>
                <div class="check">
                  <input id="heel_rail_math_4" type="checkbox" />
                  <label for="heel_rail_math_4">Heel Rail Math 4</label>
                </div>
                <div id="heelRailMath4SubWrap" style="display: none; margin: 6px 0 10px 18px;">
                  <div class="check">
                    <input id="heel_rail_math_4a" type="checkbox" checked />
                    <label for="heel_rail_math_4a">Heel Rail Math 4A</label>
                  </div>
                  <div class="check">
                    <input id="heel_rail_math_4b" type="checkbox" />
                    <label for="heel_rail_math_4b">Heel Rail Math 4B</label>
                  </div>
                  <div id="heelRailMath4bWrap" style="display:none; margin: 4px 0 8px 18px;">
                    <div class="paramRow">
                      <div class="paramTop">
                        <div class="paramTag">HEEL_RM4B_SWEEP</div>
                        <div class="paramName">Heel RM4B Arc Sweep</div>
                      </div>
                      <div class="paramBody">
                        <input id="heel_rm4b_sweep" name="heel_rm4b_sweep" type="range" min="0" max="2" step="0.01" value="1" />
                        <input class="valInput" id="heel_rm4b_sweepVal" type="number" min="0" max="2" step="0.01" value="1" />
                      </div>
                    </div>
                    <div class="paramRow">
                      <div class="paramTop">
                        <div class="paramTag">HEEL_RM4B_BIAS</div>
                        <div class="paramName">Heel RM4B Midpoint Bias</div>
                      </div>
                      <div class="paramBody">
                        <input id="heel_rm4b_bias" name="heel_rm4b_bias" type="range" min="-1" max="1" step="0.01" value="0" />
                        <input class="valInput" id="heel_rm4b_biasVal" type="number" min="-1" max="1" step="0.01" value="0" />
                      </div>
                    </div>
                    <div class="paramRow">
                      <div class="paramTop">
                        <div class="paramTag">HEEL_RM4B_BLEND</div>
                        <div class="paramName">Heel RM4B Blend</div>
                      </div>
                      <div class="paramBody">
                        <input id="heel_rm4b_blend" name="heel_rm4b_blend" type="range" min="0" max="1" step="0.01" value="1" />
                        <input class="valInput" id="heel_rm4b_blendVal" type="number" min="0" max="1" step="0.01" value="1" />
                      </div>
                    </div>
                  </div>
                </div>
                <div class="check">
                  <input id="heel_rail_math_5" type="checkbox" />
                  <label for="heel_rail_math_5">Heel Rail Math 5</label>
                </div>
              </details>
            </details>
            <div class="endDivider" aria-hidden="true"></div>
        </form>

        
      </div>

      <!-- BOX 3: Debug (layout wrapper, outer visuals removed) -->
      <div id="debugPanel" class="panelBox">
        <div id="debug">
          <div id="debugHeader">Debug</div>
          <pre id="log"></pre>
        </div>
      </div>
    </div>

    <canvas id="c"></canvas>
    <script type="module" src="/src/main.ts"></script>

    <script>
      function swapDomNodes(a, b) {
        if (!a || !b || !a.parentNode || !b.parentNode || a === b) return;
        const aMarker = document.createTextNode("");
        const bMarker = document.createTextNode("");
        a.parentNode.insertBefore(aMarker, a);
        b.parentNode.insertBefore(bMarker, b);
        aMarker.parentNode.replaceChild(b, aMarker);
        bMarker.parentNode.replaceChild(a, bMarker);
      }

      const toolbarPanelSwapEl = document.getElementById("toolbarPanel");
      const titlePanelSwapEl = document.getElementById("titlePanel");
      const appVersionSwapEl = document.getElementById("appVersion");
      const statusSwapEl = document.getElementById("status");
      if (toolbarPanelSwapEl && titlePanelSwapEl && appVersionSwapEl && statusSwapEl) {
        titlePanelSwapEl.addEventListener("click", () => {
          swapDomNodes(appVersionSwapEl, statusSwapEl);
          toolbarPanelSwapEl.classList.toggle("titleOnly");
        });
      }

      const debugToggleEl = document.getElementById("debug");
      if (debugToggleEl) {
        debugToggleEl.addEventListener("click", (e) => {
          const target = e.target;
          if (target instanceof HTMLElement && target.closest("input, button, a, label")) return;
          debugToggleEl.classList.toggle("collapsed");
        });
      }

      function clamp(n, lo, hi) {
        return Math.min(hi, Math.max(lo, n));
      }

      function bindRangeToNumber(rangeId, numberId) {
        const r = document.getElementById(rangeId);
        const n = document.getElementById(numberId);
        if (!r || !n) return;
        let numberChangeDebounceTimer = null;
        const NUMBER_CHANGE_DEBOUNCE_MS = 120;

        if (typeof r.min === "string") n.min = r.min;
        if (typeof r.max === "string") n.max = r.max;
        if (typeof r.step === "string") n.step = r.step || n.step || "1";

        const syncNumber = () => { n.value = String(r.value); };

        const syncRange = (immediateChange = false) => {
          const raw = String(n.value ?? "");
          if (!immediateChange) {
            // Allow partial typing in number boxes (e.g. "1.", "-", ".")
            // without immediately normalizing and resetting the caret.
            if (
              raw === "" ||
              raw === "-" ||
              raw === "+" ||
              raw === "." ||
              raw === "-." ||
              raw === "+." ||
              /[.]$/.test(raw)
            ) {
              return;
            }
          }
          const lo = Number.isFinite(Number(r.min)) ? Number(r.min) : -Infinity;
          const hi = Number.isFinite(Number(r.max)) ? Number(r.max) : Infinity;
          const v = clamp(Number(n.value), lo, hi);
          if (!Number.isFinite(v)) return;

          r.value = String(v);
          if (immediateChange) n.value = String(v);
          r.dispatchEvent(new Event("input", { bubbles: true }));
          if (numberChangeDebounceTimer != null) {
            clearTimeout(numberChangeDebounceTimer);
            numberChangeDebounceTimer = null;
          }
          if (immediateChange) {
            r.dispatchEvent(new Event("change", { bubbles: true }));
            return;
          }
          numberChangeDebounceTimer = setTimeout(() => {
            numberChangeDebounceTimer = null;
            r.dispatchEvent(new Event("change", { bubbles: true }));
          }, NUMBER_CHANGE_DEBOUNCE_MS);
        };

        r.addEventListener("input", syncNumber);
        n.addEventListener("input", () => syncRange(false));
        n.addEventListener("change", () => syncRange(true));

        syncNumber();
      }

      // -----------------------------
      // Range <-> Number bindings
      // -----------------------------
      const ids = [
        ["tolerance", "toleranceVal"],
        ["debounceMs", "debounceMsVal"],
        ["sectionCutOffset", "sectionCutOffsetVal"],

        // Shoe
        ["shoeSize", "shoeSizeVal"],
        ["shoeScale", "shoeScaleVal"],
        ["shoeAlpha", "shoeAlphaVal"],
        ["shoeX", "shoeXVal"],
        ["shoeY", "shoeYVal"],
        ["shoeZ", "shoeZVal"],
        ["shoeRot", "shoeRotVal"],

        // Footpad
        ["footpadX", "footpadXVal"],
        ["footpadY", "footpadYVal"],
        ["footpadZ", "footpadZVal"],
        ["footpadRot", "footpadRotVal"],

        // Premade Hooks
        ["hookX", "hookXVal"],
        ["hookY", "hookYVal"],
        ["hookZ", "hookZVal"],
        ["hookRot", "hookRotVal"],

        // Baseplate
        // Baseplate
        ["bp_len", "bp_lenVal"],
        ["bp_wid", "bp_widVal"],
        ["bp_thk", "bp_thkVal"],
        ["bp_heelPct", "bp_heelPctVal"],
        ["bp_toePct", "bp_toePctVal"],
        ["bp_p2x", "bp_p2xVal"],
        ["bp_p3x", "bp_p3xVal"],
        ["bp_p4x", "bp_p4xVal"],


        // Baseplate Screw Holes
        ["bp_sh_x", "bp_sh_xVal"],
        ["bp_sh_y", "bp_sh_yVal"],
        ["bp_sh_ang", "bp_sh_angVal"],
        ["bp_sh_dia", "bp_sh_diaVal"],
        ["bp_sh_washer", "bp_sh_washerVal"],
        ["bp_sh_slot", "bp_sh_slotVal"],
        ["bp_sh_dist", "bp_sh_distVal"],
        ["bp_sh_ang2", "bp_sh_ang2Val"],
        ["bp_sh_off2", "bp_sh_off2Val"],

        // Toe
        ["toe_thk", "toe_thkVal"],

        // Toe A
        ["toe_a_p1s", "toe_a_p1sVal"],
        ["toe_a_p3s", "toe_a_p3sVal"],
        ["toe_a_endx", "toe_a_endxVal"],
        ["toe_a_endz", "toe_a_endzVal"],
        ["toe_a_enda", "toe_a_endaVal"],
        ["toe_a_strength", "toe_a_strengthVal"],

        // Toe B
        ["toe_b_sta", "toe_b_staVal"],
        ["toe_ab_mid", "toe_ab_midVal"],
        ["toe_b_p1s", "toe_b_p1sVal"],
        ["toe_b_p3s", "toe_b_p3sVal"],
        ["toe_b_endx", "toe_b_endxVal"],
        ["toe_b_endz", "toe_b_endzVal"],
        ["toe_b_enda", "toe_b_endaVal"],
        ["toe_b_strength", "toe_b_strengthVal"],

        // Toe C
        ["toe_c_sta", "toe_c_staVal"],
        ["toe_bc_mid", "toe_bc_midVal"],
        ["toe_c_p1s", "toe_c_p1sVal"],
        ["toe_c_p3s", "toe_c_p3sVal"],
        ["toe_c_endx", "toe_c_endxVal"],
        ["toe_c_endz", "toe_c_endzVal"],
        ["toe_c_enda", "toe_c_endaVal"],
        ["toe_c_strength", "toe_c_strengthVal"],

        // Heel
        ["heel_h_c", "heel_h_cVal"],
        ["heel_h_d", "heel_h_dVal"],
        ["heel_cd_mid", "heel_cd_midVal"],
        ["heel_cd_mid_pct", "heel_cd_mid_pctVal"],
        ["heel_f1", "heel_f1Val"],
        ["heel_f2", "heel_f2Val"],

        // Fillets
        ["fil_1", "fil_1Val"],
        ["fil_2", "fil_2Val"],
        ["fil_3", "fil_3Val"],
        ["fil_4", "fil_4Val"],
        ["fil_5", "fil_5Val"],
        ["sh_fil_1_r", "sh_fil_1_rVal"],
        ["th_fil_1_r", "th_fil_1_rVal"],
        ["th_fil_2_r", "th_fil_2_rVal"],
        ["heel_fil_1_r", "heel_fil_1_rVal"],
        ["heel_fil_2_r", "heel_fil_2_rVal"],
        ["bp_fil_1_r", "bp_fil_1_rVal"],
        ["tagent_a_offset_rot", "tagent_a_offset_rotVal"],
        ["tagent_a_midpoint", "tagent_a_midpointVal"],
        ["tagent_a_placeholder_1", "tagent_a_placeholder_1Val"],
        ["tagent_a_placeholder_2", "tagent_a_placeholder_2Val"],
      ];

      for (const pair of ids) bindRangeToNumber(pair[0], pair[1]);

      // -----------------------------
      // Shoe size -> scale mapping
      // -----------------------------
      const shoeSizeEl = document.getElementById("shoeSize");
      const shoeScaleEl = document.getElementById("shoeScale");
      const shoeScaleValEl = document.getElementById("shoeScaleVal");
      const shoeXAutoEl = document.getElementById("shoeX");
      const shoeXAutoValEl = document.getElementById("shoeXVal");
      const shoeZAutoEl = document.getElementById("shoeZ");
      const shoeZAutoValEl = document.getElementById("shoeZVal");

      function computeShoeScaleFromSize(size) {
        const step = 0.5; // tuned so size 15 ~= 1.25 scale
        const L10 = 10;     // baseline inches (ratio)
        const L = L10 + (size - 10) * step;
        return L / L10;
      }

      function updateShoeScale() {
        if (!shoeSizeEl || !shoeScaleEl || !shoeScaleValEl) return;
        const size = Number(shoeSizeEl.value);
        const scale = computeShoeScaleFromSize(size);

        // Auto shoe reference transform presets (lerp):
        // size 5  => X 0,  Z -9
        // size 15 => X 32, Z +19
        const t = clamp((size - 5) / 10, 0, 1);
        const shoeX = 0 + (32 - 0) * t;
        const shoeZ = -9 + (19 - -9) * t;

        shoeScaleEl.value = String(scale.toFixed(3));
        shoeScaleValEl.value = String(scale.toFixed(3));
        shoeScaleEl.dispatchEvent(new Event("input", { bubbles: true }));

        if (shoeXAutoEl) {
          shoeXAutoEl.value = String(Math.round(shoeX));
          if (shoeXAutoValEl) shoeXAutoValEl.value = shoeXAutoEl.value;
          shoeXAutoEl.dispatchEvent(new Event("input", { bubbles: true }));
        }
        if (shoeZAutoEl) {
          shoeZAutoEl.value = String(Math.round(shoeZ));
          if (shoeZAutoValEl) shoeZAutoValEl.value = shoeZAutoEl.value;
          shoeZAutoEl.dispatchEvent(new Event("input", { bubbles: true }));
        }
      }

      if (shoeSizeEl) {
        shoeSizeEl.addEventListener("input", updateShoeScale);
        updateShoeScale();
      }

      const tagentProfileAEl = document.getElementById("tagent_profile_a");
      const tagentProfileAControlsEl = document.getElementById("tagentProfileAControls");
      const tagentProfileDEl = document.getElementById("tagent_profile_d");
      const tagentProfileDControlsEl = document.getElementById("tagentProfileDControls");
      function syncTagentProfileAControls() {
        if (!tagentProfileAEl || !tagentProfileAControlsEl) return;
        tagentProfileAControlsEl.style.display = tagentProfileAEl.checked ? "none" : "";
      }
      function syncTagentProfileDControls() {
        if (!tagentProfileDEl || !tagentProfileDControlsEl) return;
        tagentProfileDControlsEl.style.display = tagentProfileDEl.checked ? "none" : "";
      }
      if (tagentProfileAEl && tagentProfileAControlsEl) {
        tagentProfileAEl.addEventListener("change", syncTagentProfileAControls);
        syncTagentProfileAControls();
      }
      if (tagentProfileDEl && tagentProfileDControlsEl) {
        tagentProfileDEl.addEventListener("change", syncTagentProfileDControls);
        syncTagentProfileDControls();
      }
    </script>
  </body>
</html>




